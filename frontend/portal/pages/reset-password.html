<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SecCortex 密码重置 - 设置您的新密码">
    <title>设置新密码 - SecCortex</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../css/auth.css">
    <link rel="stylesheet" href="../css/password-recovery.css">
</head>
<body>
    <!-- 全局导航 -->
    <header class="header">
        <nav class="nav-container">
            <div class="nav-brand">
                <a href="index.html" style="text-decoration: none; display: flex; align-items: center; gap: 12px;">
                    <h1 class="brand-logo">云脑</h1>
                    <span class="brand-slogan">最懂安全的AI智能体平台</span>
                </a>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li class="nav-item"><a href="index.html">云脑</a></li>
                <li class="nav-item"><a href="news.html">资讯</a></li>
                <li class="nav-item"><a href="papers.html">论文</a></li>
                <li class="nav-item"><a href="resources.html">资源</a></li>
            </ul>
            <div class="nav-actions">
                <a href="login.html" class="btn btn-outline">登录</a>
                <a href="register.html" class="btn btn-primary">注册</a>
            </div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="菜单">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

    <!-- 主内容区 -->
    <main class="auth-main">
        <div class="auth-container">
            <!-- 视图1: 密码重置表单 -->
            <div class="auth-card" id="resetPasswordView">
                <div class="auth-header">
                    <h1 class="auth-title">设置新密码</h1>
                    <p class="auth-subtitle">请输入您的新密码</p>
                </div>

                <form class="auth-form" id="resetPasswordForm">
                    <!-- 新密码 -->
                    <div class="form-group">
                        <label for="newPassword" class="form-label">新密码</label>
                        <div class="password-input-wrapper">
                            <input
                                type="password"
                                id="newPassword"
                                name="newPassword"
                                class="form-input password-input"
                                placeholder="请输入新密码（至少8位）"
                                required
                            >
                            <button type="button" class="password-toggle" id="toggleNewPassword" aria-label="显示密码">
                                <svg class="icon-eye" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M1 10C1 10 4 4 10 4C16 4 19 10 19 10C19 10 16 16 10 16C4 16 1 10 1 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <svg class="icon-eye-off" width="20" height="20" viewBox="0 0 20 20" fill="none" style="display: none;">
                                    <path d="M14.12 14.12C13.0382 15.0049 11.6863 15.4933 10.29 15.5C4.29 15.5 1.29 9.5 1.29 9.5C2.09 7.95 3.14 6.58 4.38 5.38M8.21 3.73C8.79 3.59 9.39 3.5 10 3.5C16 3.5 19 9.5 19 9.5C18.4745 10.5059 17.8283 11.4461 17.08 12.3M11.36 11.36C11.1476 11.5895 10.8902 11.7719 10.6038 11.8961C10.3174 12.0203 10.0082 12.0835 9.696 12.0819C9.38378 12.0803 9.07521 12.0139 8.79011 11.8867C8.505 11.7594 8.24958 11.5741 8.03973 11.3422C7.82988 11.1104 7.66993 10.8369 7.57066 10.5391C7.47139 10.2413 7.43511 9.92538 7.46426 9.61192C7.49341 9.29846 7.58728 8.99442 7.74006 8.7194C7.89285 8.44438 8.10116 8.20427 8.35 8.01L11.36 11.36Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M1 1L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>

                        <!-- 密码强度指示器 -->
                        <div class="password-strength" id="passwordStrength" style="display: none;">
                            <div class="password-strength-bar">
                                <div class="password-strength-fill" id="strengthFill"></div>
                            </div>
                            <div class="password-strength-text" id="strengthText">密码强度: 弱</div>
                        </div>

                        <div class="form-error" id="passwordError"></div>
                    </div>

                    <!-- 确认密码 -->
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">确认密码</label>
                        <div class="password-input-wrapper">
                            <input
                                type="password"
                                id="confirmPassword"
                                name="confirmPassword"
                                class="form-input password-input"
                                placeholder="请再次输入新密码"
                                required
                            >
                            <button type="button" class="password-toggle" id="toggleConfirmPassword" aria-label="显示密码">
                                <svg class="icon-eye" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M1 10C1 10 4 4 10 4C16 4 19 10 19 10C19 10 16 16 10 16C4 16 1 10 1 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <svg class="icon-eye-off" width="20" height="20" viewBox="0 0 20 20" fill="none" style="display: none;">
                                    <path d="M14.12 14.12C13.0382 15.0049 11.6863 15.4933 10.29 15.5C4.29 15.5 1.29 9.5 1.29 9.5C2.09 7.95 3.14 6.58 4.38 5.38M8.21 3.73C8.79 3.59 9.39 3.5 10 3.5C16 3.5 19 9.5 19 9.5C18.4745 10.5059 17.8283 11.4461 17.08 12.3M11.36 11.36C11.1476 11.5895 10.8902 11.7719 10.6038 11.8961C10.3174 12.0203 10.0082 12.0835 9.696 12.0819C9.38378 12.0803 9.07521 12.0139 8.79011 11.8867C8.505 11.7594 8.24958 11.5741 8.03973 11.3422C7.82988 11.1104 7.66993 10.8369 7.57066 10.5391C7.47139 10.2413 7.43511 9.92538 7.46426 9.61192C7.49341 9.29846 7.58728 8.99442 7.74006 8.7194C7.89285 8.44438 8.10116 8.20427 8.35 8.01L11.36 11.36Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M1 1L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>

                        <div class="password-match" id="passwordMatch" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            密码一致
                        </div>

                        <div class="form-error" id="confirmError"></div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
                        <span class="btn-text">确认重置</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="loading-spinner"></span>
                            重置中...
                        </span>
                    </button>
                </form>
            </div>

            <!-- 视图2: 重置成功 -->
            <div class="auth-card" id="successView" style="display: none;">
                <div class="status-icon status-icon-success">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="28" fill="var(--clouditera-palette-green-0)"/>
                        <path d="M20 32L28 40L44 24" stroke="var(--clouditera-semantic-success)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>

                <div class="auth-header">
                    <h1 class="auth-title">密码重置成功！</h1>
                    <p class="auth-subtitle">您的密码已成功重置，请使用新密码登录</p>
                </div>

                <button type="button" class="btn btn-primary btn-block" onclick="window.location.href='login.html'">
                    立即登录
                </button>

                <div class="auth-footer" style="border-top: none; padding-top: 16px;">
                    <span id="redirectCountdown" style="color: var(--clouditera-neutral-text-secondary);">
                        3 秒后自动跳转登录页...
                    </span>
                </div>
            </div>

            <!-- 视图3: 链接失效/错误 -->
            <div class="auth-card" id="invalidTokenView" style="display: none;">
                <div class="status-icon status-icon-error">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="28" fill="var(--clouditera-palette-red-0)"/>
                        <path d="M32 20V34M32 42H32.02" stroke="var(--clouditera-semantic-error)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>

                <div class="auth-header">
                    <h1 class="auth-title">链接已失效</h1>
                    <p class="auth-subtitle">该密码重置链接已过期或无效，请重新申请</p>
                </div>

                <button type="button" class="btn btn-primary btn-block" onclick="window.location.href='forgot-password.html'">
                    重新找回密码
                </button>

                <div class="auth-footer" style="border-top: none;">
                    <a href="login.html" class="auth-link">返回登录</a>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p class="footer-company">云起白山AI安全联合实验室</p>
                <p class="footer-copyright">&copy; 2025 SecCortex 云脑安全智能体平台. All rights reserved.</p>
                <p class="footer-icp">ICP备案号：京ICP备2022020425号</p>
            </div>
        </div>
    </footer>

    <script src="../../js/common.js"></script>
    <script src="../js/password-recovery.js"></script>
    <script>
        // 页面加载时验证token
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (window.PasswordRecovery) {
                window.PasswordRecovery.verifyResetToken(token);
            }
        });
    </script>
</body>
</html>
