<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AIæ¼æ´çŒäºº - æ™ºèƒ½ä»£ç å®‰å…¨å®¡è®¡ä¸æ¼æ´æ£€æµ‹">
    <title>AIæ¼æ´çŒäºº | äº‘è„‘</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/dashboard.css">
    <link rel="stylesheet" href="../../templates/css/template-detail.css">
    <link rel="stylesheet" href="../../components/agent-sidebar.css">
    <link rel="stylesheet" href="../../components/chat-input.css">
    <style>
        /* ä¸Šä¼ ä¸‹æ‹‰èœå•æ ·å¼ */
        .upload-dropdown-wrapper {
            position: relative;
        }

        .upload-dropdown {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 8px;
            background: var(--clouditera-neutral-background-white);
            border: 1px solid var(--clouditera-neutral-border-primary);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 280px;
            z-index: 1000;
            overflow: hidden;
        }

        .upload-dropdown-wrapper.active .upload-dropdown {
            display: block;
        }

        .upload-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 16px;
            width: 100%;
            border: none;
            background: transparent;
            cursor: pointer;
            text-align: left;
            transition: background-color 0.2s;
        }

        .upload-option:hover {
            background-color: var(--clouditera-neutral-background-primary);
        }

        .upload-option:first-child {
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
        }

        .upload-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .upload-info {
            flex: 1;
            min-width: 0;
        }

        .upload-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--clouditera-neutral-text-primary);
            margin-bottom: 4px;
        }

        .upload-desc {
            font-size: 12px;
            color: var(--clouditera-neutral-text-secondary);
            line-height: 1.4;
        }

        /* å¼¹å‡ºæ¡†æ ·å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--clouditera-neutral-background-white);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
        }

        .modal-warning {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            margin-top: 8px;
            margin-left: 24px;
            margin-right: 24px;
            background: rgba(250, 173, 20, 0.2);
            border-radius: 6px;
        }

        .warning-icon {
            font-size: 16px;
            flex-shrink: 0;
            line-height: 1.5;
        }

        .warning-text {
            font-size: 13px;
            color: var(--clouditera-neutral-text-primary);
            line-height: 1.5;
            flex: 1;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
            margin: 0;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            font-size: 24px;
            color: var(--clouditera-neutral-text-secondary);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--clouditera-neutral-background-primary);
            color: var(--clouditera-neutral-text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--clouditera-neutral-border-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--clouditera-neutral-text-primary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--clouditera-neutral-border-primary);
            border-radius: 6px;
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
            background: var(--clouditera-neutral-background-white);
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--clouditera-brand-primary);
            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);
        }

        /* ç¦ç”¨è¾“å…¥æ¡†æ ·å¼ */
        .chat-input[readonly],
        .chat-input[disabled] {
            background-color: var(--clouditera-neutral-background-primary);
            color: var(--clouditera-neutral-text-primary);
            cursor: not-allowed;
            opacity: 1;
        }

        .form-hint {
            font-size: 12px;
            color: var(--clouditera-neutral-text-secondary);
            margin-top: 6px;
        }

        .required {
            color: #EF4444;
        }

        .optional {
            color: var(--clouditera-neutral-text-secondary);
            font-weight: 400;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--clouditera-brand-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--clouditera-brand-primary-hover);
        }

        .btn-text {
            background: transparent;
            color: var(--clouditera-neutral-text-secondary);
        }

        .btn-text:hover {
            color: var(--clouditera-neutral-text-primary);
            background: var(--clouditera-neutral-background-primary);
        }

        /* åŠ¨ç”» */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* æ™ºèƒ½ä½“ç©ºé—´æŒ‰é’®æ ·å¼ */
        .agent-space-btn {
            padding: 8px 16px;
            border: 1px solid var(--clouditera-neutral-border-primary);
            background: var(--clouditera-neutral-background-white);
            color: var(--clouditera-neutral-text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .agent-space-btn:hover {
            background: var(--clouditera-neutral-background-primary);
            border-color: var(--clouditera-brand-primary);
            color: var(--clouditera-brand-primary);
        }

        /* ä»»åŠ¡è¯¦æƒ…å®¹å™¨ - æ”¯æŒåˆ†å± */
        .task-detail-content {
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ä¸»å†…å®¹åŒºåŸŸå®¹å™¨ */
        .task-main-wrapper {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
            min-height: 0;
        }

        /* Agentæ—¥å¿—å®¹å™¨ */
        .agent-log-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: var(--clouditera-neutral-background-primary);
            min-width: 0;
        }

        /* æ™ºèƒ½ä½“ç©ºé—´ä¾§è¾¹æ  */
        .agent-space-sidebar {
            position: relative;
            width: 0;
            background: var(--clouditera-neutral-background-white);
            border-left: 1px solid var(--clouditera-neutral-border-primary);
            overflow: hidden;
            transition: width 0.3s ease;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .agent-space-sidebar.active {
            width: 400px;
        }


        .agent-space-sidebar-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .agent-space-sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
            margin: 0;
        }

        .agent-space-sidebar-close {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            font-size: 18px;
            color: var(--clouditera-neutral-text-secondary);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .agent-space-sidebar-close:hover {
            background: var(--clouditera-neutral-background-primary);
            color: var(--clouditera-neutral-text-primary);
        }

        .agent-space-sidebar-body {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: var(--clouditera-neutral-border-primary) var(--clouditera-neutral-background-white);
        }

        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ */
        .agent-space-sidebar-body::-webkit-scrollbar {
            width: 8px;
        }

        .agent-space-sidebar-body::-webkit-scrollbar-track {
            background: var(--clouditera-neutral-background-white);
            border-radius: 4px;
        }

        .agent-space-sidebar-body::-webkit-scrollbar-thumb {
            background: var(--clouditera-neutral-border-primary);
            border-radius: 4px;
            transition: background 0.2s;
        }

        .agent-space-sidebar-body::-webkit-scrollbar-thumb:hover {
            background: var(--clouditera-neutral-text-secondary);
        }

        /* æ‹–æ‹½åˆ†éš”çº¿ */
        .resize-handle {
            position: absolute;
            top: 0;
            left: -4px;
            bottom: 0;
            width: 8px;
            cursor: col-resize;
            z-index: 20;
            background: transparent;
            transition: background 0.2s;
        }

        .resize-handle:hover,
        .resize-handle.resizing {
            background: var(--clouditera-brand-primary);
        }

        .resize-handle::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 40px;
            background: var(--clouditera-neutral-border-primary);
            border-radius: 1px;
        }

        .resize-handle:hover::before,
        .resize-handle.resizing::before {
            background: var(--clouditera-brand-primary);
        }

        /* Agentæ—¥å¿—æ ·å¼ */

        .log-stage {
            margin-bottom: 32px;
            background: var(--clouditera-neutral-background-white);
            border-radius: 8px;
            border: 1px solid var(--clouditera-neutral-border-secondary);
            overflow: hidden;
        }

        .log-stage-header {
            padding: 16px 20px;
            background: var(--clouditera-neutral-background-secondary);
            border-bottom: 1px solid var(--clouditera-neutral-border-secondary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .log-stage-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
        }

        .log-stage-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            background: var(--clouditera-brand-primary);
            color: white;
        }

        .log-stage-badge.parallel {
            background: #10B981;
        }

        .log-stage-badge.serial {
            background: #F59E0B;
        }

        .log-stage-body {
            padding: 20px;
        }

        .log-event {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--clouditera-neutral-background-primary);
            border-radius: 6px;
            border-left: 3px solid var(--clouditera-brand-primary);
        }

        .log-event:last-child {
            margin-bottom: 0;
        }

        .log-event-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .log-event-icon {
            font-size: 18px;
        }

        .log-event-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
        }

        .log-event-overview {
            font-size: 13px;
            color: var(--clouditera-neutral-text-secondary);
            margin-bottom: 8px;
        }

        .log-event-detail {
            font-size: 13px;
            color: var(--clouditera-neutral-text-primary);
            background: var(--clouditera-neutral-background-white);
            padding: 12px;
            border-radius: 4px;
            margin-top: 8px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            line-height: 1.6;
        }

        .log-reasoning {
            background: #EFF6FF;
            border-left-color: #3B82F6;
        }

        .log-reasoning .log-event-title {
            color: #1E40AF;
        }

        .log-reasoning .log-event-detail {
            background: #DBEAFE;
            color: #1E3A8A;
            font-family: inherit;
            font-style: italic;
        }

        /* æ™ºèƒ½ä½“ç©ºé—´Tabåˆ‡æ¢æ ·å¼ */
        .agent-space-tabs {
            display: flex;
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
            background: var(--clouditera-neutral-background-white);
            padding: 0 20px;
        }

        .agent-space-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--clouditera-neutral-text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
            top: 1px;
        }

        .agent-space-tab:hover {
            color: var(--clouditera-neutral-text-primary);
        }

        .agent-space-tab.active {
            color: var(--clouditera-brand-primary);
            border-bottom-color: var(--clouditera-brand-primary);
        }

        .agent-space-tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        .agent-space-tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* ä»£ç æŸ¥çœ‹å™¨æ ·å¼ */
        .code-viewer-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            height: 100%;
        }

        .code-viewer-sidebar {
            width: 250px;
            border-right: 1px solid var(--clouditera-neutral-border-primary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--clouditera-neutral-background-white);
        }

        .code-viewer-title {
            padding: 16px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
            flex-shrink: 0;
        }

        .code-viewer-sidebar .file-tree {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 12px;
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: var(--clouditera-neutral-border-primary) var(--clouditera-neutral-background-white);
        }

        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ */
        .code-viewer-sidebar .file-tree::-webkit-scrollbar {
            width: 6px;
        }

        .code-viewer-sidebar .file-tree::-webkit-scrollbar-track {
            background: var(--clouditera-neutral-background-white);
            border-radius: 3px;
        }

        .code-viewer-sidebar .file-tree::-webkit-scrollbar-thumb {
            background: var(--clouditera-neutral-border-primary);
            border-radius: 3px;
            transition: background 0.2s;
        }

        .code-viewer-sidebar .file-tree::-webkit-scrollbar-thumb:hover {
            background: var(--clouditera-neutral-text-secondary);
        }

        .code-viewer-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--clouditera-neutral-background-white);
        }

        .code-viewer-placeholder {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--clouditera-neutral-text-secondary);
        }

        .placeholder-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .placeholder-text {
            font-size: 14px;
        }

        .code-viewer-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .code-viewer-header {
            padding: 12px 20px;
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
            background: var(--clouditera-neutral-background-secondary);
            flex-shrink: 0;
        }

        .code-file-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--clouditera-neutral-text-primary);
        }

        .code-viewer-body {
            flex: 1;
            overflow: auto;
            overflow-x: auto;
            padding: 20px;
            background: #1e1e1e;
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ - æ·±è‰²ä¸»é¢˜ */
            scrollbar-width: thin;
            scrollbar-color: #555 #1e1e1e;
        }

        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ - æ·±è‰²ä¸»é¢˜ */
        .code-viewer-body::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .code-viewer-body::-webkit-scrollbar-track {
            background: #1e1e1e;
            border-radius: 5px;
        }

        .code-viewer-body::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .code-viewer-body::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        .code-viewer-body::-webkit-scrollbar-corner {
            background: #1e1e1e;
        }

        .code-block {
            margin: 0;
            padding: 0;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #d4d4d4;
            background: transparent;
            overflow-x: auto;
        }

        .code-block code {
            display: block;
            padding: 0;
            margin: 0;
            color: inherit;
            background: transparent;
        }

        .file-tree {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .file-tree-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
            width: 100%;
            box-sizing: border-box;
        }

        .file-tree-item:hover {
            background: var(--clouditera-neutral-background-primary);
        }

        .file-tree-item.selected {
            background: var(--clouditera-brand-primary);
            color: white;
        }

        .file-tree-item.selected .file-tree-name {
            color: white;
        }

        .file-tree-item.folder-item {
            font-weight: 500;
        }

        .folder-expand {
            display: inline-block;
            width: 12px;
            font-size: 10px;
            margin-right: 4px;
            transition: transform 0.2s;
            color: var(--clouditera-neutral-text-secondary);
        }

        /* å‘ä¸‹æ’åˆ—ç»“æ„ - æ‰å¹³åŒ–æ˜¾ç¤º */
        .file-tree ul {
            list-style: none;
            padding: 0;
            margin: 0;
            margin-top: 2px;
            margin-left: 0;
        }

        .file-tree-item {
            padding-left: 12px !important;
            margin-bottom: 2px;
        }

        .file-tree ul .file-tree-item {
            padding-left: 24px !important;
        }

        .file-tree ul ul .file-tree-item {
            padding-left: 36px !important;
        }

        .file-tree-icon {
            font-size: 16px;
        }

        .file-tree-name {
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
        }

        .file-category {
            margin-bottom: 20px;
        }

        .file-category-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--clouditera-neutral-border-secondary);
        }

        .file-item {
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
            margin-bottom: 4px;
        }

        .file-item:hover {
            background: var(--clouditera-neutral-background-primary);
        }

        .file-item-icon {
            font-size: 16px;
        }

        .file-item-name {
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
        }

        /* äº§ç‰©æŠ¥å‘Šåˆ—è¡¨æ ·å¼ */
        .artifact-reports-list {
            padding: 16px;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 100%;
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: var(--clouditera-neutral-border-primary) var(--clouditera-neutral-background-white);
        }

        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ */
        .artifact-reports-list::-webkit-scrollbar {
            width: 8px;
        }

        .artifact-reports-list::-webkit-scrollbar-track {
            background: var(--clouditera-neutral-background-white);
            border-radius: 4px;
        }

        .artifact-reports-list::-webkit-scrollbar-thumb {
            background: var(--clouditera-neutral-border-primary);
            border-radius: 4px;
            transition: background 0.2s;
        }

        .artifact-reports-list::-webkit-scrollbar-thumb:hover {
            background: var(--clouditera-neutral-text-secondary);
        }

        .artifact-folder {
            margin-bottom: 12px;
        }

        .artifact-folder-header {
            padding: 12px 16px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
            border: 1px solid var(--clouditera-neutral-border-secondary);
            background: var(--clouditera-neutral-background-secondary);
            font-weight: 500;
        }

        .artifact-folder-header:hover {
            background: var(--clouditera-neutral-background-primary);
            border-color: var(--clouditera-brand-primary);
        }

        .folder-expand-icon {
            font-size: 10px;
            width: 12px;
            display: inline-block;
            transition: transform 0.2s;
            color: var(--clouditera-neutral-text-secondary);
        }

        .folder-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .folder-name {
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
            font-weight: 500;
        }

        .artifact-folder-content {
            margin-top: 4px;
            margin-left: 20px;
            padding-left: 12px;
            border-left: 2px solid var(--clouditera-neutral-border-secondary);
        }

        .artifact-report-item {
            padding: 10px 16px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
            margin-bottom: 6px;
            border: 1px solid var(--clouditera-neutral-border-secondary);
            background: var(--clouditera-neutral-background-white);
        }

        .artifact-report-item:hover {
            background: var(--clouditera-neutral-background-primary);
            border-color: var(--clouditera-brand-primary);
        }

        .report-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .report-name {
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
        }

        /* æ‰§è¡Œtabæ ·å¼ */
        .execution-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .execution-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 300px;
            color: var(--clouditera-neutral-text-secondary);
        }

        .execution-placeholder .placeholder-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .execution-placeholder .placeholder-text {
            font-size: 14px;
        }

        .execution-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ä»»åŠ¡ä¿¡æ¯æ˜¾ç¤º */
        .execution-task-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--clouditera-neutral-background-primary);
            border-radius: 8px;
            border: 1px solid var(--clouditera-neutral-border-secondary);
            position: relative;
        }

        .task-status-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--clouditera-neutral-border-primary);
            border-top-color: var(--clouditera-brand-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .task-status-icon.completed {
            color: var(--clouditera-semantic-success);
            font-size: 18px;
        }

        .task-progress-text {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .task-current {
            font-size: 16px;
            font-weight: 400;
            color: var(--clouditera-neutral-text-primary);
        }

        .task-name {
            font-size: 14px;
            color: var(--clouditera-neutral-text-secondary);
            font-weight: 400;
        }

        /* å½“å‰ä»»åŠ¡ä¸‹æ‹‰äº¤äº’ */
        .task-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
            color: var(--clouditera-neutral-text-secondary);
            transition: background 0.2s, color 0.2s, transform 0.2s;
        }

        .task-toggle:hover {
            background: var(--clouditera-neutral-background-primary);
            color: var(--clouditera-neutral-text-primary);
        }

        .task-toggle-icon {
            font-size: 14px;
            transform: rotate(0deg);
            transition: transform 0.2s;
        }

        .task-toggle.open .task-toggle-icon {
            transform: rotate(180deg);
        }

        .task-rules {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            margin-bottom: 8px;
            padding: 10px 14px;
            border-radius: 8px;
            background: var(--clouditera-neutral-background-white);
            border: 1px solid var(--clouditera-neutral-border-secondary);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
            box-sizing: border-box;
            z-index: 10;
            display: none;
        }

        .task-rules-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--clouditera-neutral-text-secondary);
            margin-bottom: 4px;
            line-height: 1.6;
        }

        .task-rules-item:last-child {
            margin-bottom: 0;
        }

        .task-rule-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .task-rule-status.completed {
            color: var(--clouditera-semantic-success);
            font-size: 14px;
        }

        .task-rule-status.loading .mini-loading-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid var(--clouditera-neutral-border-primary);
            border-top-color: var(--clouditera-brand-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        .task-rule-text {
            flex: 1;
        }

        .execution-header {
            padding-bottom: 16px;
            border-bottom: 1px solid var(--clouditera-neutral-border-primary);
        }

        .execution-target {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .target-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-primary);
        }

        .target-value {
            font-size: 14px;
            color: var(--clouditera-brand-primary);
            font-weight: 500;
        }

        .execution-details {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .execution-detail-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .execution-detail-item.full-width {
            flex-direction: column;
            gap: 8px;
        }

        .detail-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--clouditera-neutral-text-secondary);
            min-width: 100px;
            flex-shrink: 0;
        }

        .detail-value {
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
            flex: 1;
            line-height: 1.6;
        }

        .execution-detail-item.full-width .detail-value {
            background: var(--clouditera-neutral-background-primary);
            padding: 12px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 13px;
        }

        /* æ‰§è¡Œè¿›åº¦æ¡æ ·å¼ */
        .execution-progress-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
            border-top: 1px solid var(--clouditera-neutral-border-primary);
            margin-top: 20px;
        }

        .progress-nav-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--clouditera-neutral-border-primary);
            background: var(--clouditera-neutral-background-white);
            color: var(--clouditera-neutral-text-primary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .progress-nav-btn:hover:not(:disabled) {
            background: var(--clouditera-neutral-background-primary);
            border-color: var(--clouditera-brand-primary);
            color: var(--clouditera-brand-primary);
        }

        .progress-nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .progress-track {
            flex: 1;
            height: 8px;
            background: var(--clouditera-neutral-background-secondary);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .progress-steps {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
        }

        .progress-step {
            flex: 1;
            height: 100%;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .progress-step:hover {
            background: rgba(24, 144, 255, 0.1);
        }

        .progress-step.active {
            background: rgba(24, 144, 255, 0.2);
        }

        .progress-step-marker {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--clouditera-neutral-border-primary);
            border: 2px solid var(--clouditera-neutral-background-white);
            border-radius: 50%;
            transition: all 0.2s;
        }

        .progress-step.active .progress-step-marker {
            background: var(--clouditera-brand-primary);
            border-color: var(--clouditera-brand-primary);
            width: 16px;
            height: 16px;
        }

        .progress-step.completed .progress-step-marker {
            background: var(--clouditera-brand-primary);
            border-color: var(--clouditera-brand-primary);
        }

        .progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--clouditera-brand-primary);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-status {
            font-size: 12px;
            color: var(--clouditera-neutral-text-secondary);
            padding: 6px 12px;
            background: var(--clouditera-neutral-background-primary);
            border-radius: 4px;
            flex-shrink: 0;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .upload-dropdown {
                min-width: 240px;
            }

            .modal-content {
                width: 95%;
                max-width: none;
            }

            .workspace-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="agent-detail-page">
    <!-- å·¦ä¾§ä¸»å¯¼èˆªæ  - æ™ºèƒ½ä½“è¯¦æƒ…é¡µæ¨¡å¼ï¼ˆæ”¶èµ·ï¼‰ -->
    <aside class="sidebar collapsed" id="sidebar">
        <!-- Logo åŒº -->
        <div class="sidebar-logo">
            <a href="../../dashboard.html" class="logo-link" title="äº‘è„‘">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="6" fill="#2563EB"/>
                        <path d="M16 8L20 14H12L16 8Z" fill="white"/>
                        <path d="M10 18L14 24H6L10 18Z" fill="white" opacity="0.8"/>
                        <path d="M22 18L26 24H18L22 18Z" fill="white" opacity="0.8"/>
                    </svg>
                </div>
                <h1 class="logo-text">äº‘è„‘</h1>
            </a>
        </div>

        <!-- ä¸»å¯¼èˆªèœå• -->
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <!-- é¦–é¡µ - å¸¦æ”¶è—å¿«æ·å…¥å£ -->
                <div class="nav-item-home-wrapper">
                    <a href="../../dashboard.html" class="nav-item nav-item-home" title="é¦–é¡µ">
                        <span class="nav-icon">ğŸ </span>
                        <span class="nav-text">é¦–é¡µ</span>
                    </a>
                    <div class="home-menu" id="homeMenu">
                        <a href="../../dashboard.html" class="home-menu-favorite-item">
                            <span class="home-menu-favorite-icon">ğŸ </span>
                            <span class="home-menu-favorite-name">é¦–é¡µ</span>
                        </a>
                        <div class="home-menu-favorites" id="homeMenuFavorites">
                            <div class="home-menu-favorites-empty" id="homeMenuFavoritesEmpty" style="display: none;">
                                <p class="home-menu-empty-text">æš‚æ— æ”¶è—</p>
                            </div>
                            <div class="home-menu-favorites-list" id="homeMenuFavoritesList"></div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <nav class="sidebar-nav-bottom">
                <a href="../../templates.html" class="nav-item" title="UIæ¨¡æ¿">
                    <span class="nav-icon">ğŸ“</span>
                    <span class="nav-text">UIæ¨¡æ¿</span>
                </a>

                <a href="#" class="nav-item" title="å¸®åŠ©ä¸­å¿ƒ">
                    <span class="nav-icon">â“</span>
                    <span class="nav-text">å¸®åŠ©ä¸­å¿ƒ</span>
                </a>

                <a href="#" class="nav-item" title="ç”¨æˆ·åé¦ˆ">
                    <span class="nav-icon">ğŸ’¬</span>
                    <span class="nav-text">ç”¨æˆ·åé¦ˆ</span>
                </a>

                <div class="nav-item-user-wrapper">
                    <a href="#" class="nav-item nav-item-user" id="userNavItem" title="ä¸ªäººä¸­å¿ƒ">
                        <div class="user-avatar" id="userAvatar">T</div>
                        <span class="user-name" id="userName">æµ‹è¯•ç”¨æˆ·</span>
                    </a>
                    <div class="user-menu" id="userMenu">
                        <a href="../../pages/user-management.html" class="user-menu-item">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span class="nav-text">ä¸ªäººä¸­å¿ƒ</span>
                        </a>
                        <button class="user-menu-item nav-item-logout" id="logoutBtn">
                            <span class="nav-icon">ğŸšª</span>
                            <span class="nav-text">é€€å‡ºç™»å½•</span>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content-area">
        <!-- æ™ºèƒ½ä½“å¤´éƒ¨ä¿¡æ¯ -->
        <div class="agent-header">
            <div class="agent-header-main">
                <div class="agent-icon">ğŸ”</div>
                <div class="agent-info">
                    <div class="agent-title-wrapper">
                        <h2 class="agent-title">AIæ¼æ´çŒäºº</h2>
                        <span class="agent-type">åŸºç¡€ç±»</span>
                        <span class="agent-version">v1.0.0</span>
                    </div>
                    <p class="agent-description">æ™ºèƒ½ä»£ç å®‰å…¨å®¡è®¡ä¸æ¼æ´æ£€æµ‹ï¼Œè‡ªåŠ¨è¯†åˆ«å¸¸è§å®‰å…¨æ¼æ´ï¼Œæä¾›ä¸“ä¸šçš„å®‰å…¨å»ºè®®å’Œä¿®å¤æ–¹æ¡ˆ</p>
                </div>
            </div>
            <!-- ç®¡ç†åŠŸèƒ½æŒ‰é’®ç»„ -->
            <div class="agent-header-actions">
                <button class="btn-agent-action" title="çŸ¥è¯†åº“">
                    <span class="action-icon">ğŸ“š</span>
                    <span class="action-text">çŸ¥è¯†åº“</span>
                    <span class="action-count">(156)</span>
                </button>
                <button class="btn-agent-action" title="å·¥å…·æ’ä»¶">
                    <span class="action-icon">ğŸ”§</span>
                    <span class="action-text">å·¥å…·æ’ä»¶</span>
                    <span class="action-count">(12)</span>
                </button>
                <button class="btn-agent-action" title="æ™ºèƒ½ä½“è®¾ç½®">
                    <span class="action-icon">âš™ï¸</span>
                    <span class="action-text">è®¾ç½®</span>
                </button>
                <button class="btn btn-primary btn-sm">
                    <span>ğŸ”—</span>
                    <span>åˆ†äº«</span>
                </button>
            </div>
        </div>

        <!-- å†…å®¹å®¹å™¨ -->
        <div class="content-container">
            <!-- æ™ºèƒ½ä½“è¯¦æƒ…ä¾§å¯¼èˆª -->
            <aside class="agent-sidebar">
                <nav class="agent-nav">
                    <!-- æ–°ä»»åŠ¡æŒ‰é’® -->
                    <button class="btn-new-chat">
                        <span class="btn-icon">âœ¨</span>
                        <span class="btn-text">æ–°ä»»åŠ¡</span>
                    </button>

                    <!-- è¿‘æœŸä»»åŠ¡ -->
                    <div class="nav-group">
                        <div class="nav-group-title">è¿‘æœŸä»»åŠ¡</div>

                        <!-- è¿‘æœŸä»»åŠ¡åˆ—è¡¨ -->
                        <div class="recent-tasks-list">
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon running">â³</span>
                                <div class="task-name">Laravelé¡¹ç›®å®‰å…¨å®¡è®¡</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon running">â³</span>
                                <div class="task-name">Reactåº”ç”¨æ¼æ´æ‰«æ</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">Pythonä»£ç å®‰å…¨å®¡è®¡</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon failed">âŒ</span>
                                <div class="task-name">Spring Bootåº”ç”¨å®¡è®¡</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">Node.jså®‰å…¨å’¨è¯¢</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">Djangoé¡¹ç›®ä»£ç å®¡æŸ¥</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">Vue.jså®‰å…¨æ‰«æ</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">PHPä»£ç å®‰å…¨åˆ†æ</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">Angularåº”ç”¨å®¡è®¡</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">Java Webå®‰å…¨å’¨è¯¢</div>
                            </a>
                        </div>

                        <!-- æŸ¥çœ‹å…¨éƒ¨å…¥å£ -->
                        <a href="#" class="view-all-tasks">
                            æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡è®°å½• â†’
                        </a>
                    </div>
                </nav>
            </aside>

            <!-- ä¸»å†…å®¹åŒºåŸŸ - ç©ºçŠ¶æ€ -->
            <div class="agent-main-content">
                <div class="empty-state-container">
                    <!-- æ™ºèƒ½ä½“åç§° - ä¼˜å…ˆçº§æœ€é«˜ -->
                    <div class="empty-agent-name">
                        <span class="agent-name-text">AIæ¼æ´çŒäºº</span>
                    </div>

                    <!-- å¼•å¯¼æ–‡æ¡ˆ - æ¬¡è¦ä¼˜å…ˆçº§ -->
                    <div class="empty-state-guide">
                        <p class="empty-state-guide-text">å¼€å§‹è¿›è¡Œä»£ç å®‰å…¨å®¡è®¡ï¼Œæ£€æµ‹æ½œåœ¨æ¼æ´</p>
                    </div>

                    <!-- è¾“å…¥åŒºåŸŸ -->
                    <div class="chat-input-container" data-container-mode="empty">
                        <div class="chat-input-wrapper">
                            <!-- è¾“å…¥æ¡†åŒºåŸŸ -->
                            <textarea
                                class="chat-input"
                                id="chatInput"
                                placeholder="è¾“å…¥ä»£ç æˆ–æè¿°éœ€è¦å®¡è®¡çš„é¡¹ç›®..."
                                rows="3"
                                readonly
                                disabled
                            >åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š</textarea>

                            <!-- å·¥å…·æ ï¼šå·¦ä¾§æ“ä½œæŒ‰é’® + å³ä¾§å‘é€æŒ‰é’® -->
                            <div class="chat-input-toolbar">
                                <div class="chat-input-actions">
                                    <div class="upload-dropdown-wrapper">
                                        <button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶" id="uploadBtn">
                                            ğŸ“
                                        </button>
                                        <div class="upload-dropdown" id="uploadDropdown">
                                            <button class="upload-option" data-upload-type="source">
                                                <span class="upload-icon">ğŸ“¦</span>
                                                <div class="upload-info">
                                                    <div class="upload-title">æºä»£ç åŒ…ä¸Šä¼ </div>
                                                    <div class="upload-desc">æ ¼å¼ï¼šzipã€tar.gz | å¤§å°ï¼š1G | æ•°é‡ï¼š1ä¸ª</div>
                                                </div>
                                            </button>
                                            <button class="upload-option" data-upload-type="git">
                                                <span class="upload-icon">ğŸ”—</span>
                                                <div class="upload-info">
                                                    <div class="upload-title">Gitä»“åº“</div>
                                                    <div class="upload-desc">æ”¯æŒGitLabã€GitHubï¼Œå¼€æºï¼Œæ— éœ€é…ç½®å¯†é’¥</div>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                    <button class="btn-icon" title="æ’å…¥å›¾ç‰‡">
                                        ğŸ–¼ï¸
                                    </button>
                                    <button class="btn-icon" title="æ’å…¥ä»£ç ">
                                        ğŸ’»
                                    </button>
                                    <button class="btn-icon" title="æ’å…¥è¡¨æ ¼">
                                        ğŸ“Š
                                    </button>
                                </div>
                                <button class="btn btn-primary chat-send" id="chatSend" disabled>
                                    <span>å‘é€</span>
                                    <span class="send-shortcut">Shift+Enter</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Gitä»“åº“è¿æ¥å¼¹å‡ºæ¡† -->
    <div class="modal-overlay" id="gitRepoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">è¿æ¥Gitä»“åº“</h3>
                <button class="modal-close" id="closeGitModal">&times;</button>
            </div>
            <div class="modal-warning">
                <span class="warning-icon">âš ï¸</span>
                <span class="warning-text">ç›®å‰ä»…æ”¯æŒå…¬å¼€çš„Gitä»“åº“ï¼Œå½“ä¸è®¾ç½®åˆ†æ”¯æ—¶ä½¿ç”¨é»˜è®¤åˆ†æ”¯ä»£ç </span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Gitä»“åº“åœ°å€ <span class="required">*</span></label>
                    <input type="text" class="form-input" id="gitRepoUrl" placeholder="https://github.com/username/repo.git æˆ– https://gitlab.com/username/repo.git">
                    <div class="form-hint">æ”¯æŒGitHubå’ŒGitLabå¼€æºä»“åº“</div>
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†æ”¯åç§° <span class="optional">ï¼ˆå¯é€‰ï¼‰</span></label>
                    <input type="text" class="form-input" id="gitBranch" placeholder="main æˆ– master">
                    <div class="form-hint">ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤åˆ†æ”¯</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-text" id="cancelGitModal">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmGitModal">è¿æ¥</button>
            </div>
        </div>
    </div>

    <!-- éšè—çš„æ–‡ä»¶ä¸Šä¼ è¾“å…¥æ¡† -->
    <input type="file" id="sourceFileInput" accept=".zip,.tar.gz" style="display: none;">

    <script src="../../js/dashboard.js"></script>
    <script src="../../components/agent-sidebar.js"></script>
    <script src="../../components/chat-input.js"></script>
    <script src="../../templates/js/template-detail.js"></script>
    <script>
        // æ¨¡æ‹Ÿä»»åŠ¡æ•°æ®
        const mockTasks = [
            { id: '1', name: 'Laravelé¡¹ç›®å®‰å…¨å®¡è®¡', status: 'running', active: false },
            { id: '2', name: 'Reactåº”ç”¨æ¼æ´æ‰«æ', status: 'running', active: false },
            { id: '3', name: 'Pythonä»£ç å®‰å…¨å®¡è®¡', status: 'completed', active: false },
            { id: '4', name: 'Spring Bootåº”ç”¨å®¡è®¡', status: 'failed', active: false },
            { id: '5', name: 'Node.jså®‰å…¨å’¨è¯¢', status: 'completed', active: false },
            { id: '6', name: 'Djangoé¡¹ç›®ä»£ç å®¡æŸ¥', status: 'completed', active: false },
            { id: '7', name: 'Vue.jså®‰å…¨æ‰«æ', status: 'completed', active: false },
            { id: '8', name: 'PHPä»£ç å®‰å…¨åˆ†æ', status: 'completed', active: false },
            { id: '9', name: 'Angularåº”ç”¨å®¡è®¡', status: 'completed', active: false },
            { id: '10', name: 'Java Webå®‰å…¨å’¨è¯¢', status: 'completed', active: false }
        ];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ä¾§å¯¼èˆªç»„ä»¶
            initAgentSidebar({
                tasks: mockTasks,
                maxTasks: 10,
                onNewTask: function() {
                    console.log('åˆ›å»ºæ–°ä»»åŠ¡');
                    // ç‚¹å‡»æ–°ä»»åŠ¡æŒ‰é’®æ—¶ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€é¡µé¢
                    var chatArea = document.querySelector('.agent-main-content');
                    if (!chatArea) return;

                    // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç©ºçŠ¶æ€å®¹å™¨
                    var emptyStateContainer = document.querySelector('.empty-state-container');
                    var taskContent = document.querySelector('.task-detail-content');
                    var tasksList = document.querySelector('.tasks-list-container');

                    // å¦‚æœå·²æœ‰ç©ºçŠ¶æ€å®¹å™¨ï¼Œç›´æ¥æ˜¾ç¤º
                    if (emptyStateContainer) {
                        emptyStateContainer.style.display = 'flex';
                        if (taskContent) taskContent.style.display = 'none';
                        if (tasksList) tasksList.style.display = 'none';
                        return;
                    }

                    // å¦åˆ™é‡æ–°åˆ›å»ºç©ºçŠ¶æ€é¡µé¢
                    chatArea.innerHTML = '<div class="empty-state-container">' +
                        '<div class="empty-agent-name">' +
                            '<span class="agent-name-text">AIæ¼æ´çŒäºº</span>' +
                        '</div>' +
                        '<div class="empty-state-guide">' +
                            '<p class="empty-state-guide-text">å¼€å§‹è¿›è¡Œä»£ç å®‰å…¨å®¡è®¡ï¼Œæ£€æµ‹æ½œåœ¨æ¼æ´</p>' +
                        '</div>' +
                        '<div class="chat-input-container" data-container-mode="empty">' +
                            '<div class="chat-input-wrapper">' +
                                '<textarea class="chat-input" id="chatInput" placeholder="è¾“å…¥ä»£ç æˆ–æè¿°éœ€è¦å®¡è®¡çš„é¡¹ç›®..." rows="3" readonly disabled>åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š</textarea>' +
                                '<div class="chat-input-toolbar">' +
                                    '<div class="chat-input-actions">' +
                                        '<div class="upload-dropdown-wrapper">' +
                                            '<button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶" id="uploadBtn">ğŸ“</button>' +
                                            '<div class="upload-dropdown" id="uploadDropdown">' +
                                                '<button class="upload-option" data-upload-type="source">' +
                                                    '<span class="upload-icon">ğŸ“¦</span>' +
                                                    '<div class="upload-info">' +
                                                        '<div class="upload-title">æºä»£ç åŒ…ä¸Šä¼ </div>' +
                                                        '<div class="upload-desc">æ ¼å¼ï¼šzipã€tar.gz | å¤§å°ï¼š1G | æ•°é‡ï¼š1ä¸ª</div>' +
                                                    '</div>' +
                                                '</button>' +
                                                '<button class="upload-option" data-upload-type="git">' +
                                                    '<span class="upload-icon">ğŸ”—</span>' +
                                                    '<div class="upload-info">' +
                                                        '<div class="upload-title">Gitä»“åº“</div>' +
                                                        '<div class="upload-desc">æ”¯æŒGitLabã€GitHubï¼Œå¼€æºï¼Œæ— éœ€é…ç½®å¯†é’¥</div>' +
                                                    '</div>' +
                                                '</button>' +
                                            '</div>' +
                                        '</div>' +
                                        '<button class="btn-icon" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸</button>' +
                                        '<button class="btn-icon" title="æ’å…¥ä»£ç ">ğŸ’»</button>' +
                                        '<button class="btn-icon" title="æ’å…¥è¡¨æ ¼">ğŸ“Š</button>' +
                                    '</div>' +
                                    '<button class="btn btn-primary chat-send" id="chatSend" disabled>' +
                                        '<span>å‘é€</span>' +
                                        '<span class="send-shortcut">Shift+Enter</span>' +
                                    '</button>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>';
                    
                    // é‡æ–°åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
                    initUploadFeature();
                },
                onTaskClick: function(taskId, taskData) {
                    console.log('[DEBUG] ç‚¹å‡»ä»»åŠ¡:', taskId, taskData);

                    try {
                        var chatArea = document.querySelector('.agent-main-content');
                        if (!chatArea) {
                            console.error('[DEBUG] æœªæ‰¾åˆ°chatArea');
                            return;
                        }

                        console.log('[DEBUG] æ‰¾åˆ°chatArea');

                        // æ¸…ç©ºchatAreaå†…å®¹ï¼Œé‡æ–°åˆ›å»ºä»»åŠ¡è¯¦æƒ…
                        var taskName = (taskData && taskData.name) ? taskData.name : 'æœªçŸ¥ä»»åŠ¡';

                        // æ¸…ç©ºchatAreaå¹¶é‡æ–°åˆ›å»ºä»»åŠ¡è¯¦æƒ…
                        chatArea.innerHTML = '';

                        var taskContent = document.createElement('div');
                        taskContent.className = 'task-detail-content';

                        taskContent.innerHTML = '<div class="chat-header">' +
                            '<div class="chat-title">' + taskName + '</div>' +
                            '<div style="display: flex; align-items: center; gap: 12px;">' +
                                '<div class="chat-time">åˆšåˆš</div>' +
                                '<button class="agent-space-btn" id="agentSpaceBtn">' +
                                    '<span>ğŸ”</span>' +
                                    '<span>æ™ºèƒ½ä½“ç©ºé—´</span>' +
                                '</button>' +
                            '</div>' +
                        '</div>' +
                        '<div class="chat-messages">' +
                            '<div class="message message-user">' +
                                '<div class="message-avatar">ğŸ‘¤</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">æˆ‘éœ€è¦å¯¹ä¸€ä¸ªWebåº”ç”¨è¿›è¡Œå®‰å…¨å®¡è®¡ï¼Œé‡ç‚¹å…³æ³¨SQLæ³¨å…¥å’ŒXSSæ¼æ´ã€‚</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="message message-ai">' +
                                '<div class="message-avatar">ğŸ¤–</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">ä½ å¥½ï¼æˆ‘æ˜¯AIæ¼æ´çŒäººï¼Œå°†ååŠ©ä½ è¿›è¡Œä»£ç å®‰å…¨å®¡è®¡ã€‚è¯·å‘Šè¯‰æˆ‘éœ€è¦å®¡è®¡çš„é¡¹ç›®ç±»å‹å’Œå…³æ³¨é‡ç‚¹ã€‚</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="message message-user">' +
                                '<div class="message-avatar">ğŸ‘¤</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">å…·ä½“éœ€è¦æ£€æŸ¥å“ªäº›æ–¹é¢ï¼Ÿ</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="message message-ai">' +
                                '<div class="message-avatar">ğŸ¤–</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">å¥½çš„ï¼Œæˆ‘å°†é‡ç‚¹æ£€æŸ¥ä»¥ä¸‹æ–¹é¢ï¼š<br>1. æ•°æ®åº“æŸ¥è¯¢è¯­å¥ä¸­çš„å‚æ•°åŒ–å¤„ç†<br>2. ç”¨æˆ·è¾“å…¥çš„è¿‡æ»¤å’Œè½¬ä¹‰<br>3. è¾“å‡ºå†…å®¹çš„HTMLç¼–ç <br>4. è®¤è¯å’Œæˆæƒæœºåˆ¶<br>5. æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="chat-input-container" data-container-mode="fixed">' +
                            '<div class="chat-input-wrapper">' +
                                '<textarea class="chat-input" placeholder="è¾“å…¥ä»£ç æˆ–æè¿°éœ€è¦å®¡è®¡çš„é¡¹ç›®..." rows="3" readonly disabled>åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š</textarea>' +
                                '<div class="chat-input-toolbar">' +
                                    '<div class="chat-input-actions">' +
                                        '<div class="upload-dropdown-wrapper">' +
                                            '<button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶" data-upload-btn>ğŸ“</button>' +
                                            '<div class="upload-dropdown">' +
                                                '<button class="upload-option" data-upload-type="source">' +
                                                    '<span class="upload-icon">ğŸ“¦</span>' +
                                                    '<div class="upload-info">' +
                                                        '<div class="upload-title">æºä»£ç åŒ…ä¸Šä¼ </div>' +
                                                        '<div class="upload-desc">æ ¼å¼ï¼šzipã€tar.gz | å¤§å°ï¼š1G | æ•°é‡ï¼š1ä¸ª</div>' +
                                                    '</div>' +
                                                '</button>' +
                                                '<button class="upload-option" data-upload-type="git">' +
                                                    '<span class="upload-icon">ğŸ”—</span>' +
                                                    '<div class="upload-info">' +
                                                        '<div class="upload-title">Gitä»“åº“</div>' +
                                                        '<div class="upload-desc">æ”¯æŒGitLabã€GitHubï¼Œå¼€æºï¼Œæ— éœ€é…ç½®å¯†é’¥</div>' +
                                                    '</div>' +
                                                '</button>' +
                                            '</div>' +
                                        '</div>' +
                                        '<button class="btn-icon" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸</button>' +
                                        '<button class="btn-icon" title="æ’å…¥ä»£ç ">ğŸ’»</button>' +
                                        '<button class="btn-icon" title="æ’å…¥è¡¨æ ¼">ğŸ“Š</button>' +
                                    '</div>' +
                                    '<button class="btn btn-primary chat-send" disabled>' +
                                        '<span>å‘é€</span>' +
                                        '<span class="send-shortcut">Shift+Enter</span>' +
                                    '</button>' +
                                '</div>' +
                            '</div>' +
                        '</div>';
                    
                    // é‡æ–°åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
                    initUploadFeature();

                    // åˆå§‹åŒ–æ™ºèƒ½ä½“ç©ºé—´
                    initAgentSpace();

                        chatArea.appendChild(taskContent);
                        taskContent.style.display = 'flex';

                        console.log('[DEBUG] ä»»åŠ¡è¯¦æƒ…å·²åˆ›å»ºå¹¶æ˜¾ç¤º');

                        // æ»šåŠ¨åˆ°åº•éƒ¨
                        setTimeout(function() {
                            var chatMessages = taskContent.querySelector('.chat-messages');
                            if (chatMessages) {
                                chatMessages.scrollTop = chatMessages.scrollHeight;
                            }
                        }, 100);
                    } catch (error) {
                        console.error('[DEBUG] é”™è¯¯:', error);
                    }
                },
                onViewAll: function() {
                    console.log('æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡');
                    showAllTasks();
                }
            });

            // åˆå§‹åŒ–èŠå¤©è¾“å…¥æ¡†ç»„ä»¶
            initChatInput({
                onSend: function(message) {
                    console.log('å‘é€æ¶ˆæ¯:', message);
                    // æ¨¡æ‹Ÿå‘é€ï¼Œå®é™…åº”è¯¥è°ƒç”¨API
                }
            });

            // åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
            initUploadFeature();
        });

        // åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
        function initUploadFeature() {
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†æ‰€æœ‰ä¸Šä¼ æŒ‰é’®
            document.addEventListener('click', function(e) {
                // å¤„ç†ä¸Šä¼ æŒ‰é’®ç‚¹å‡»
                if (e.target.closest('[data-upload-btn]') || e.target.closest('#uploadBtn')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const uploadWrapper = e.target.closest('.upload-dropdown-wrapper');
                    if (uploadWrapper) {
                        uploadWrapper.classList.toggle('active');
                    }
                }

                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ‰€æœ‰ä¸‹æ‹‰èœå•
                if (!e.target.closest('.upload-dropdown-wrapper')) {
                    document.querySelectorAll('.upload-dropdown-wrapper').forEach(wrapper => {
                        wrapper.classList.remove('active');
                    });
                }
            });

            const sourceFileInput = document.getElementById('sourceFileInput');
            const gitRepoModal = document.getElementById('gitRepoModal');
            const closeGitModal = document.getElementById('closeGitModal');
            const cancelGitModal = document.getElementById('cancelGitModal');
            const confirmGitModal = document.getElementById('confirmGitModal');
            const gitRepoUrl = document.getElementById('gitRepoUrl');
            const gitBranch = document.getElementById('gitBranch');

            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ä¸Šä¼ é€‰é¡¹ç‚¹å‡»
            document.addEventListener('click', function(e) {
                const uploadOption = e.target.closest('[data-upload-type]');
                if (uploadOption) {
                    e.preventDefault();
                    const uploadType = uploadOption.getAttribute('data-upload-type');
                    const uploadWrapper = uploadOption.closest('.upload-dropdown-wrapper');
                    if (uploadWrapper) {
                        uploadWrapper.classList.remove('active');
                    }

                    if (uploadType === 'source') {
                        if (sourceFileInput) {
                            sourceFileInput.click();
                        }
                    } else if (uploadType === 'git') {
                        openGitRepoModal();
                    }
                }
            });

            // æºä»£ç åŒ…ä¸Šä¼ 
            const sourceUploadOption = document.querySelector('[data-upload-type="source"]');
            if (sourceUploadOption && sourceFileInput) {
                sourceUploadOption.addEventListener('click', function(e) {
                    e.preventDefault();
                    uploadWrapper.classList.remove('active');
                    
                    // è§¦å‘æ–‡ä»¶é€‰æ‹©
                    sourceFileInput.click();
                });

                sourceFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        handleSourceFileUpload(file);
                    }
                });
            }

            // Gitä»“åº“ä¸Šä¼ 
            const gitUploadOption = document.querySelector('[data-upload-type="git"]');
            if (gitUploadOption) {
                gitUploadOption.addEventListener('click', function(e) {
                    e.preventDefault();
                    uploadWrapper.classList.remove('active');
                    openGitRepoModal();
                });
            }

            // æ‰“å¼€Gitä»“åº“å¼¹å‡ºæ¡†
            function openGitRepoModal() {
                if (gitRepoModal) {
                    gitRepoModal.classList.add('active');
                    if (gitRepoUrl) {
                        gitRepoUrl.focus();
                    }
                }
            }

            // å…³é—­Gitä»“åº“å¼¹å‡ºæ¡†
            function closeGitRepoModal() {
                if (gitRepoModal) {
                    gitRepoModal.classList.remove('active');
                    if (gitRepoUrl) gitRepoUrl.value = '';
                    if (gitBranch) gitBranch.value = '';
                }
            }

            // å…³é—­æŒ‰é’®äº‹ä»¶
            if (closeGitModal) {
                closeGitModal.addEventListener('click', closeGitRepoModal);
            }

            if (cancelGitModal) {
                cancelGitModal.addEventListener('click', closeGitRepoModal);
            }

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            if (gitRepoModal) {
                gitRepoModal.addEventListener('click', function(e) {
                    if (e.target === gitRepoModal) {
                        closeGitRepoModal();
                    }
                });
            }

            // ç¡®è®¤è¿æ¥Gitä»“åº“
            if (confirmGitModal) {
                confirmGitModal.addEventListener('click', function() {
                    const repoUrl = gitRepoUrl ? gitRepoUrl.value.trim() : '';
                    const branch = gitBranch ? gitBranch.value.trim() : '';

                    if (!repoUrl) {
                        alert('è¯·è¾“å…¥Gitä»“åº“åœ°å€');
                        return;
                    }

                    // éªŒè¯Gitä»“åº“åœ°å€æ ¼å¼
                    if (!isValidGitUrl(repoUrl)) {
                        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„Gitä»“åº“åœ°å€ï¼ˆGitHubæˆ–GitLabï¼‰');
                        return;
                    }

                    handleGitRepoConnect(repoUrl, branch);
                    closeGitRepoModal();
                });
            }

            // å¤„ç†æºä»£ç åŒ…ä¸Šä¼ 
            function handleSourceFileUpload(file) {
                // éªŒè¯æ–‡ä»¶æ ¼å¼
                const allowedExtensions = ['.zip', '.tar.gz'];
                const fileName = file.name.toLowerCase();
                const isValidFormat = allowedExtensions.some(ext => fileName.endsWith(ext));

                if (!isValidFormat) {
                    alert('æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä¸Šä¼  zip æˆ– tar.gz æ ¼å¼çš„æ–‡ä»¶');
                    sourceFileInput.value = '';
                    return;
                }

                // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ1G = 1024 * 1024 * 1024 bytesï¼‰
                const maxSize = 1024 * 1024 * 1024; // 1GB
                if (file.size > maxSize) {
                    alert('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼Œæœ€å¤§æ”¯æŒ 1G');
                    sourceFileInput.value = '';
                    return;
                }

                // æ˜¾ç¤ºä¸Šä¼ ä¿¡æ¯
                console.log('å¼€å§‹ä¸Šä¼ æºä»£ç åŒ…:', {
                    name: file.name,
                    size: formatFileSize(file.size),
                    type: file.type
                });

                // è¿™é‡Œå¯ä»¥æ·»åŠ ä¸Šä¼ é€»è¾‘
                // ä¾‹å¦‚ï¼šä½¿ç”¨ FormData ä¸Šä¼ åˆ°æœåŠ¡å™¨
                const formData = new FormData();
                formData.append('file', file);
                formData.append('type', 'source');

                // ç¤ºä¾‹ï¼šæ˜¾ç¤ºä¸Šä¼ æˆåŠŸæç¤º
                showUploadSuccess('æºä»£ç åŒ…ä¸Šä¼ æˆåŠŸ', file.name);

                // ä¸Šä¼ æˆåŠŸåè‡ªåŠ¨å‘èµ·ä»»åŠ¡
                setTimeout(() => {
                    autoStartTask('åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š');
                }, 500);

                // å®é™…åº”è¯¥è°ƒç”¨APIä¸Šä¼ 
                // uploadFile(formData);
            }

            // å¤„ç†Gitä»“åº“è¿æ¥
            function handleGitRepoConnect(repoUrl, branch) {
                console.log('è¿æ¥Gitä»“åº“:', {
                    url: repoUrl,
                    branch: branch || 'é»˜è®¤åˆ†æ”¯'
                });

                // è¿™é‡Œå¯ä»¥æ·»åŠ Gitä»“åº“è¿æ¥é€»è¾‘
                // ä¾‹å¦‚ï¼šè°ƒç”¨APIè¿æ¥ä»“åº“
                showUploadSuccess('Gitä»“åº“è¿æ¥æˆåŠŸ', repoUrl);

                // è¿æ¥æˆåŠŸåè‡ªåŠ¨å‘èµ·ä»»åŠ¡
                setTimeout(() => {
                    autoStartTask('åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š');
                }, 500);

                // å®é™…åº”è¯¥è°ƒç”¨APIè¿æ¥
                // connectGitRepo(repoUrl, branch);
            }

            // éªŒè¯Git URLæ ¼å¼
            function isValidGitUrl(url) {
                // æ”¯æŒ GitHub å’Œ GitLab çš„ HTTPS URL
                const githubPattern = /^https:\/\/github\.com\/[\w\.-]+\/[\w\.-]+(\.git)?$/;
                const gitlabPattern = /^https:\/\/gitlab\.com\/[\w\.-]+\/[\w\.-]+(\.git)?$/;
                return githubPattern.test(url) || gitlabPattern.test(url);
            }

            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
            }

            // æ˜¾ç¤ºä¸Šä¼ æˆåŠŸæç¤º
            function showUploadSuccess(message, detail) {
                // åˆ›å»ºæç¤ºå…ƒç´ 
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 24px;
                    background: #10B981;
                    color: white;
                    border-radius: 6px;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    z-index: 10001;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message + ': ' + detail;
                document.body.appendChild(notification);

                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        }

        // æ˜¾ç¤ºå…¨éƒ¨ä»»åŠ¡åˆ—è¡¨
        function showAllTasks() {
            var chatArea = document.querySelector('.agent-main-content');
            if (!chatArea) return;

            // ç”Ÿæˆä»»åŠ¡åˆ—è¡¨HTML
            var tasksHtml = '';
            for (var i = 0; i < mockTasks.length; i++) {
                var task = mockTasks[i];
                var statusIcon = task.status === 'running' ? 'â³' :
                                task.status === 'completed' ? 'âœ…' : 'âŒ';
                var statusClass = task.status;

                tasksHtml += '<div class="task-record-card" data-task-id="' + task.id + '">' +
                    '<div class="task-record-left">' +
                        '<div class="task-record-header">' +
                            '<div class="task-record-status">' +
                                '<span class="task-status-badge ' + statusClass + '">' + statusIcon + '</span>' +
                            '</div>' +
                            '<div class="task-record-name">' + task.name + '</div>' +
                        '</div>' +
                        '<div class="task-record-statistics">' +
                            '<span class="statistics-label">æ¶ˆæ¯æ•°</span>' +
                            '<span class="statistics-value">' + (4 + Math.floor(Math.random() * 6)) + ' æ¡</span>' +
                        '</div>' +
                    '</div>' +
                    '<div class="task-record-right">' +
                        '<div class="task-record-time">2025-12-19 14:30</div>' +
                        '<div class="task-record-actions">' +
                            '<button class="task-action-btn">æŸ¥çœ‹</button>' +
                            '<button class="task-action-btn">åˆ é™¤</button>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }

            if (mockTasks.length === 0) {
                tasksHtml = '<div class="tasks-empty">æš‚æ— ä»»åŠ¡è®°å½•</div>';
            }

            // æ›¿æ¢å†…å®¹
            chatArea.innerHTML = '<div class="tasks-list-container">' +
                '<div class="tasks-list-header">' +
                    '<h2 class="tasks-list-title">å…¨éƒ¨ä»»åŠ¡è®°å½•</h2>' +
                '</div>' +
                '<div class="tasks-list-content">' +
                    tasksHtml +
                '</div>' +
            '</div>';

            // ç»‘å®šä»»åŠ¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
            var taskCards = chatArea.querySelectorAll('.task-record-card');
            for (var i = 0; i < taskCards.length; i++) {
                taskCards[i].addEventListener('click', function(e) {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘å¡ç‰‡ç‚¹å‡»
                    if (e.target.classList.contains('task-action-btn')) {
                        e.stopPropagation();
                        var btnText = e.target.textContent;
                        var taskId = this.getAttribute('data-task-id');

                        if (btnText === 'æŸ¥çœ‹') {
                            // æŸ¥æ‰¾å¯¹åº”çš„ä»»åŠ¡å¹¶æ˜¾ç¤ºè¯¦æƒ…
                            var selectedTask = null;
                            for (var j = 0; j < mockTasks.length; j++) {
                                if (mockTasks[j].id === taskId) {
                                    selectedTask = mockTasks[j];
                                    break;
                                }
                            }

                            if (selectedTask) {
                                // è°ƒç”¨ç°æœ‰çš„ä»»åŠ¡ç‚¹å‡»å›è°ƒ
                                var sidebarInstance = window.agentSidebarInstance;
                                if (sidebarInstance && sidebarInstance.setActiveTask) {
                                    sidebarInstance.setActiveTask(taskId);
                                }

                                // æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…ï¼ˆå¤ç”¨ä¹‹å‰çš„ä»£ç ï¼‰
                                showTaskDetailById(taskId, selectedTask);
                            }
                        } else if (btnText === 'åˆ é™¤') {
                            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å—ï¼Ÿ')) {
                                console.log('åˆ é™¤ä»»åŠ¡:', taskId);
                            }
                        }
                        return;
                    }

                    // ç‚¹å‡»å¡ç‰‡å…¶ä»–åŒºåŸŸï¼Œæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
                    var taskId = this.getAttribute('data-task-id');
                    var selectedTask = null;
                    for (var j = 0; j < mockTasks.length; j++) {
                        if (mockTasks[j].id === taskId) {
                            selectedTask = mockTasks[j];
                            break;
                        }
                    }

                    if (selectedTask) {
                        showTaskDetailById(taskId, selectedTask);
                    }
                });
            }
        }

        // æ ¹æ®ä»»åŠ¡IDæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
        function showTaskDetailById(taskId, taskData) {
            var chatArea = document.querySelector('.agent-main-content');
            if (!chatArea) return;

            var taskName = taskData ? taskData.name : 'æœªçŸ¥ä»»åŠ¡';

            var taskContent = document.createElement('div');
            taskContent.className = 'task-detail-content';

            taskContent.innerHTML = '<div class="chat-header">' +
                '<div class="chat-title">' + taskName + '</div>' +
                '<div style="display: flex; align-items: center; gap: 12px;">' +
                    '<div class="chat-time">åˆšåˆš</div>' +
                    '<button class="agent-space-btn" id="agentSpaceBtn">' +
                        '<span>ğŸ”</span>' +
                        '<span>æ™ºèƒ½ä½“ç©ºé—´</span>' +
                    '</button>' +
                '</div>' +
            '</div>' +
            '<div class="chat-messages">' +
                '<div class="message message-user">' +
                    '<div class="message-avatar">ğŸ‘¤</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">æˆ‘éœ€è¦å¯¹ä¸€ä¸ªWebåº”ç”¨è¿›è¡Œå®‰å…¨å®¡è®¡ï¼Œé‡ç‚¹å…³æ³¨SQLæ³¨å…¥å’ŒXSSæ¼æ´ã€‚</div>' +
                    '</div>' +
                '</div>' +
                '<div class="message message-ai">' +
                    '<div class="message-avatar">ğŸ¤–</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">ä½ å¥½ï¼æˆ‘æ˜¯AIæ¼æ´çŒäººï¼Œå°†ååŠ©ä½ è¿›è¡Œä»£ç å®‰å…¨å®¡è®¡ã€‚è¯·å‘Šè¯‰æˆ‘éœ€è¦å®¡è®¡çš„é¡¹ç›®ç±»å‹å’Œå…³æ³¨é‡ç‚¹ã€‚</div>' +
                    '</div>' +
                '</div>' +
                '<div class="message message-user">' +
                    '<div class="message-avatar">ğŸ‘¤</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">å…·ä½“éœ€è¦æ£€æŸ¥å“ªäº›æ–¹é¢ï¼Ÿ</div>' +
                    '</div>' +
                '</div>' +
                '<div class="message message-ai">' +
                    '<div class="message-avatar">ğŸ¤–</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">å¥½çš„ï¼Œæˆ‘å°†é‡ç‚¹æ£€æŸ¥ä»¥ä¸‹æ–¹é¢ï¼š<br>1. æ•°æ®åº“æŸ¥è¯¢è¯­å¥ä¸­çš„å‚æ•°åŒ–å¤„ç†<br>2. ç”¨æˆ·è¾“å…¥çš„è¿‡æ»¤å’Œè½¬ä¹‰<br>3. è¾“å‡ºå†…å®¹çš„HTMLç¼–ç <br>4. è®¤è¯å’Œæˆæƒæœºåˆ¶<br>5. æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©</div>' +
                    '</div>' +
                '</div>' +
            '</div>' +
            '<div class="chat-input-container" data-container-mode="fixed">' +
                '<div class="chat-input-wrapper">' +
                    '<textarea class="chat-input" placeholder="è¾“å…¥ä»£ç æˆ–æè¿°éœ€è¦å®¡è®¡çš„é¡¹ç›®..." rows="3" readonly disabled>åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š</textarea>' +
                    '<div class="chat-input-toolbar">' +
                        '<div class="chat-input-actions">' +
                            '<div class="upload-dropdown-wrapper">' +
                                '<button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶" data-upload-btn>ğŸ“</button>' +
                                '<div class="upload-dropdown">' +
                                    '<button class="upload-option" data-upload-type="source">' +
                                        '<span class="upload-icon">ğŸ“¦</span>' +
                                        '<div class="upload-info">' +
                                            '<div class="upload-title">æºä»£ç åŒ…ä¸Šä¼ </div>' +
                                            '<div class="upload-desc">æ ¼å¼ï¼šzipã€tar.gz | å¤§å°ï¼š1G | æ•°é‡ï¼š1ä¸ª</div>' +
                                        '</div>' +
                                    '</button>' +
                                    '<button class="upload-option" data-upload-type="git">' +
                                        '<span class="upload-icon">ğŸ”—</span>' +
                                        '<div class="upload-info">' +
                                            '<div class="upload-title">Gitä»“åº“</div>' +
                                            '<div class="upload-desc">æ”¯æŒGitLabã€GitHubï¼Œå¼€æºï¼Œæ— éœ€é…ç½®å¯†é’¥</div>' +
                                        '</div>' +
                                    '</button>' +
                                '</div>' +
                            '</div>' +
                            '<button class="btn-icon" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸</button>' +
                            '<button class="btn-icon" title="æ’å…¥ä»£ç ">ğŸ’»</button>' +
                            '<button class="btn-icon" title="æ’å…¥è¡¨æ ¼">ğŸ“Š</button>' +
                        '</div>' +
                        '<button class="btn btn-primary chat-send">' +
                            '<span>å‘é€</span>' +
                            '<span class="send-shortcut">Shift+Enter</span>' +
                        '</button>' +
                    '</div>' +
                '</div>' +
            '</div>';
            
            // é‡æ–°åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
            initUploadFeature();

            // åˆå§‹åŒ–æ™ºèƒ½ä½“ç©ºé—´
            initAgentSpace();

            chatArea.innerHTML = '';
            chatArea.appendChild(taskContent);
            taskContent.style.display = 'flex';

            // æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(function() {
                var chatMessages = taskContent.querySelector('.chat-messages');
                if (chatMessages) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }, 100);
        }

        // å¿«é€Ÿæç¤ºå¡«å……åŠŸèƒ½
        function fillPrompt(text) {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = text;
                input.focus();
            }
        }

        // è‡ªåŠ¨å‘èµ·ä»»åŠ¡
        function autoStartTask(message) {
            console.log('è‡ªåŠ¨å‘èµ·ä»»åŠ¡:', message);
            
            // è·å–å½“å‰è¾“å…¥æ¡†
            const chatInput = document.querySelector('.chat-input');
            if (!chatInput) {
                console.warn('æœªæ‰¾åˆ°è¾“å…¥æ¡†');
                return;
            }

            // å¦‚æœå½“å‰æ˜¯ç©ºçŠ¶æ€ï¼Œéœ€è¦å…ˆåˆ›å»ºä»»åŠ¡ç•Œé¢
            const emptyStateContainer = document.querySelector('.empty-state-container');
            if (emptyStateContainer) {
                // åˆ›å»ºæ–°ä»»åŠ¡ç•Œé¢
                const chatArea = document.querySelector('.agent-main-content');
                if (!chatArea) return;

                // åˆ›å»ºä»»åŠ¡è¯¦æƒ…ç•Œé¢
                const taskContent = document.createElement('div');
                taskContent.className = 'task-detail-content';

                const taskName = 'ä»£ç å®‰å…¨å®¡è®¡ - ' + new Date().toLocaleString('zh-CN', { 
                    month: '2-digit', 
                    day: '2-digit', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                taskContent.innerHTML = '<div class="chat-header">' +
                    '<div class="chat-title">' + taskName + '</div>' +
                    '<div style="display: flex; align-items: center; gap: 12px;">' +
                        '<div class="chat-time">åˆšåˆš</div>' +
                        '<button class="agent-space-btn" id="agentSpaceBtn">' +
                            '<span>ğŸ”</span>' +
                            '<span>æ™ºèƒ½ä½“ç©ºé—´</span>' +
                        '</button>' +
                    '</div>' +
                '</div>' +
                '<div class="task-main-wrapper">' +
                    '<div class="agent-log-container" id="agentLogContainer"></div>' +
                    '<div class="agent-space-sidebar" id="agentSpaceSidebar">' +
                        '<div class="resize-handle" id="resizeHandle"></div>' +
                        '<div class="agent-space-sidebar-header">' +
                            '<h3 class="agent-space-sidebar-title">æ™ºèƒ½ä½“ç©ºé—´</h3>' +
                            '<button class="agent-space-sidebar-close" id="closeAgentSpace">&times;</button>' +
                        '</div>' +
                        '<div class="agent-space-sidebar-body">' +
                            '<div class="agent-space-tabs">' +
                                '<button class="agent-space-tab active" data-tab="execution">æ‰§è¡Œ</button>' +
                                '<button class="agent-space-tab" data-tab="code">ä»£ç </button>' +
                                '<button class="agent-space-tab" data-tab="artifacts">äº§ç‰©</button>' +
                            '</div>' +
                            '<div class="agent-space-tab-content active" data-content="execution" id="agentSpaceExecution">' +
                                '<div class="execution-container">' +
                                    '<div class="execution-placeholder" id="executionPlaceholder">' +
                                        '<div class="placeholder-icon">âš™ï¸</div>' +
                                        '<div class="placeholder-text">ç­‰å¾…æ‰§è¡Œä»»åŠ¡...</div>' +
                                    '</div>' +
                                    '<div class="execution-content" id="executionContent" style="display: none;">' +
                                        '<div class="execution-header">' +
                                            '<div class="execution-target">' +
                                                '<span class="target-value" id="executionTarget"></span>' +
                                            '</div>' +
                                        '</div>' +
                                        '<div class="execution-details">' +
                                            '<div class="execution-detail-item">' +
                                                '<span class="detail-label">ä»»åŠ¡çŠ¶æ€ï¼š</span>' +
                                                '<span class="detail-value" id="executionStatus"></span>' +
                                            '</div>' +
                                            '<div class="execution-detail-item">' +
                                                '<span class="detail-label">ä»»åŠ¡IDï¼š</span>' +
                                                '<span class="detail-value" id="executionTaskId"></span>' +
                                            '</div>' +
                                            '<div class="execution-detail-item">' +
                                                '<span class="detail-label">æ½œåœ¨é£é™©ç±»å‹ï¼š</span>' +
                                                '<span class="detail-value" id="executionRiskType"></span>' +
                                            '</div>' +
                                            '<div class="execution-detail-item full-width">' +
                                                '<span class="detail-label">é¡¹ç›®æ¦‚è¿°ï¼š</span>' +
                                                '<div class="detail-value" id="executionOverview"></div>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                    '<div class="execution-progress-bar">' +
                                        '<button class="progress-nav-btn" id="progressPrevBtn" title="ä¸Šä¸€æ­¥" disabled>â—€</button>' +
                                        '<div class="progress-track" id="progressTrack">' +
                                            '<div class="progress-steps" id="progressSteps"></div>' +
                                            '<div class="progress-fill" id="progressFill"></div>' +
                                        '</div>' +
                                        '<button class="progress-nav-btn" id="progressNextBtn" title="ä¸‹ä¸€æ­¥" disabled>â–¶</button>' +
                                        '<div class="progress-status">å®æ—¶</div>' +
                                    '</div>' +
                                    '<div class="execution-task-info">' +
                                        '<div class="task-status-icon" id="taskStatusIcon">' +
                                            '<span class="loading-spinner"></span>' +
                                        '</div>' +
                                        '<div class="task-progress-text">' +
                                            '<span class="task-current" id="taskCurrent">å½“å‰ä»»åŠ¡ 0/5</span>' +
                                            '<span class="task-name" id="taskName">æ•´ç†é£é™©æŠ¥å‘Š</span>' +
                                        '</div>' +
                                        '<div class="task-toggle" id="taskToggle">' +
                                            '<span class="task-toggle-icon">âŒ„</span>' +
                                        '</div>' +
                                        '<div class="task-rules" id="taskRules"></div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="agent-space-tab-content" data-content="code">' +
                                '<div class="code-viewer-container">' +
                                    '<div class="code-viewer-sidebar">' +
                                        '<div class="code-viewer-title">å·¥ç¨‹ç›®å½•</div>' +
                                        '<ul class="file-tree" id="agentSpaceCodeTree"></ul>' +
                                    '</div>' +
                                    '<div class="code-viewer-main">' +
                                        '<div class="code-viewer-placeholder" id="codeViewerPlaceholder">' +
                                            '<div class="placeholder-icon">ğŸ“„</div>' +
                                            '<div class="placeholder-text">è¯·é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹ä»£ç </div>' +
                                        '</div>' +
                                        '<div class="code-viewer-content" id="codeViewerContent" style="display: none;">' +
                                            '<div class="code-viewer-header">' +
                                                '<span class="code-file-name" id="codeFileName"></span>' +
                                            '</div>' +
                                            '<div class="code-viewer-body">' +
                                                '<pre class="code-block"><code id="codeContent"></code></pre>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="agent-space-tab-content" data-content="artifacts" id="agentSpaceArtifactFiles"></div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="chat-input-container" data-container-mode="fixed">' +
                    '<div class="chat-input-wrapper">' +
                        '<textarea class="chat-input" placeholder="è¾“å…¥ä»£ç æˆ–æè¿°éœ€è¦å®¡è®¡çš„é¡¹ç›®..." rows="3" readonly disabled>åŸºäºæˆ‘é…ç½®çš„ä»£ç æ–‡ä»¶ï¼Œåˆ†ææœ‰å“ªäº›çœŸå®é«˜å±æ¼æ´å¹¶è¾“å‡ºæ¼æ´æŠ¥å‘Š</textarea>' +
                        '<div class="chat-input-toolbar">' +
                            '<div class="chat-input-actions">' +
                                '<div class="upload-dropdown-wrapper">' +
                                    '<button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶" data-upload-btn>ğŸ“</button>' +
                                    '<div class="upload-dropdown">' +
                                        '<button class="upload-option" data-upload-type="source">' +
                                            '<span class="upload-icon">ğŸ“¦</span>' +
                                            '<div class="upload-info">' +
                                                '<div class="upload-title">æºä»£ç åŒ…ä¸Šä¼ </div>' +
                                                '<div class="upload-desc">æ ¼å¼ï¼šzipã€tar.gz | å¤§å°ï¼š1G | æ•°é‡ï¼š1ä¸ª</div>' +
                                            '</div>' +
                                        '</button>' +
                                        '<button class="upload-option" data-upload-type="git">' +
                                            '<span class="upload-icon">ğŸ”—</span>' +
                                            '<div class="upload-info">' +
                                                '<div class="upload-title">Gitä»“åº“</div>' +
                                                '<div class="upload-desc">æ”¯æŒGitLabã€GitHubï¼Œå¼€æºï¼Œæ— éœ€é…ç½®å¯†é’¥</div>' +
                                            '</div>' +
                                        '</button>' +
                                    '</div>' +
                                '</div>' +
                                '<button class="btn-icon" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸</button>' +
                                '<button class="btn-icon" title="æ’å…¥ä»£ç ">ğŸ’»</button>' +
                                '<button class="btn-icon" title="æ’å…¥è¡¨æ ¼">ğŸ“Š</button>' +
                            '</div>' +
                            '<button class="btn btn-primary chat-send" disabled>' +
                                '<span>å‘é€</span>' +
                                '<span class="send-shortcut">Shift+Enter</span>' +
                            '</button>' +
                        '</div>' +
                    '</div>' +
                '</div>';

                chatArea.innerHTML = '';
                chatArea.appendChild(taskContent);
                taskContent.style.display = 'flex';

                // é‡æ–°åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½
                initUploadFeature();

                // åˆå§‹åŒ–æ™ºèƒ½ä½“ç©ºé—´
                initAgentSpace();

                // åˆå§‹åŒ–è¿›åº¦æ¡
                initProgressBar();

                // é‡ç½®æ‰§è¡Œæ­¥éª¤
                executionSteps = [];
                currentStepIndex = -1;
                currentTaskIndex = 0;
                
                // åˆå§‹åŒ–ä»»åŠ¡ä¿¡æ¯æ˜¾ç¤º
                updateTaskInfo();

                // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
                simulateAIAnalysis(taskContent);
            } else {
                // å¦‚æœå·²ç»æœ‰ä»»åŠ¡ç•Œé¢ï¼Œç›´æ¥æ·»åŠ æ¶ˆæ¯
                const chatMessages = document.querySelector('.chat-messages');
                if (chatMessages) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message message-user';
                    messageDiv.innerHTML = '<div class="message-avatar">ğŸ‘¤</div>' +
                        '<div class="message-content">' +
                            '<div class="message-time">åˆšåˆš</div>' +
                            '<div class="message-text">' + message + '</div>' +
                        '</div>';
                    chatMessages.appendChild(messageDiv);

                    // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
                    simulateAIAnalysis(taskContent);
                }
            }

            // è¿™é‡Œå¯ä»¥è°ƒç”¨å®é™…çš„APIå‘é€æ¶ˆæ¯
            // sendMessageToAPI(message);
        }

        // åˆå§‹åŒ–æ™ºèƒ½ä½“ç©ºé—´
        function initAgentSpace() {
            const agentSpaceBtn = document.getElementById('agentSpaceBtn');
            const agentSpaceSidebar = document.getElementById('agentSpaceSidebar');
            const closeAgentSpace = document.getElementById('closeAgentSpace');
            const resizeHandle = document.getElementById('resizeHandle');

            if (!agentSpaceBtn || !agentSpaceSidebar) return;

            // æ‰“å¼€/å…³é—­æ™ºèƒ½ä½“ç©ºé—´
            agentSpaceBtn.addEventListener('click', () => {
                const isActive = agentSpaceSidebar.classList.contains('active');
                if (isActive) {
                    agentSpaceSidebar.classList.remove('active');
                } else {
                    agentSpaceSidebar.classList.add('active');
                    // åˆå§‹åŒ–å·¥ä½œç©ºé—´å†…å®¹
                    const codeTree = document.getElementById('agentSpaceCodeTree');
                    const artifactFiles = document.getElementById('agentSpaceArtifactFiles');
                    initWorkspaceContent(codeTree, artifactFiles);
                }
            });

            // å…³é—­æ™ºèƒ½ä½“ç©ºé—´
            if (closeAgentSpace) {
                closeAgentSpace.addEventListener('click', () => {
                    agentSpaceSidebar.classList.remove('active');
                });
            }

            // æ‹–æ‹½è°ƒæ•´å®½åº¦
            if (resizeHandle) {
                let isResizing = false;
                let startX = 0;
                let startWidth = 0;

                resizeHandle.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    startX = e.clientX;
                    startWidth = agentSpaceSidebar.offsetWidth;
                    resizeHandle.classList.add('resizing');
                    document.body.style.cursor = 'col-resize';
                    document.body.style.userSelect = 'none';
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    
                    const diff = startX - e.clientX; // å‘å³æ‹–æ‹½æ˜¯å‡å°å®½åº¦
                    const newWidth = Math.max(300, Math.min(800, startWidth + diff));
                    agentSpaceSidebar.style.width = newWidth + 'px';
                });

                document.addEventListener('mouseup', () => {
                    if (isResizing) {
                        isResizing = false;
                        resizeHandle.classList.remove('resizing');
                        document.body.style.cursor = '';
                        document.body.style.userSelect = '';
                    }
                });
            }
        }

        // åˆå§‹åŒ–å·¥ä½œç©ºé—´å†…å®¹
        function initWorkspaceContent(codeTree, artifactFiles) {
            // åˆå§‹åŒ–Tabåˆ‡æ¢
            const agentSpaceSidebar = document.getElementById('agentSpaceSidebar');
            if (agentSpaceSidebar) {
                const tabs = agentSpaceSidebar.querySelectorAll('.agent-space-tab');
                const contents = agentSpaceSidebar.querySelectorAll('.agent-space-tab-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetTab = tab.getAttribute('data-tab');
                        
                        // åˆ‡æ¢tabçŠ¶æ€
                        tabs.forEach(t => t.classList.remove('active'));
                        contents.forEach(c => c.classList.remove('active'));
                        
                        tab.classList.add('active');
                        agentSpaceSidebar.querySelector(`[data-content="${targetTab}"]`).classList.add('active');
                    });
                });
            }

            if (codeTree && codeTree.children.length === 0) {
                // æ¨¡æ‹Ÿä»£ç ç»“æ„
                const codeStructure = [
                    { name: 'src', type: 'folder', children: [
                        { name: 'controllers', type: 'folder', children: [
                            { name: 'UserController.php', type: 'file', path: 'src/controllers/UserController.php' },
                            { name: 'AuthController.php', type: 'file', path: 'src/controllers/AuthController.php' },
                            { name: 'ProfileController.php', type: 'file', path: 'src/controllers/ProfileController.php' }
                        ]},
                        { name: 'views', type: 'folder', children: [
                            { name: 'profile.html', type: 'file', path: 'src/views/profile.html' },
                            { name: 'login.html', type: 'file', path: 'src/views/login.html' },
                            { name: 'dashboard.html', type: 'file', path: 'src/views/dashboard.html' }
                        ]},
                        { name: 'utils', type: 'folder', children: [
                            { name: 'FileHandler.java', type: 'file', path: 'src/utils/FileHandler.java' },
                            { name: 'Validator.js', type: 'file', path: 'src/utils/Validator.js' },
                            { name: 'SecurityHelper.php', type: 'file', path: 'src/utils/SecurityHelper.php' }
                        ]},
                        { name: 'models', type: 'folder', children: [
                            { name: 'User.php', type: 'file', path: 'src/models/User.php' },
                            { name: 'Session.php', type: 'file', path: 'src/models/Session.php' }
                        ]}
                    ]},
                    { name: 'config', type: 'folder', children: [
                        { name: 'database.php', type: 'file', path: 'config/database.php' },
                        { name: 'app.php', type: 'file', path: 'config/app.php' },
                        { name: 'security.php', type: 'file', path: 'config/security.php' }
                    ]},
                    { name: 'public', type: 'folder', children: [
                        { name: 'index.php', type: 'file', path: 'public/index.php' },
                        { name: '.htaccess', type: 'file', path: 'public/.htaccess' }
                    ]},
                    { name: 'tests', type: 'folder', children: [
                        { name: 'UserControllerTest.php', type: 'file', path: 'tests/UserControllerTest.php' },
                        { name: 'SecurityTest.php', type: 'file', path: 'tests/SecurityTest.php' }
                    ]}
                ];

                renderFileTree(codeTree, codeStructure);
            }

            if (artifactFiles && artifactFiles.innerHTML === '') {
                // æ˜¾ç¤ºä»£ç å®‰å…¨å®¡è®¡ç”Ÿæˆçš„æŠ¥å‘Šåˆ—è¡¨ï¼ˆå¸¦æ–‡ä»¶å¤¹ç»“æ„ï¼‰
                let reportsHTML = '<div class="artifact-reports-list">';
                
                // ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼šé¡¹ç›®è®°å¿†
                reportsHTML += 
                    '<div class="artifact-folder" data-folder="project-memory">' +
                        '<div class="artifact-folder-header">' +
                            '<span class="folder-expand-icon">â–¶</span>' +
                            '<span class="folder-icon">ğŸ“</span>' +
                            '<span class="folder-name">é¡¹ç›®è®°å¿†</span>' +
                        '</div>' +
                        '<div class="artifact-folder-content" style="display: none;">' +
                            '<div class="artifact-report-item" data-file="é¡¹ç›®åŠŸèƒ½æ€»ç»“.md">' +
                                '<span class="report-icon">ğŸ“„</span>' +
                                '<span class="report-name">é¡¹ç›®åŠŸèƒ½æ€»ç»“.md</span>' +
                            '</div>' +
                            '<div class="artifact-report-item" data-file="æ¼æ´ç ”åˆ¤ä»»åŠ¡æ¸…å•.md">' +
                                '<span class="report-icon">ğŸ“„</span>' +
                                '<span class="report-name">æ¼æ´ç ”åˆ¤ä»»åŠ¡æ¸…å•.md</span>' +
                            '</div>' +
                        '</div>' +
                    '</div>';
                
                // ç¬¬äºŒä¸ªæ–‡ä»¶å¤¹ï¼šæ¼æ´æŠ¥å‘Š
                reportsHTML += 
                    '<div class="artifact-folder" data-folder="vulnerability-reports">' +
                        '<div class="artifact-folder-header">' +
                            '<span class="folder-expand-icon">â–¶</span>' +
                            '<span class="folder-icon">ğŸ“</span>' +
                            '<span class="folder-name">æ¼æ´æŠ¥å‘Š</span>' +
                        '</div>' +
                        '<div class="artifact-folder-content" style="display: none;">' +
                            '<div class="artifact-report-item" data-file="SQLæ³¨å…¥æ¼æ´-CWE-89.md">' +
                                '<span class="report-icon">ğŸ›</span>' +
                                '<span class="report-name">SQLæ³¨å…¥æ¼æ´-CWE-89.md</span>' +
                            '</div>' +
                            '<div class="artifact-report-item" data-file="XSSè·¨ç«™è„šæœ¬æ”»å‡»-CWE-79.md">' +
                                '<span class="report-icon">ğŸ›</span>' +
                                '<span class="report-name">XSSè·¨ç«™è„šæœ¬æ”»å‡»-CWE-79.md</span>' +
                            '</div>' +
                            '<div class="artifact-report-item" data-file="å‘½ä»¤æ³¨å…¥æ¼æ´-CWE-78.md">' +
                                '<span class="report-icon">ğŸ›</span>' +
                                '<span class="report-name">å‘½ä»¤æ³¨å…¥æ¼æ´-CWE-78.md</span>' +
                            '</div>' +
                            '<div class="artifact-report-item" data-file="è·¯å¾„éå†æ¼æ´-CWE-22.md">' +
                                '<span class="report-icon">ğŸ›</span>' +
                                '<span class="report-name">è·¯å¾„éå†æ¼æ´-CWE-22.md</span>' +
                            '</div>' +
                            '<div class="artifact-report-item" data-file="æ•æ„Ÿä¿¡æ¯æ³„éœ²-CWE-200.md">' +
                                '<span class="report-icon">ğŸ›</span>' +
                                '<span class="report-name">æ•æ„Ÿä¿¡æ¯æ³„éœ²-CWE-200.md</span>' +
                            '</div>' +
                        '</div>' +
                    '</div>';
                
                // æœ€ä¸‹é¢çš„æŠ¥å‘Šï¼šé¡¹ç›®é£é™©åˆ†ææ€»ç»“æŠ¥å‘Š
                reportsHTML += 
                    '<div class="artifact-report-item" data-file="é¡¹ç›®é£é™©åˆ†ææ€»ç»“æŠ¥å‘Š.md">' +
                        '<span class="report-icon">ğŸ“Š</span>' +
                        '<span class="report-name">é¡¹ç›®é£é™©åˆ†ææ€»ç»“æŠ¥å‘Š.md</span>' +
                    '</div>';
                
                reportsHTML += '</div>';

                artifactFiles.innerHTML = reportsHTML;

                // ç»‘å®šæ–‡ä»¶å¤¹å±•å¼€/æŠ˜å äº‹ä»¶
                artifactFiles.querySelectorAll('.artifact-folder-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const folder = header.closest('.artifact-folder');
                        const content = folder.querySelector('.artifact-folder-content');
                        const expandIcon = header.querySelector('.folder-expand-icon');
                        const isExpanded = content.style.display !== 'none';
                        
                        if (isExpanded) {
                            content.style.display = 'none';
                            expandIcon.textContent = 'â–¶';
                        } else {
                            content.style.display = 'block';
                            expandIcon.textContent = 'â–¼';
                        }
                    });
                });

                // ç»‘å®šæŠ¥å‘Šç‚¹å‡»äº‹ä»¶
                artifactFiles.querySelectorAll('.artifact-report-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const fileName = item.getAttribute('data-file');
                        console.log('æŸ¥çœ‹æŠ¥å‘Š:', fileName);
                        // è¿™é‡Œå¯ä»¥æ‰“å¼€æŠ¥å‘ŠæŸ¥çœ‹å™¨
                    });
                });
            }
        }

        // æ¸²æŸ“æ–‡ä»¶æ ‘ - å‘ä¸‹æ’åˆ—ç»“æ„
        function renderFileTree(container, structure, level = 0) {
            structure.forEach(item => {
                const li = document.createElement('li');
                li.className = 'file-tree-item';
                
                const icon = item.type === 'folder' ? 'ğŸ“' : 'ğŸ“„';
                const expandIcon = item.type === 'folder' ? '<span class="folder-expand">â–¶</span>' : '<span style="width: 12px; display: inline-block;"></span>';
                li.innerHTML = `${expandIcon}<span class="file-tree-icon">${icon}</span><span class="file-tree-name">${item.name}</span>`;
                
                container.appendChild(li);
                
                // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œæ·»åŠ å±•å¼€/æŠ˜å åŠŸèƒ½
                if (item.type === 'folder' && item.children) {
                    li.style.cursor = 'pointer';
                    li.classList.add('folder-item');
                    li.setAttribute('data-expanded', 'false');
                    
                    const ul = document.createElement('ul');
                    ul.className = 'file-tree';
                    ul.style.display = 'none';
                    
                    // æ¸²æŸ“å­é¡¹
                    renderFileTree(ul, item.children, level + 1);
                    
                    // å°†å­é¡¹åˆ—è¡¨æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼ˆåœ¨liåé¢ï¼Œå‘ä¸‹æ’åˆ—ï¼‰
                    container.appendChild(ul);
                    
                    // ç‚¹å‡»æ–‡ä»¶å¤¹å±•å¼€/æŠ˜å 
                    li.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isExpanded = li.getAttribute('data-expanded') === 'true';
                        const expandIconEl = li.querySelector('.folder-expand');
                        
                        if (isExpanded) {
                            ul.style.display = 'none';
                            li.setAttribute('data-expanded', 'false');
                            if (expandIconEl) expandIconEl.textContent = 'â–¶';
                        } else {
                            ul.style.display = 'block';
                            li.setAttribute('data-expanded', 'true');
                            if (expandIconEl) expandIconEl.textContent = 'â–¼';
                        }
                    });
                }
                
                // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œæ·»åŠ ç‚¹å‡»äº‹ä»¶æŸ¥çœ‹ä»£ç 
                if (item.type === 'file') {
                    li.style.cursor = 'pointer';
                    li.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
                        const allItems = document.querySelectorAll('#agentSpaceCodeTree .file-tree-item');
                        allItems.forEach(el => {
                            el.classList.remove('selected');
                        });
                        // æ·»åŠ é€‰ä¸­çŠ¶æ€
                        li.classList.add('selected');
                        // æ˜¾ç¤ºä»£ç 
                        showCodeContent(item.name, item.path || item.name);
                    });
                }
            });
        }

        // æ˜¾ç¤ºä»£ç å†…å®¹
        function showCodeContent(fileName, filePath) {
            const placeholder = document.getElementById('codeViewerPlaceholder');
            const content = document.getElementById('codeViewerContent');
            const codeFileName = document.getElementById('codeFileName');
            const codeContent = document.getElementById('codeContent');

            if (!placeholder || !content || !codeFileName || !codeContent) return;

            // éšè—å ä½ç¬¦ï¼Œæ˜¾ç¤ºä»£ç å†…å®¹
            placeholder.style.display = 'none';
            content.style.display = 'flex';

            // è®¾ç½®æ–‡ä»¶å
            codeFileName.textContent = fileName;

            // æ¨¡æ‹Ÿä»£ç å†…å®¹ï¼ˆå®é™…åº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼‰
            const mockCode = getMockCodeContent(fileName, filePath);
            codeContent.textContent = mockCode;
        }

        // è·å–æ¨¡æ‹Ÿä»£ç å†…å®¹
        function getMockCodeContent(fileName, filePath) {
            const codeMap = {
                'UserController.php': `<?php
class UserController {
    public function getUser($id) {
        // å­˜åœ¨SQLæ³¨å…¥æ¼æ´
        $query = "SELECT * FROM users WHERE id = " . $_GET["id"];
        $result = mysqli_query($conn, $query);
        return mysqli_fetch_assoc($result);
    }
    
    public function updateUser($id, $data) {
        // ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå®‰å…¨ï¼‰
        $stmt = $conn->prepare("UPDATE users SET name = ? WHERE id = ?");
        $stmt->bind_param("si", $data['name'], $id);
        return $stmt->execute();
    }
}`,
                'AuthController.php': `<?php
class AuthController {
    public function login($username, $password) {
        $user = $this->findUser($username);
        if ($user && password_verify($password, $user['password'])) {
            $_SESSION['user_id'] = $user['id'];
            return true;
        }
        return false;
    }
    
    private function findUser($username) {
        // æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
        return null;
    }
}`,
                'ProfileController.php': `<?php
class ProfileController {
    public function showProfile($userId) {
        $user = $this->getUserById($userId);
        return view('profile', ['user' => $user]);
    }
    
    private function getUserById($id) {
        // è·å–ç”¨æˆ·ä¿¡æ¯
        return User::find($id);
    }
}`,
                'profile.html': `<!DOCTYPE html>
<html>
<head>
    <title>ç”¨æˆ·èµ„æ–™</title>
</head>
<body>
    <h1>æ¬¢è¿, <?php echo $_GET["name"]; ?></h1>
    <!-- å­˜åœ¨XSSæ¼æ´ -->
    <div class="profile">
        <p>ç”¨æˆ·å: <?php echo htmlspecialchars($user['username']); ?></p>
    </div>
</body>
</html>`,
                'login.html': `<!DOCTYPE html>
<html>
<head>
    <title>ç™»å½•</title>
</head>
<body>
    <form method="POST" action="/login">
        <input type="text" name="username" placeholder="ç”¨æˆ·å">
        <input type="password" name="password" placeholder="å¯†ç ">
        <button type="submit">ç™»å½•</button>
    </form>
</body>
</html>`,
                'dashboard.html': `<!DOCTYPE html>
<html>
<head>
    <title>ä»ªè¡¨æ¿</title>
</head>
<body>
    <div class="dashboard">
        <h1>æ¬¢è¿å›æ¥, <?php echo $user['name']; ?></h1>
        <div class="stats">
            <div class="stat-item">æ€»ç”¨æˆ·: <?php echo $stats['total_users']; ?></div>
        </div>
    </div>
</body>
</html>`,
                'FileHandler.java': `import java.io.*;
import java.lang.Runtime;

public class FileHandler {
    public void executeCommand(String userInput) {
        // å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´
        Runtime.getRuntime().exec("ping " + userInput);
    }
    
    public void safeExecuteCommand(String userInput) {
        // å®‰å…¨çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼
        String[] allowedCommands = {"ping", "traceroute"};
        // éªŒè¯å’Œæ¸…ç†è¾“å…¥
        if (isValidCommand(userInput)) {
            Runtime.getRuntime().exec(new String[]{"ping", userInput});
        }
    }
    
    private boolean isValidCommand(String input) {
        // è¾“å…¥éªŒè¯é€»è¾‘
        return input.matches("^[a-zA-Z0-9.]+$");
    }
}`,
                'Validator.js': `function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function validateInput(input) {
    // è¾“å…¥éªŒè¯å’Œæ¸…ç†
    return input.trim().replace(/[<>]/g, '');
}

function sanitizeHTML(html) {
    // HTMLè½¬ä¹‰
    const div = document.createElement('div');
    div.textContent = html;
    return div.innerHTML;
}`,
                'SecurityHelper.php': `<?php
class SecurityHelper {
    public static function sanitizeInput($input) {
        return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
    }
    
    public static function validateCSRF($token) {
        return hash_equals($_SESSION['csrf_token'], $token);
    }
    
    public static function generateCSRFToken() {
        return bin2hex(random_bytes(32));
    }
}`,
                'User.php': `<?php
class User {
    protected $id;
    protected $username;
    protected $email;
    
    public function __construct($id, $username, $email) {
        $this->id = $id;
        $this->username = $username;
        $this->email = $email;
    }
    
    public function getId() {
        return $this->id;
    }
    
    public function getUsername() {
        return $this->username;
    }
}`,
                'Session.php': `<?php
class Session {
    public static function start() {
        if (session_status() === PHP_SESSION_NONE) {
            session_start();
        }
    }
    
    public static function set($key, $value) {
        $_SESSION[$key] = $value;
    }
    
    public static function get($key) {
        return $_SESSION[$key] ?? null;
    }
}`,
                'database.php': `<?php
return [
    'host' => 'localhost',
    'database' => 'myapp',
    'username' => 'root',
    'password' => '',
    'charset' => 'utf8mb4'
];`,
                'app.php': `<?php
return [
    'name' => 'My Application',
    'version' => '1.0.0',
    'debug' => false,
    'timezone' => 'Asia/Shanghai'
];`,
                'security.php': `<?php
return [
    'csrf_protection' => true,
    'xss_protection' => true,
    'sql_injection_protection' => true
];`,
                'index.php': `<?php
require_once '../config/app.php';
require_once '../src/controllers/UserController.php';

$controller = new UserController();
$controller->index();`,
                '.htaccess': `RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]`,
                'UserControllerTest.php': `<?php
use PHPUnit\Framework\TestCase;

class UserControllerTest extends TestCase {
    public function testGetUser() {
        $controller = new UserController();
        $result = $controller->getUser(1);
        $this->assertNotNull($result);
    }
}`,
                'SecurityTest.php': `<?php
use PHPUnit\Framework\TestCase;

class SecurityTest extends TestCase {
    public function testSQLInjectionProtection() {
        // æµ‹è¯•SQLæ³¨å…¥é˜²æŠ¤
        $this->assertTrue(true);
    }
}`
            };

            return codeMap[fileName] || `// ${fileName}\n// æ–‡ä»¶è·¯å¾„: ${filePath}\n\n// ä»£ç å†…å®¹åŠ è½½ä¸­...\n// è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶`;
        }

        // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
        function simulateAIAnalysis(taskContent) {
            const logContainer = taskContent.querySelector('#agentLogContainer');
            if (!logContainer) return;

            // ç¬¬1é˜¶æ®µï¼šåŠŸèƒ½ç†è§£ä¸åˆ†æä¾§é‡ç‚¹è§„åˆ’ï¼ˆå¹¶è¡Œï¼‰
            setTimeout(() => {
                addLogStage(logContainer, 'åŠŸèƒ½ç†è§£ä¸åˆ†æä¾§é‡ç‚¹è§„åˆ’', 'å¹¶è¡Œ', [
                    { type: 'reasoning', title: 'æ·±åº¦æ¨ç†', overview: 'é’ˆå¯¹ç”¨æˆ·ä»£ç å’ŒæŒ‡å®šæ¼æ´ç±»å‹ï¼Œä¸‹ä¸€æ­¥éœ€è¦å¹²ä»€ä¹ˆï¼Ÿ', detail: 'æˆ‘éœ€è¦å…ˆç†è§£ä»£ç çš„æ•´ä½“åŠŸèƒ½ç»“æ„ï¼Œè¯†åˆ«å…³é”®ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æµã€‚ç„¶åæ ¹æ®æŒ‡å®šçš„æ¼æ´ç±»å‹ï¼ˆSQLæ³¨å…¥ã€XSSã€å‘½ä»¤æ³¨å…¥ç­‰ï¼‰ï¼Œåˆ¶å®šè¯¦ç»†çš„åˆ†æç­–ç•¥ã€‚é¦–å…ˆéœ€è¦åˆ›å»ºåŠŸèƒ½æ€»ç»“æ–‡ä»¶ï¼Œæ¢³ç†é¡¹ç›®æ¶æ„å’Œå…³é”®åŠŸèƒ½æ¨¡å—ã€‚' },
                    { type: 'create', title: 'åˆ›å»ºæ–‡ä»¶', overview: 'æ­£åœ¨åˆ›å»ºåŠŸèƒ½æ€»ç»“æ–‡ä»¶ï¼ŒProjectAbstract.md', detail: 'ä»»åŠ¡çŠ¶æ€: è¿›è¡Œä¸­\nä»»åŠ¡ID: TASK-001\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥, XSS, å‘½ä»¤æ³¨å…¥' },
                    { type: 'edit', title: 'ç¼–è¾‘æ–‡ä»¶', overview: 'æ­£åœ¨ç¼–è¾‘åŠŸèƒ½æ€»ç»“æ–‡ä»¶ï¼ŒProjectAbstract.md', detail: 'ä»»åŠ¡çŠ¶æ€: å·²å®Œæˆ\nä»»åŠ¡ID: TASK-001\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥, XSS, å‘½ä»¤æ³¨å…¥\n\né¡¹ç›®æ¦‚è¿°:\n- Webåº”ç”¨ï¼Œä½¿ç”¨PHPå’ŒJavaæ··åˆå¼€å‘\n- åŒ…å«ç”¨æˆ·è®¤è¯ã€æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®æŸ¥è¯¢ç­‰åŠŸèƒ½\n- å­˜åœ¨å¤šå¤„ç”¨æˆ·è¾“å…¥å¤„ç†ç‚¹\n- æ•°æ®åº“æ“ä½œä½¿ç”¨åŸç”ŸSQLæŸ¥è¯¢' },
                    { type: 'create', title: 'åˆ›å»ºæ–‡ä»¶', overview: 'æ­£åœ¨åˆ›å»ºåˆ†æä»»åŠ¡æ¸…å•æ–‡ä»¶ï¼ŒStrategyTodoList.md', detail: 'ä»»åŠ¡çŠ¶æ€: å¾…å¤„ç†\nä»»åŠ¡ID: TASK-002\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥' },
                    { type: 'edit', title: 'ç¼–è¾‘æ–‡ä»¶', overview: 'æ­£åœ¨ç¼–è¾‘æ–‡ä»¶ï¼ŒStrategyTodoList.md', detail: 'ä»»åŠ¡çŠ¶æ€: è¿›è¡Œä¸­\nä»»åŠ¡ID: TASK-002\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥\n\nåˆ†æç­–ç•¥:\n1. æ£€æŸ¥æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢è¯­å¥\n2. è¯†åˆ«ç”¨æˆ·è¾“å…¥ç‚¹\n3. éªŒè¯å‚æ•°åŒ–æŸ¥è¯¢ä½¿ç”¨æƒ…å†µ\n4. åˆ†ææ•°æ®æµè·¯å¾„' },
                    { type: 'view', title: 'æŸ¥çœ‹æ–‡ä»¶', overview: 'æ­£åœ¨æŸ¥çœ‹æ–‡ä»¶ï¼ŒStrategyTodoList.md', detail: 'ä»»åŠ¡çŠ¶æ€: å·²å®Œæˆ\nä»»åŠ¡ID: TASK-002\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥\n\nå·²è¯†åˆ«é£é™©ç‚¹:\n- UserController.php:45\n- AuthController.php:78' }
                ]);
            }, 1000);

            // ç¬¬2é˜¶æ®µï¼šæ½œåœ¨é£é™©åˆ†æï¼ˆå¹¶è¡Œï¼‰
            setTimeout(() => {
                addLogStage(logContainer, 'æ½œåœ¨é£é™©åˆ†æ', 'å¹¶è¡Œ', [
                    { type: 'view', title: 'æŸ¥çœ‹æ–‡ä»¶', overview: 'æ­£åœ¨æŸ¥çœ‹åˆ†æä»»åŠ¡æ¸…å•ï¼ŒStrategyTodoList.md', detail: 'ä»»åŠ¡çŠ¶æ€: å·²å®Œæˆ\nä»»åŠ¡ID: TASK-002\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥' },
                    { type: 'edit', title: 'ç¼–è¾‘æ–‡ä»¶', overview: 'æ­£åœ¨ç¼–è¾‘åˆ†æä»»åŠ¡æ¸…å•ï¼ŒStrategyTodoList.md', detail: 'ä»»åŠ¡çŠ¶æ€: å·²å®Œæˆ\nä»»åŠ¡ID: TASK-002\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥\n\nå‘ç°é£é™©ç‚¹:\n- UserController.php:45 (é«˜å±)\n- AuthController.php:78 (ä¸­å±)\n- ProfileController.php:123 (ä½å±)' },
                    { type: 'create', title: 'åˆ›å»ºæ–‡ä»¶', overview: 'æ­£åœ¨åˆ›å»ºç–‘ä¼¼é£é™©ç‚¹æ¸…å•ï¼ŒPotentialRiskList.md', detail: 'ä»»åŠ¡çŠ¶æ€: å¾…å¤æ ¸\né£é™©ID: RISK-001\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥' },
                    { type: 'edit', title: 'ç¼–è¾‘æ–‡ä»¶', overview: 'æ­£åœ¨ç¼–è¾‘ç–‘ä¼¼é£é™©ç‚¹æ¸…å•ï¼ŒPotentialRiskList.md', detail: 'ä»»åŠ¡çŠ¶æ€: å¾…å¤æ ¸\né£é™©ID: RISK-001\næ½œåœ¨é£é™©ç±»å‹: SQLæ³¨å…¥\n\nä½ç½®: src/controllers/UserController.php:45\nä»£ç : $query = "SELECT * FROM users WHERE id = " . $_GET["id"];\n\nä»»åŠ¡çŠ¶æ€: å¾…å¤æ ¸\né£é™©ID: RISK-002\næ½œåœ¨é£é™©ç±»å‹: XSS\n\nä½ç½®: src/views/profile.html:78\nä»£ç : <div>æ¬¢è¿, <?php echo $_GET["name"]; ?></div>' },
                    { type: 'reasoning', title: 'æ·±åº¦æ¨ç†', overview: 'é’ˆå¯¹ç”¨æˆ·ä»£ç å’ŒæŒ‡å®šæ¼æ´ç±»å‹ï¼Œä¸‹ä¸€æ­¥éœ€è¦å¹²ä»€ä¹ˆï¼Ÿ', detail: 'æˆ‘å·²ç»è¯†åˆ«å‡ºå¤šä¸ªæ½œåœ¨é£é™©ç‚¹ï¼Œç°åœ¨éœ€è¦é€ä¸€å¤æ ¸è¿™äº›é£é™©ç‚¹ï¼Œç¡®è®¤æ˜¯å¦ä¸ºçœŸå®æ¼æ´ã€‚å¯¹äºSQLæ³¨å…¥é£é™©ï¼Œæˆ‘éœ€è¦æ£€æŸ¥ä»£ç ä¸Šä¸‹æ–‡ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„é˜²æŠ¤æªæ–½ã€‚å¯¹äºXSSé£é™©ï¼Œéœ€è¦éªŒè¯è¾“å‡ºä½ç½®å’Œç¼–ç æƒ…å†µã€‚' }
                ]);
            }, 4000);

            // ç¬¬3é˜¶æ®µï¼šæ½œåœ¨é£é™©å¤æ ¸ï¼ˆå¹¶è¡Œï¼‰
            setTimeout(() => {
                addLogStage(logContainer, 'æ½œåœ¨é£é™©å¤æ ¸', 'å¹¶è¡Œ', [
                    { type: 'view', title: 'æŸ¥çœ‹æ–‡ä»¶', overview: 'æ­£åœ¨æŸ¥çœ‹ç–‘ä¼¼é£é™©ç‚¹æ¸…å•ï¼ŒPotentialRiskList.md', detail: 'ä»»åŠ¡çŠ¶æ€ | ä»»åŠ¡ID | é£é™©ç±»å‹\nå¾…å¤æ ¸ | RISK-001 | SQLæ³¨å…¥\nå¾…å¤æ ¸ | RISK-002 | XSS\nå¾…å¤æ ¸ | RISK-003 | å‘½ä»¤æ³¨å…¥' },
                    { type: 'edit', title: 'ç¼–è¾‘æ–‡ä»¶', overview: 'æ­£åœ¨ç¼–è¾‘ç–‘ä¼¼é£é™©ç‚¹æ¸…å•ï¼ŒPotentialRiskList.md', detail: 'ä»»åŠ¡çŠ¶æ€ | ä»»åŠ¡ID | é£é™©ç±»å‹ | å¤æ ¸ç»“æœ\nå·²ç¡®è®¤ | RISK-001 | SQLæ³¨å…¥ | ç¡®è®¤ä¸ºçœŸå®æ¼æ´\nå·²ç¡®è®¤ | RISK-002 | XSS | ç¡®è®¤ä¸ºçœŸå®æ¼æ´\nå·²ç¡®è®¤ | RISK-003 | å‘½ä»¤æ³¨å…¥ | ç¡®è®¤ä¸ºçœŸå®æ¼æ´' },
                    { type: 'create', title: 'åˆ›å»ºæ–‡ä»¶', overview: 'æ­£åœ¨åˆ›å»ºæ¼æ´æ¸…å•ï¼ŒVulList.md', detail: 'åºå· | é£é™©ID | é£é™©ç±»å‹\n1 | RISK-001 | SQLæ³¨å…¥ (CWE-89)\n2 | RISK-002 | XSS (CWE-79)\n3 | RISK-003 | å‘½ä»¤æ³¨å…¥ (CWE-78)' },
                    { type: 'create', title: 'åˆ›å»ºæ–‡ä»¶', overview: 'æ­£åœ¨åˆ›å»ºæ¼æ´è¯¦æƒ…æ–‡ä»¶ï¼ŒVulDetail.md', detail: 'åºå·: 1\né£é™©ID: RISK-001\né£é™©ç±»å‹: SQLæ³¨å…¥ (CWE-89)\nä½ç½®: src/controllers/UserController.php:45\nä¸¥é‡ç¨‹åº¦: é«˜å±\nä¿®å¤å»ºè®®: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢\n\nåºå·: 2\né£é™©ID: RISK-002\né£é™©ç±»å‹: XSS (CWE-79)\nä½ç½®: src/views/profile.html:78\nä¸¥é‡ç¨‹åº¦: é«˜å±\nä¿®å¤å»ºè®®: ä½¿ç”¨HTMLå®ä½“ç¼–ç \n\nåºå·: 3\né£é™©ID: RISK-003\né£é™©ç±»å‹: å‘½ä»¤æ³¨å…¥ (CWE-78)\nä½ç½®: src/utils/FileHandler.java:123\nä¸¥é‡ç¨‹åº¦: é«˜å±\nä¿®å¤å»ºè®®: ä½¿ç”¨ç™½åå•éªŒè¯' },
                    { type: 'reasoning', title: 'æ·±åº¦æ¨ç†', overview: 'é’ˆå¯¹ç”¨æˆ·ä»£ç å’ŒæŒ‡å®šæ¼æ´ç±»å‹ï¼Œä¸‹ä¸€æ­¥éœ€è¦å¹²ä»€ä¹ˆï¼Ÿ', detail: 'æˆ‘å·²ç»å¤æ ¸äº†æ‰€æœ‰æ½œåœ¨é£é™©ç‚¹ï¼Œç¡®è®¤äº†3ä¸ªé«˜å±æ¼æ´ã€‚ç°åœ¨éœ€è¦ç”Ÿæˆè¯¦ç»†çš„æ¼æ´æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ¼æ´ä½ç½®ã€ä»£ç ç‰‡æ®µã€é£é™©æè¿°å’Œä¿®å¤å»ºè®®ã€‚æ‰€æœ‰æ¼æ´ä¿¡æ¯å·²ç»æ•´ç†å®Œæˆï¼Œå¯ä»¥å¼€å§‹ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Šã€‚' }
                ]);
            }, 7000);

            // ç¬¬4é˜¶æ®µï¼šæŠ¥å‘Šæ€»ç»“ï¼ˆä¸²è¡Œï¼Œå½“æœ‰å®Œæˆçš„ä»»åŠ¡å¯ä»¥è¾“å‡ºæŠ¥å‘Šæ€»ç»“ï¼‰
            setTimeout(() => {
                addLogStage(logContainer, 'æŠ¥å‘Šæ€»ç»“', 'ä¸²è¡Œ', [
                    { type: 'create', title: 'åˆ›å»ºæ–‡ä»¶', overview: 'æ­£åœ¨åˆ›å»ºåˆ†ææ€»ç»“æŠ¥å‘Šæ–‡ä»¶ï¼ŒFinalSummary.md', detail: 'ä»£ç æ¼æ´åˆ†ææŠ¥å‘Š\n\næ¦‚è¿°:\næœ¬æ¬¡åˆ†æå…±å‘ç°10ä¸ªå®‰å…¨æ¼æ´ï¼Œå…¶ä¸­3ä¸ªé«˜å±æ¼æ´éœ€è¦ç«‹å³ä¿®å¤ã€‚\n\né«˜å±æ¼æ´:\n1. SQLæ³¨å…¥æ¼æ´ (CWE-89) - UserController.php:45\n2. XSSæ¼æ´ (CWE-79) - profile.html:78\n3. å‘½ä»¤æ³¨å…¥æ¼æ´ (CWE-78) - FileHandler.java:123' },
                    { type: 'edit', title: 'ç¼–è¾‘æ–‡ä»¶', overview: 'æ­£åœ¨ç¼–è¾‘æ–‡ä»¶ï¼ŒFinalSummary.md', detail: 'ä»£ç æ¼æ´åˆ†ææŠ¥å‘Š\n\næ¦‚è¿°:\næœ¬æ¬¡åˆ†æå…±å‘ç°10ä¸ªå®‰å…¨æ¼æ´ï¼Œå…¶ä¸­3ä¸ªé«˜å±æ¼æ´éœ€è¦ç«‹å³ä¿®å¤ã€‚\n\né«˜å±æ¼æ´è¯¦æƒ…:\n1. SQLæ³¨å…¥æ¼æ´ (CWE-89)\n   ä½ç½®: src/controllers/UserController.php:45\n   ä»£ç : $query = "SELECT * FROM users WHERE id = " . $_GET["id"];\n   ä¿®å¤: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢\n\n2. XSSæ¼æ´ (CWE-79)\n   ä½ç½®: src/views/profile.html:78\n   ä»£ç : <div>æ¬¢è¿, <?php echo $_GET["name"]; ?></div>\n   ä¿®å¤: ä½¿ç”¨HTMLå®ä½“ç¼–ç \n\n3. å‘½ä»¤æ³¨å…¥æ¼æ´ (CWE-78)\n   ä½ç½®: src/utils/FileHandler.java:123\n   ä»£ç : Runtime.getRuntime().exec("ping " + userInput);\n   ä¿®å¤: ä½¿ç”¨ç™½åå•éªŒè¯\n\nå»ºè®®:\nä¼˜å…ˆä¿®å¤é«˜å±æ¼æ´ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ã€HTMLç¼–ç å’Œå®‰å…¨APIã€‚' },
                    { type: 'view', title: 'æŸ¥çœ‹æ–‡ä»¶', overview: 'æ­£åœ¨æŸ¥çœ‹æ–‡ä»¶ï¼ŒFinalSummary.md', detail: 'æŠ¥å‘Šå·²ç”Ÿæˆå®Œæˆï¼ŒåŒ…å«å®Œæ•´çš„æ¼æ´åˆ†æç»“æœå’Œä¿®å¤å»ºè®®ã€‚' },
                    { type: 'reasoning', title: 'æ·±åº¦æ¨ç†', overview: 'é’ˆå¯¹ç”¨æˆ·ä»£ç å’ŒæŒ‡å®šæ¼æ´ç±»å‹ï¼Œä¸‹ä¸€æ­¥éœ€è¦å¹²ä»€ä¹ˆï¼Ÿ', detail: 'åˆ†æä»»åŠ¡å·²å®Œæˆã€‚æˆ‘å·²ç»ç”Ÿæˆäº†å®Œæ•´çš„æ¼æ´åˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬æ¼æ´æ¸…å•ã€è¯¦ç»†ä¿¡æ¯å’Œä¿®å¤å»ºè®®ã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å·¥ä½œç©ºé—´ä¸­çš„äº§ç‰©æ–‡ä»¶è·å–å®Œæ•´æŠ¥å‘Šã€‚æ‰€æœ‰é˜¶æ®µçš„ä»»åŠ¡éƒ½å·²å®Œæˆï¼ŒæŠ¥å‘Šæ€»ç»“å·²ç”Ÿæˆã€‚' }
                ]);
            }, 10000);
        }

        // æ·»åŠ æ—¥å¿—é˜¶æ®µ
        function addLogStage(container, stageTitle, stageType, events) {
            const stageDiv = document.createElement('div');
            stageDiv.className = 'log-stage';
            
            let eventsHTML = events.map(event => {
                const iconMap = {
                    'reasoning': 'ğŸ’­',
                    'create': 'ğŸ“„',
                    'edit': 'âœï¸',
                    'view': 'ğŸ‘ï¸'
                };
                
                const eventClass = event.type === 'reasoning' ? 'log-event log-reasoning' : 'log-event';
                
                // åŒæ­¥æ›´æ–°æ‰§è¡Œtabï¼ˆå¯¹äºæ–‡ä»¶æ“ä½œäº‹ä»¶ï¼‰
                if (event.type === 'edit' || event.type === 'create' || event.type === 'view') {
                    setTimeout(() => {
                        updateExecutionTab(event);
                    }, 100);
                }
                
                return `<div class="${eventClass}">
                    <div class="log-event-header">
                        <span class="log-event-icon">${iconMap[event.type] || 'ğŸ“‹'}</span>
                        <span class="log-event-title">${event.title}</span>
                    </div>
                    <div class="log-event-overview">${event.overview}</div>
                    ${event.detail ? `<div class="log-event-detail">${event.detail}</div>` : ''}
                </div>`;
            }).join('');
            
            const badgeClass = stageType === 'å¹¶è¡Œ' ? 'parallel' : 'serial';
            
            stageDiv.innerHTML = `
                <div class="log-stage-header">
                    <span class="log-stage-title">${stageTitle}</span>
                    <span class="log-stage-badge ${badgeClass}">${stageType}</span>
                </div>
                <div class="log-stage-body">
                    ${eventsHTML}
                </div>
            `;
            
            container.appendChild(stageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // æ‰§è¡Œæ­¥éª¤è·Ÿè¸ª
        let executionSteps = [];
        let currentStepIndex = -1;
        let totalTasks = 5;
        let currentTaskIndex = 0;
        let taskNames = [
            'åŠŸèƒ½ç†è§£ä¸åˆ†æä¾§é‡ç‚¹è§„åˆ’',
            'æ½œåœ¨é£é™©åˆ†æ',
            'æ½œåœ¨é£é™©å¤æ ¸',
            'æŠ¥å‘Šæ€»ç»“',
            'æ•´ç†é£é™©æŠ¥å‘Š'
        ];

        // æ¯ä¸ªä»»åŠ¡å¯¹åº”çš„æ¨¡æ‹Ÿæ¡ä¾‹æ•°æ®
        const taskRulesData = [
            [
                'æ¢³ç†é¡¹ç›®æ•´ä½“æ¶æ„å’Œæ ¸å¿ƒä¸šåŠ¡æµç¨‹',
                'è¯†åˆ«å…³é”®æ•°æ®æµè½¬è·¯å¾„ï¼ˆç”¨æˆ·è¾“å…¥ â†’ æ•°æ®åº“å­˜å‚¨ â†’ é¡µé¢è¾“å‡ºï¼‰',
                'æ ¹æ®ä¸šåŠ¡æ¨¡å—åˆ’åˆ†æ½œåœ¨é£é™©åŒºåŸŸ'
            ],
            [
                'é’ˆå¯¹æ•°æ®åº“æ“ä½œæ¨¡å—ï¼Œåˆ—å‡ºæ‰€æœ‰SQLè¯­å¥è°ƒç”¨ç‚¹',
                'æ ‡è®°åŒ…å«ç”¨æˆ·è¾“å…¥æ‹¼æ¥çš„é«˜å±è¯­å¥',
                'æ¢³ç†è¾“å‡ºåˆ°é¡µé¢çš„æ‰€æœ‰å˜é‡æ¥æº'
            ],
            [
                'é€æ¡å¤æ ¸ç–‘ä¼¼é£é™©ç‚¹ï¼Œç¡®è®¤æ˜¯å¦ä¸ºçœŸå®æ¼æ´',
                'ä¸ºæ¯ä¸ªé£é™©ç‚¹æ‰“ä¸Šä¸¥é‡çº§åˆ«æ ‡ç­¾ï¼ˆé«˜ / ä¸­ / ä½ï¼‰',
                'è®°å½•å¤æ ¸ç»“è®ºå’Œåç»­å¤„ç†å»ºè®®'
            ],
            [
                'æ ¹æ®å¤æ ¸ç»“æœç”Ÿæˆæ¼æ´æ¸…å•å’Œæ¼æ´è¯¦æƒ…',
                'æŒ‰é£é™©ç­‰çº§æ’åºè¾“å‡ºï¼Œä¼˜å…ˆå±•ç¤ºé«˜å±æ¼æ´',
                'æ±‡æ€»å„ç±»æ¼æ´çš„åˆ†å¸ƒæƒ…å†µï¼ˆæŒ‰æ¨¡å— / æŒ‰ç±»å‹ï¼‰'
            ],
            [
                'æ±‡æ€»æœ¬æ¬¡å®¡è®¡çš„æ•´ä½“å‘ç°å’Œç»“è®º',
                'è¾“å‡ºå¯äº¤ä»˜ç»™ä¸šåŠ¡å’Œç ”å‘å›¢é˜Ÿçš„æŠ¥å‘Šç»“æ„',
                'ç»™å‡ºåç»­åŠ å›ºå»ºè®®å’Œå†æ¬¡å®¡è®¡çš„è§¦å‘æ¡ä»¶'
            ]
        ];

        // æ›´æ–°æ‰§è¡Œtabå†…å®¹
        function updateExecutionTab(event) {
            const placeholder = document.getElementById('executionPlaceholder');
            const content = document.getElementById('executionContent');
            const target = document.getElementById('executionTarget');
            const status = document.getElementById('executionStatus');
            const taskId = document.getElementById('executionTaskId');
            const riskType = document.getElementById('executionRiskType');
            const overview = document.getElementById('executionOverview');

            if (!placeholder || !content || !target || !status || !taskId || !riskType || !overview) return;

            // éšè—å ä½ç¬¦ï¼Œæ˜¾ç¤ºå†…å®¹
            placeholder.style.display = 'none';
            content.style.display = 'flex';

            // è§£æäº‹ä»¶è¯¦æƒ…
            const detail = event.detail || '';
            const overviewText = event.overview || '';

            // æå–æ–‡ä»¶å
            let fileName = '';
            const fileNameMatch = overviewText.match(/([A-Za-z0-9_\-]+\.md)/);
            if (fileNameMatch) {
                fileName = fileNameMatch[1];
            }

            // è®¾ç½®å®šä½ç›®æ ‡
            if (event.type === 'edit') {
                if (overviewText.includes('åŠŸèƒ½æ€»ç»“æ–‡ä»¶')) {
                    target.textContent = 'æ­£åœ¨ç¼–è¾‘åŠŸèƒ½æ€»ç»“æ–‡ä»¶ï¼Œ' + fileName;
                } else if (overviewText.includes('åˆ†æä»»åŠ¡æ¸…å•')) {
                    target.textContent = 'æ­£åœ¨ç¼–è¾‘åˆ†æä»»åŠ¡æ¸…å•ï¼Œ' + fileName;
                } else if (overviewText.includes('ç–‘ä¼¼é£é™©ç‚¹æ¸…å•')) {
                    target.textContent = 'æ­£åœ¨ç¼–è¾‘ç–‘ä¼¼é£é™©ç‚¹æ¸…å•ï¼Œ' + fileName;
                } else {
                    target.textContent = 'æ­£åœ¨ç¼–è¾‘æ–‡ä»¶ï¼Œ' + fileName;
                }
            } else if (event.type === 'create') {
                if (overviewText.includes('åŠŸèƒ½æ€»ç»“æ–‡ä»¶')) {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºåŠŸèƒ½æ€»ç»“æ–‡ä»¶ï¼Œ' + fileName;
                } else if (overviewText.includes('åˆ†æä»»åŠ¡æ¸…å•')) {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºåˆ†æä»»åŠ¡æ¸…å•æ–‡ä»¶ï¼Œ' + fileName;
                } else if (overviewText.includes('ç–‘ä¼¼é£é™©ç‚¹æ¸…å•')) {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºç–‘ä¼¼é£é™©ç‚¹æ¸…å•ï¼Œ' + fileName;
                } else if (overviewText.includes('æ¼æ´æ¸…å•')) {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºæ¼æ´æ¸…å•ï¼Œ' + fileName;
                } else if (overviewText.includes('æ¼æ´è¯¦æƒ…æ–‡ä»¶')) {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºæ¼æ´è¯¦æƒ…æ–‡ä»¶ï¼Œ' + fileName;
                } else if (overviewText.includes('åˆ†ææ€»ç»“æŠ¥å‘Š')) {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºåˆ†ææ€»ç»“æŠ¥å‘Šæ–‡ä»¶ï¼Œ' + fileName;
                } else {
                    target.textContent = 'æ­£åœ¨åˆ›å»ºæ–‡ä»¶ï¼Œ' + fileName;
                }
            } else if (event.type === 'view') {
                target.textContent = 'æ­£åœ¨æŸ¥çœ‹æ–‡ä»¶ï¼Œ' + fileName;
            }

            // è§£æä»»åŠ¡çŠ¶æ€
            const statusMatch = detail.match(/ä»»åŠ¡çŠ¶æ€[ï¼š:]\s*([^\n]+)/);
            if (statusMatch) {
                status.textContent = statusMatch[1].trim();
            } else {
                status.textContent = 'è¿›è¡Œä¸­';
            }

            // è§£æä»»åŠ¡ID
            const taskIdMatch = detail.match(/ä»»åŠ¡ID[ï¼š:]\s*([^\n]+)/);
            if (taskIdMatch) {
                taskId.textContent = taskIdMatch[1].trim();
            } else {
                // å°è¯•ä»é£é™©IDä¸­æå–
                const riskIdMatch = detail.match(/é£é™©ID[ï¼š:]\s*([^\n]+)/);
                if (riskIdMatch) {
                    taskId.textContent = riskIdMatch[1].trim();
                } else {
                    taskId.textContent = '-';
                }
            }

            // è§£ææ½œåœ¨é£é™©ç±»å‹
            const riskTypeMatch = detail.match(/æ½œåœ¨é£é™©ç±»å‹[ï¼š:]\s*([^\n]+)/);
            if (riskTypeMatch) {
                riskType.textContent = riskTypeMatch[1].trim();
            } else {
                // å°è¯•ä»é£é™©ç±»å‹ä¸­æå–
                const riskTypeMatch2 = detail.match(/é£é™©ç±»å‹[ï¼š:]\s*([^\n]+)/);
                if (riskTypeMatch2) {
                    riskType.textContent = riskTypeMatch2[1].trim();
                } else {
                    riskType.textContent = '-';
                }
            }

            // è§£æé¡¹ç›®æ¦‚è¿°
            const overviewMatch = detail.match(/é¡¹ç›®æ¦‚è¿°[ï¼š:]\s*([\s\S]+?)(?:\n\n|\nä»»åŠ¡|\nåˆ†æ|\nä½ç½®|$)/);
            if (overviewMatch) {
                overview.textContent = overviewMatch[1].trim();
            } else {
                // å¦‚æœæ²¡æœ‰é¡¹ç›®æ¦‚è¿°ï¼Œæ˜¾ç¤ºå®Œæ•´çš„è¯¦æƒ…å†…å®¹ï¼ˆä½†æ’é™¤ä¸€äº›ä¸éœ€è¦çš„ä¿¡æ¯ï¼‰
                let displayDetail = detail;
                // ç§»é™¤ä»»åŠ¡çŠ¶æ€ã€ä»»åŠ¡IDç­‰å·²å•ç‹¬æ˜¾ç¤ºçš„ä¿¡æ¯
                displayDetail = displayDetail.replace(/ä»»åŠ¡çŠ¶æ€[ï¼š:][^\n]+\n?/g, '');
                displayDetail = displayDetail.replace(/ä»»åŠ¡ID[ï¼š:][^\n]+\n?/g, '');
                displayDetail = displayDetail.replace(/æ½œåœ¨é£é™©ç±»å‹[ï¼š:][^\n]+\n?/g, '');
                displayDetail = displayDetail.replace(/é£é™©ID[ï¼š:][^\n]+\n?/g, '');
                displayDetail = displayDetail.replace(/é£é™©ç±»å‹[ï¼š:][^\n]+\n?/g, '');
                displayDetail = displayDetail.trim();
                
                if (displayDetail) {
                    overview.textContent = displayDetail;
                } else {
                    overview.textContent = 'æš‚æ— è¯¦ç»†ä¿¡æ¯';
                }
            }

            // æ›´æ–°è¿›åº¦æ¡
            updateProgressBar(event);

            // æ›´æ–°ä»»åŠ¡ä¿¡æ¯
            updateTaskInfo();
        }

        // æ›´æ–°ä»»åŠ¡ä¿¡æ¯
        function updateTaskInfo() {
            const taskStatusIcon = document.getElementById('taskStatusIcon');
            const taskCurrent = document.getElementById('taskCurrent');
            const taskName = document.getElementById('taskName');
            const taskRules = document.getElementById('taskRules');

            if (!taskStatusIcon || !taskCurrent || !taskName || !taskRules) return;

            // æ ¹æ®æ‰§è¡Œæ­¥éª¤æ•°é‡æ›´æ–°å½“å‰ä»»åŠ¡ç´¢å¼•
            if (executionSteps.length > 0) {
                // æ ¹æ®æ­¥éª¤æ•°é‡è®¡ç®—ä»»åŠ¡è¿›åº¦ï¼ˆæ¯ä¸ªé˜¶æ®µå¤§çº¦3-4ä¸ªæ­¥éª¤ï¼‰
                const stepCount = executionSteps.length;
                if (stepCount <= 3) {
                    currentTaskIndex = 0;
                } else if (stepCount <= 6) {
                    currentTaskIndex = 1;
                } else if (stepCount <= 9) {
                    currentTaskIndex = 2;
                } else if (stepCount <= 12) {
                    currentTaskIndex = 3;
                } else {
                    currentTaskIndex = 4;
                }
            } else {
                currentTaskIndex = 0;
            }

            // æ›´æ–°ä»»åŠ¡è¿›åº¦æ–‡æœ¬
            taskCurrent.textContent = `å½“å‰ä»»åŠ¡ ${currentTaskIndex + 1}/${totalTasks}`;

            // æ›´æ–°ä»»åŠ¡åç§°
            if (taskNames[currentTaskIndex]) {
                taskName.textContent = taskNames[currentTaskIndex];
            }

            // åˆ¤æ–­å½“å‰ä»»åŠ¡æ˜¯å¦å®Œæˆ
            // å¦‚æœå½“å‰ä»»åŠ¡ç´¢å¼•å°äºæ€»ä»»åŠ¡æ•°-1ï¼Œä¸”æ­¥éª¤æ•°è¾¾åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡çš„é˜ˆå€¼ï¼Œè¯´æ˜å½“å‰ä»»åŠ¡å·²å®Œæˆ
            const nextTaskThreshold = (currentTaskIndex + 1) * 3;
            const isCurrentTaskCompleted = executionSteps.length >= nextTaskThreshold && currentTaskIndex < totalTasks - 1;
            const isAllCompleted = executionSteps.length >= totalTasks * 3;

            // æ›´æ–°ä»»åŠ¡æ¡ä¾‹åˆ—è¡¨ï¼ˆå¸¦çŠ¶æ€ï¼‰
            taskRules.innerHTML = '';
            const rules = taskRulesData[currentTaskIndex] || [];
            rules.forEach((rule, index) => {
                const item = document.createElement('div');
                item.className = 'task-rules-item';

                const statusSpan = document.createElement('span');
                statusSpan.className = 'task-rule-status';

                const textSpan = document.createElement('span');
                textSpan.className = 'task-rule-text';
                textSpan.textContent = rule;

                // çŠ¶æ€é€»è¾‘ï¼š
                // - å½“æ•´ä¸ªä»»åŠ¡å·²å®Œæˆæˆ–æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶ï¼šæ‰€æœ‰æ¡ä¾‹å‰é¢éƒ½æ˜¯ç»¿è‰²å¯¹å·
                // - å¦åˆ™ï¼šå‰é¢çš„æ¡ç›®ä¸ºå·²å®Œæˆï¼ˆå¯¹å·ï¼‰ï¼Œæœ€åä¸€æ¡ä¸ºæ­£åœ¨è¿›è¡Œä¸­ï¼ˆåŠ è½½ä¸­ï¼‰
                if (isCurrentTaskCompleted || isAllCompleted) {
                    statusSpan.classList.add('completed');
                    statusSpan.textContent = 'âœ“';
                } else {
                    const isLast = index === rules.length - 1;
                    if (isLast) {
                        statusSpan.classList.add('loading');
                        const loader = document.createElement('span');
                        loader.className = 'mini-loading-spinner';
                        statusSpan.appendChild(loader);
                    } else {
                        statusSpan.classList.add('completed');
                        statusSpan.textContent = 'âœ“';
                    }
                }

                item.appendChild(statusSpan);
                item.appendChild(textSpan);
                taskRules.appendChild(item);
            });

            if (isCurrentTaskCompleted || isAllCompleted) {
                // å·²å®Œæˆ - æ˜¾ç¤ºå¯¹å·
                taskStatusIcon.className = 'task-status-icon completed';
                taskStatusIcon.innerHTML = '';
            } else {
                // æ­£åœ¨åŠ è½½ - æ˜¾ç¤ºè½¬åœˆåŠ¨ç”»
                taskStatusIcon.className = 'task-status-icon';
                taskStatusIcon.innerHTML = '<span class="loading-spinner"></span>';
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar(event) {
            const progressSteps = document.getElementById('progressSteps');
            const progressFill = document.getElementById('progressFill');
            const progressPrevBtn = document.getElementById('progressPrevBtn');
            const progressNextBtn = document.getElementById('progressNextBtn');

            if (!progressSteps || !progressFill) return;

            // æ·»åŠ æ­¥éª¤åˆ°åˆ—è¡¨
            const stepInfo = {
                event: event,
                target: target ? target.textContent : '',
                timestamp: new Date()
            };
            executionSteps.push(stepInfo);
            currentStepIndex = executionSteps.length - 1;

            // æ¸…ç©ºå¹¶é‡æ–°æ¸²æŸ“æ­¥éª¤
            progressSteps.innerHTML = '';
            executionSteps.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'progress-step' + (index === currentStepIndex ? ' active' : '') + (index < currentStepIndex ? ' completed' : '');
                stepDiv.setAttribute('data-step-index', index);
                stepDiv.innerHTML = '<div class="progress-step-marker"></div>';
                
                // ç‚¹å‡»æ­¥éª¤è·³è½¬
                stepDiv.addEventListener('click', () => {
                    jumpToStep(index);
                });
                
                progressSteps.appendChild(stepDiv);
            });

            // æ›´æ–°è¿›åº¦æ¡å¡«å……
            const progress = executionSteps.length > 0 ? ((currentStepIndex + 1) / executionSteps.length) * 100 : 0;
            progressFill.style.width = progress + '%';

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            if (progressPrevBtn) {
                progressPrevBtn.disabled = currentStepIndex <= 0;
            }
            if (progressNextBtn) {
                progressNextBtn.disabled = currentStepIndex >= executionSteps.length - 1;
            }
        }

        // è·³è½¬åˆ°æŒ‡å®šæ­¥éª¤
        function jumpToStep(index) {
            if (index < 0 || index >= executionSteps.length) return;
            
            currentStepIndex = index;
            const step = executionSteps[index];
            
            // æ›´æ–°æ‰§è¡Œtabå†…å®¹
            updateExecutionTab(step.event);
            
            // æ›´æ–°è¿›åº¦æ¡çŠ¶æ€
            const progressSteps = document.getElementById('progressSteps');
            const progressFill = document.getElementById('progressFill');
            const progressPrevBtn = document.getElementById('progressPrevBtn');
            const progressNextBtn = document.getElementById('progressNextBtn');
            
            if (progressSteps) {
                progressSteps.querySelectorAll('.progress-step').forEach((stepEl, i) => {
                    stepEl.classList.remove('active', 'completed');
                    if (i === index) {
                        stepEl.classList.add('active');
                    } else if (i < index) {
                        stepEl.classList.add('completed');
                    }
                });
            }
            
            if (progressFill) {
                const progress = executionSteps.length > 0 ? ((index + 1) / executionSteps.length) * 100 : 0;
                progressFill.style.width = progress + '%';
            }
            
            if (progressPrevBtn) {
                progressPrevBtn.disabled = index <= 0;
            }
            if (progressNextBtn) {
                progressNextBtn.disabled = index >= executionSteps.length - 1;
            }
        }

        // åˆå§‹åŒ–è¿›åº¦æ¡äº¤äº’
        function initProgressBar() {
            const progressPrevBtn = document.getElementById('progressPrevBtn');
            const progressNextBtn = document.getElementById('progressNextBtn');
            const taskToggle = document.getElementById('taskToggle');
            const taskRules = document.getElementById('taskRules');

            if (progressPrevBtn) {
                progressPrevBtn.addEventListener('click', () => {
                    if (currentStepIndex > 0) {
                        jumpToStep(currentStepIndex - 1);
                    }
                });
            }

            if (progressNextBtn) {
                progressNextBtn.addEventListener('click', () => {
                    if (currentStepIndex < executionSteps.length - 1) {
                        jumpToStep(currentStepIndex + 1);
                    }
                });
            }

            // å½“å‰ä»»åŠ¡ä¸‹æ‹‰å±•å¼€/æ”¶èµ·
            if (taskToggle && taskRules) {
                taskToggle.addEventListener('click', () => {
                    const isOpen = taskToggle.classList.contains('open');
                    if (isOpen) {
                        taskToggle.classList.remove('open');
                        taskRules.style.display = 'none';
                    } else {
                        taskToggle.classList.add('open');
                        taskRules.style.display = 'block';
                    }
                });
            }

            // æ¨¡æ‹Ÿè¿›åº¦æ¡æ ·å¼ï¼ˆåˆå§‹æ˜¾ç¤ºï¼‰
            simulateProgressBarStyle();
        }

        // æ¨¡æ‹Ÿè¿›åº¦æ¡æ ·å¼å±•ç¤º
        function simulateProgressBarStyle() {
            const progressSteps = document.getElementById('progressSteps');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');

            if (!progressSteps || !progressFill) return;

            // åˆ›å»ºæ¨¡æ‹Ÿæ­¥éª¤ï¼ˆ5ä¸ªæ­¥éª¤ï¼Œå½“å‰åœ¨ç¬¬3æ­¥ï¼‰
            const totalSteps = 5;
            const currentStep = 3;
            
            // åˆå§‹åŒ–ä»»åŠ¡ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿç¬¬2ä¸ªä»»åŠ¡ï¼Œæ­£åœ¨åŠ è½½ï¼‰
            currentTaskIndex = 1;
            updateTaskInfo();

            // æ¸…ç©ºå¹¶åˆ›å»ºæ¨¡æ‹Ÿæ­¥éª¤
            progressSteps.innerHTML = '';
            for (let i = 0; i < totalSteps; i++) {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'progress-step' + 
                    (i === currentStep - 1 ? ' active' : '') + 
                    (i < currentStep - 1 ? ' completed' : '');
                stepDiv.innerHTML = '<div class="progress-step-marker"></div>';
                progressSteps.appendChild(stepDiv);
            }

            // æ›´æ–°è¿›åº¦å¡«å……
            const progress = (currentStep / totalSteps) * 100;
            progressFill.style.width = progress + '%';

            // æ›´æ–°è¿›åº¦æ–‡æœ¬
            if (progressText) {
                progressText.textContent = `${currentStep} / ${totalSteps}`;
            }
            if (progressPercent) {
                progressPercent.textContent = Math.round(progress) + '%';
            }

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const progressPrevBtn = document.getElementById('progressPrevBtn');
            const progressNextBtn = document.getElementById('progressNextBtn');
            if (progressPrevBtn) {
                progressPrevBtn.disabled = currentStep <= 1;
            }
            if (progressNextBtn) {
                progressNextBtn.disabled = currentStep >= totalSteps;
            }
        }
    </script>
</body>
</html>

