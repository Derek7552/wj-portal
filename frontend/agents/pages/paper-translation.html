<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è®ºæ–‡ç¿»è¯‘æ™ºèƒ½ä½“ - æ™ºèƒ½è®ºæ–‡ç¿»è¯‘æœåŠ¡">
    <title>è®ºæ–‡ç¿»è¯‘ | äº‘è„‘</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/dashboard.css">
    <link rel="stylesheet" href="../../templates/css/template-detail.css">
    <link rel="stylesheet" href="../../components/agent-sidebar.css">
    <link rel="stylesheet" href="../../components/chat-input.css">
    <style>
        /* ==========================================
           æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ ·å¼
           ========================================== */
        
        .file-upload-container {
            width: 100%;
            margin: 0 auto;
            padding: 16px 24px 24px 24px;
            height: 280px;
            box-sizing: border-box;
        }
        
        /* ä¸Šä¼ åŒºåŸŸ */
        .file-upload-area {
            border: 2px dashed var(--clouditera-neutral-border-primary);
            border-radius: 12px;
            padding: 48px 24px;
            text-align: center;
            background: var(--clouditera-neutral-background-white);
            cursor: pointer;
            transition: all 0.3s ease;
            height: 240px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }
        
        .file-upload-area:hover {
            border-color: var(--clouditera-brand-primary);
            background: var(--clouditera-neutral-background-secondary);
        }
        
        .file-upload-area.drag-over {
            border-color: var(--clouditera-brand-primary);
            background: var(--clouditera-brand-primary-light);
            border-style: solid;
        }
        
        .file-upload-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        
        .file-upload-text {
            color: var(--clouditera-neutral-text-primary);
        }
        
        .file-upload-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-title);
            margin-bottom: 8px;
        }
        
        .file-upload-hint {
            font-size: 14px;
            color: var(--clouditera-neutral-text-secondary);
            margin-bottom: 8px;
        }
        
        .file-upload-action {
            font-size: 13px;
            color: var(--clouditera-brand-primary);
            margin-top: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .file-upload-action:hover {
            color: var(--clouditera-brand-primary-hover);
        }
        
        .file-upload-action:active {
            color: var(--clouditera-brand-primary-active);
        }
        
        /* æ–‡ä»¶ä¿¡æ¯å®¹å™¨ */
        .file-info-container {
            border: 2px solid var(--clouditera-neutral-border-primary);
            border-radius: 12px;
            padding: 20px;
            background: var(--clouditera-neutral-background-white);
            height: 240px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }
        
        .file-info-header {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-shrink: 0;
        }
        
        .file-info-icon {
            font-size: 40px;
            flex-shrink: 0;
        }
        
        .file-info-details {
            flex: 1;
            min-width: 0;
        }
        
        .file-info-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-title);
            margin-bottom: 4px;
            word-break: break-all;
        }
        
        .file-info-size {
            font-size: 13px;
            color: var(--clouditera-neutral-text-secondary);
        }
        
        .file-remove-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--clouditera-neutral-background-tertiary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            color: var(--clouditera-neutral-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .file-remove-btn:hover {
            background: var(--clouditera-neutral-background-quaternary);
            color: var(--clouditera-neutral-text-primary);
        }
        
        .file-info-actions {
            display: flex;
            justify-content: center;
            margin-top: 100px;
            flex-shrink: 0;
        }
        
        .btn-analyze {
            min-width: 160px;
            height: 40px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-analyze span {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* é”™è¯¯æç¤º */
        .file-upload-error {
            margin-top: 16px;
            padding: 12px 16px;
            background: #FEE2E2;
            border: 1px solid #FCA5A5;
            border-radius: 8px;
            color: #DC2626;
            font-size: 14px;
            text-align: center;
        }
        
        /* ==========================================
           åŒè¯­å¯¹ç…§é¡µé¢æ ·å¼
           ========================================== */
        
        .bilingual-view-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            background: var(--clouditera-neutral-background-white);
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨å·¥å…·æ  */
        .bilingual-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--clouditera-neutral-border-secondary);
            background: var(--clouditera-neutral-background-white);
            flex-shrink: 0;
            gap: 16px;
        }
        
        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }
        
        .toolbar-center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
        }
        
        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 0 0 auto;
        }
        
        .toolbar-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: 1px solid var(--clouditera-neutral-border-primary);
            background: var(--clouditera-neutral-background-white);
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            color: var(--clouditera-neutral-text-primary);
            transition: all 0.2s;
        }
        
        .toolbar-btn:hover {
            border-color: var(--clouditera-brand-primary);
            color: var(--clouditera-brand-primary);
            background: var(--clouditera-palette-blue-0);
        }
        
        .toolbar-btn:active {
            background: var(--clouditera-neutral-background-tertiary);
        }
        
        .page-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--clouditera-neutral-text-secondary);
        }
        
        .auto-zoom-btn {
            padding: 6px 12px;
            font-size: 14px;
            border: 1px solid var(--clouditera-neutral-border-primary);
            background: var(--clouditera-neutral-background-white);
            border-radius: 6px;
            cursor: pointer;
            color: var(--clouditera-neutral-text-primary);
            transition: all 0.2s;
        }
        
        .auto-zoom-btn:hover {
            border-color: var(--clouditera-brand-primary);
            color: var(--clouditera-brand-primary);
            background: var(--clouditera-palette-blue-0);
        }
        
        .download-btn {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .download-btn-primary {
            background: var(--clouditera-brand-primary);
            color: white;
        }
        
        .download-btn-primary:hover {
            background: var(--clouditera-brand-primary-hover);
        }
        
        .download-btn-secondary {
            background: var(--clouditera-neutral-background-secondary);
            color: var(--clouditera-neutral-text-primary);
            border: 1px solid var(--clouditera-neutral-border-primary);
        }
        
        .download-btn-secondary:hover {
            background: var(--clouditera-neutral-background-tertiary);
            border-color: var(--clouditera-brand-primary);
            color: var(--clouditera-brand-primary);
        }
        
        /* åŒè¯­å†…å®¹åŒºåŸŸ */
        .bilingual-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }
        
        .bilingual-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-right: 1px solid var(--clouditera-neutral-border-secondary);
        }
        
        .bilingual-column:last-child {
            border-right: none;
        }
        
        .column-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--clouditera-neutral-border-secondary);
            background: var(--clouditera-neutral-background-secondary);
            flex-shrink: 0;
        }
        
        .column-header-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--clouditera-neutral-text-title);
            margin-bottom: 4px;
        }
        
        .column-header-subtitle {
            font-size: 12px;
            color: var(--clouditera-neutral-text-secondary);
        }
        
        .column-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 32px 48px;
            background: var(--clouditera-neutral-background-white);
            line-height: 1.8;
            font-size: 14px;
            color: var(--clouditera-neutral-text-primary);
        }
        
        .column-content h1,
        .column-content h2,
        .column-content h3 {
            color: var(--clouditera-neutral-text-title);
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 16px;
        }
        
        .column-content h1 {
            font-size: 24px;
        }
        
        .column-content h2 {
            font-size: 20px;
        }
        
        .column-content h3 {
            font-size: 18px;
        }
        
        .column-content p {
            margin-bottom: 16px;
        }
        
        .column-content ul,
        .column-content ol {
            margin: 16px 0;
            padding-left: 32px;
        }
        
        .column-content li {
            margin-bottom: 8px;
        }
        
        .column-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--clouditera-neutral-border-secondary);
            background: var(--clouditera-neutral-background-secondary);
            text-align: center;
            font-size: 12px;
            color: var(--clouditera-neutral-text-secondary);
            flex-shrink: 0;
        }
        
        /* åŒæ­¥æ»šåŠ¨ */
        .bilingual-content.sync-scroll {
            position: relative;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 992px) {
            .bilingual-content {
                flex-direction: column;
            }
            
            .bilingual-column {
                border-right: none;
                border-bottom: 1px solid var(--clouditera-neutral-border-secondary);
            }
            
            .bilingual-column:last-child {
                border-bottom: none;
            }
            
            .toolbar-left,
            .toolbar-center,
            .toolbar-right {
                gap: 8px;
            }
            
            .download-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body class="agent-detail-page">
    <!-- å·¦ä¾§ä¸»å¯¼èˆªæ  - æ™ºèƒ½ä½“è¯¦æƒ…é¡µæ¨¡å¼ï¼ˆæ”¶èµ·ï¼‰ -->
    <aside class="sidebar collapsed" id="sidebar">
        <!-- Logo åŒº -->
        <div class="sidebar-logo">
            <a href="../../dashboard.html" class="logo-link" title="äº‘è„‘">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="6" fill="#2563EB"/>
                        <path d="M16 8L20 14H12L16 8Z" fill="white"/>
                        <path d="M10 18L14 24H6L10 18Z" fill="white" opacity="0.8"/>
                        <path d="M22 18L26 24H18L22 18Z" fill="white" opacity="0.8"/>
                    </svg>
                </div>
                <h1 class="logo-text">äº‘è„‘</h1>
            </a>
        </div>

        <!-- ä¸»å¯¼èˆªèœå• -->
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <!-- é¦–é¡µ - å¸¦æ”¶è—å¿«æ·å…¥å£ -->
                <div class="nav-item-home-wrapper">
                    <a href="../../dashboard.html" class="nav-item nav-item-home" title="é¦–é¡µ">
                        <span class="nav-icon">ğŸ </span>
                        <span class="nav-text">é¦–é¡µ</span>
                    </a>
                    <div class="home-menu" id="homeMenu">
                        <a href="../../dashboard.html" class="home-menu-favorite-item">
                            <span class="home-menu-favorite-icon">ğŸ </span>
                            <span class="home-menu-favorite-name">é¦–é¡µ</span>
                        </a>
                        <div class="home-menu-favorites" id="homeMenuFavorites">
                            <div class="home-menu-favorites-empty" id="homeMenuFavoritesEmpty" style="display: none;">
                                <p class="home-menu-empty-text">æš‚æ— æ”¶è—</p>
                            </div>
                            <div class="home-menu-favorites-list" id="homeMenuFavoritesList"></div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <nav class="sidebar-nav-bottom">
                <a href="../../templates.html" class="nav-item" title="UIæ¨¡æ¿">
                    <span class="nav-icon">ğŸ“</span>
                    <span class="nav-text">UIæ¨¡æ¿</span>
                </a>

                <a href="#" class="nav-item" title="å¸®åŠ©ä¸­å¿ƒ">
                    <span class="nav-icon">â“</span>
                    <span class="nav-text">å¸®åŠ©ä¸­å¿ƒ</span>
                </a>

                <a href="#" class="nav-item" title="ç”¨æˆ·åé¦ˆ">
                    <span class="nav-icon">ğŸ’¬</span>
                    <span class="nav-text">ç”¨æˆ·åé¦ˆ</span>
                </a>

                <div class="nav-item-user-wrapper">
                    <a href="#" class="nav-item nav-item-user" id="userNavItem" title="ä¸ªäººä¸­å¿ƒ">
                        <div class="user-avatar" id="userAvatar">T</div>
                        <span class="user-name" id="userName">æµ‹è¯•ç”¨æˆ·</span>
                    </a>
                    <div class="user-menu" id="userMenu">
                        <a href="../../pages/user-management.html" class="user-menu-item">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span class="nav-text">ä¸ªäººä¸­å¿ƒ</span>
                        </a>
                        <button class="user-menu-item nav-item-logout" id="logoutBtn">
                            <span class="nav-icon">ğŸšª</span>
                            <span class="nav-text">é€€å‡ºç™»å½•</span>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content-area">
        <!-- æ™ºèƒ½ä½“å¤´éƒ¨ä¿¡æ¯ -->
        <div class="agent-header">
            <div class="agent-header-main">
                <div class="agent-icon">ğŸ“„</div>
                <div class="agent-info">
                    <div class="agent-title-wrapper">
                        <h2 class="agent-title">è®ºæ–‡ç¿»è¯‘</h2>
                        <span class="agent-type">åŸºç¡€ç±»</span>
                        <span class="agent-version">v1.0.0</span>
                    </div>
                    <p class="agent-description">æ™ºèƒ½è®ºæ–‡ç¿»è¯‘æœåŠ¡ï¼Œæ”¯æŒå¤šè¯­è¨€äº’è¯‘ï¼Œå‡†ç¡®ç†è§£å­¦æœ¯æœ¯è¯­ï¼Œæä¾›é«˜è´¨é‡çš„è®ºæ–‡ç¿»è¯‘å’Œæ¶¦è‰²æœåŠ¡</p>
                </div>
            </div>
            <!-- ç®¡ç†åŠŸèƒ½æŒ‰é’®ç»„ -->
            <div class="agent-header-actions">
                <button class="btn-agent-action" title="çŸ¥è¯†åº“">
                    <span class="action-icon">ğŸ“š</span>
                    <span class="action-text">çŸ¥è¯†åº“</span>
                    <span class="action-count">(12)</span>
                </button>
                <button class="btn-agent-action" title="å·¥å…·æ’ä»¶">
                    <span class="action-icon">ğŸ”§</span>
                    <span class="action-text">å·¥å…·æ’ä»¶</span>
                    <span class="action-count">(3)</span>
                </button>
                <button class="btn-agent-action" title="æ™ºèƒ½ä½“è®¾ç½®">
                    <span class="action-icon">âš™ï¸</span>
                    <span class="action-text">è®¾ç½®</span>
                </button>
                <button class="btn btn-primary btn-sm">
                    <span>ğŸ”—</span>
                    <span>åˆ†äº«</span>
                </button>
            </div>
        </div>

        <!-- å†…å®¹å®¹å™¨ -->
        <div class="content-container">
            <!-- æ™ºèƒ½ä½“è¯¦æƒ…ä¾§å¯¼èˆª -->
            <aside class="agent-sidebar">
                <nav class="agent-nav">
                    <!-- æ–°ä»»åŠ¡æŒ‰é’® -->
                    <button class="btn-new-chat">
                        <span class="btn-icon">âœ¨</span>
                        <span class="btn-text">æ–°ä»»åŠ¡</span>
                    </button>

                    <!-- è¿‘æœŸä»»åŠ¡ -->
                    <div class="nav-group">
                        <div class="nav-group-title">è¿‘æœŸä»»åŠ¡</div>

                        <!-- è¿‘æœŸä»»åŠ¡åˆ—è¡¨ -->
                        <div class="recent-tasks-list">
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon running">â³</span>
                                <div class="task-name">ç½‘ç»œå®‰å…¨è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon running">â³</span>
                                <div class="task-name">æœºå™¨å­¦ä¹ ç ”ç©¶è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">å¯†ç å­¦è®ºæ–‡ä¸­è¯‘è‹±</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">åŒºå—é“¾æŠ€æœ¯è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">AIå®‰å…¨ç ”ç©¶è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">æ•°æ®éšç§ä¿æŠ¤è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">æ¼æ´æŒ–æ˜æŠ€æœ¯è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">å®‰å…¨åè®®åˆ†æè®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">æ¶æ„ä»£ç æ£€æµ‹è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">ç½‘ç»œå®‰å…¨æ€åŠ¿æ„ŸçŸ¥è®ºæ–‡ç¿»è¯‘</div>
                            </a>
                        </div>

                        <!-- æŸ¥çœ‹å…¨éƒ¨å…¥å£ -->
                        <a href="#" class="view-all-tasks">
                            æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡è®°å½• â†’
                        </a>
                    </div>
                </nav>
            </aside>

            <!-- ä¸»å†…å®¹åŒºåŸŸ - ç©ºçŠ¶æ€ -->
            <div class="agent-main-content">
                <div class="empty-state-container">
                    <!-- æ™ºèƒ½ä½“åç§° - ä¼˜å…ˆçº§æœ€é«˜ -->
                    <div class="empty-agent-name">
                        <span class="agent-name-text">è®ºæ–‡ç¿»è¯‘</span>
                    </div>

                    <!-- å¼•å¯¼æ–‡æ¡ˆ - æ¬¡è¦ä¼˜å…ˆçº§ -->
                    <div class="empty-state-guide">
                        <p class="empty-state-guide-text">ä¸Šä¼ è®ºæ–‡æ–‡ä»¶ï¼Œå¼€å§‹æ™ºèƒ½ç¿»è¯‘</p>
                    </div>

                    <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                    <div class="file-upload-container" id="fileUploadContainer">
                        <!-- ä¸Šä¼ åŒºåŸŸ -->
                        <div class="file-upload-area" id="fileUploadArea">
                            <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                            <div class="file-upload-icon">ğŸ“„</div>
                            <div class="file-upload-text">
                                <p class="file-upload-title">ä¸Šä¼ è®ºæ–‡æ–‡ä»¶</p>
                                <p class="file-upload-hint">æ”¯æŒ PDF æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 15MB</p>
                                <p class="file-upload-action">ç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                            </div>
                        </div>
                        
                        <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸï¼ˆä¸Šä¼ åæ˜¾ç¤ºï¼‰ -->
                        <div class="file-info-container" id="fileInfoContainer" style="display: none;">
                            <div class="file-info-header">
                                <div class="file-info-icon">ğŸ“„</div>
                                <div class="file-info-details">
                                    <div class="file-info-name" id="fileName"></div>
                                    <div class="file-info-size" id="fileSize"></div>
                                </div>
                                <button class="file-remove-btn" id="fileRemoveBtn" title="ç§»é™¤æ–‡ä»¶">âœ•</button>
                            </div>
                            <div class="file-info-actions">
                                <button class="btn btn-primary btn-analyze" id="btnAnalyze">
                                    <span>å¼€å§‹åˆ†æ</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- é”™è¯¯æç¤º -->
                        <div class="file-upload-error" id="fileUploadError" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../../js/dashboard.js"></script>
    <script src="../../components/agent-sidebar.js"></script>
    <script src="../../components/chat-input.js"></script>
    <script>
        // ==========================================
        // æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
        // ==========================================
        
        const MAX_FILE_SIZE = 15 * 1024 * 1024; // 15MB
        let selectedFile = null;
        
        // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
        function initFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInfoContainer = document.getElementById('fileInfoContainer');
            const fileRemoveBtn = document.getElementById('fileRemoveBtn');
            const btnAnalyze = document.getElementById('btnAnalyze');
            const fileUploadError = document.getElementById('fileUploadError');
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            fileUploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileInput.addEventListener('change', function(e) {
                handleFileSelect(e.target.files[0]);
            });
            
            // æ‹–æ‹½ä¸Šä¼ 
            fileUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileUploadArea.classList.add('drag-over');
            });
            
            fileUploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileUploadArea.classList.remove('drag-over');
            });
            
            fileUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileUploadArea.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });
            
            // ç§»é™¤æ–‡ä»¶
            fileRemoveBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                resetFileUpload();
            });
            
            // å¼€å§‹åˆ†ææŒ‰é’®
            btnAnalyze.addEventListener('click', function() {
                if (selectedFile) {
                    startAnalysis(selectedFile);
                }
            });
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(file) {
            if (!file) return;
            
            // éšè—é”™è¯¯æç¤º
            const fileUploadError = document.getElementById('fileUploadError');
            fileUploadError.style.display = 'none';
            
            // éªŒè¯æ–‡ä»¶æ ¼å¼
            if (!file.name.toLowerCase().endsWith('.pdf')) {
                showError('åªæ”¯æŒ PDF æ ¼å¼çš„æ–‡ä»¶');
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å°
            if (file.size > MAX_FILE_SIZE) {
                showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 15MB');
                return;
            }
            
            // ä¿å­˜æ–‡ä»¶å¹¶æ˜¾ç¤ºä¿¡æ¯
            selectedFile = file;
            displayFileInfo(file);
        }
        
        // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
        function displayFileInfo(file) {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInfoContainer = document.getElementById('fileInfoContainer');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            
            // éšè—ä¸Šä¼ åŒºåŸŸï¼Œæ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            fileUploadArea.style.display = 'none';
            fileInfoContainer.style.display = 'block';
            
            // æ˜¾ç¤ºæ–‡ä»¶åå’Œå¤§å°
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        // æ˜¾ç¤ºé”™è¯¯æç¤º
        function showError(message) {
            const fileUploadError = document.getElementById('fileUploadError');
            fileUploadError.textContent = message;
            fileUploadError.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(function() {
                fileUploadError.style.display = 'none';
            }, 3000);
        }
        
        // é‡ç½®æ–‡ä»¶ä¸Šä¼ 
        function resetFileUpload() {
            selectedFile = null;
            const fileInput = document.getElementById('fileInput');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInfoContainer = document.getElementById('fileInfoContainer');
            const fileUploadError = document.getElementById('fileUploadError');
            
            fileInput.value = '';
            // ç§»é™¤å¯èƒ½å½±å“æ ·å¼çš„ç±»
            fileUploadArea.classList.remove('drag-over');
            // é‡ç½®æ˜¾ç¤ºçŠ¶æ€
            fileUploadArea.style.display = 'flex';
            fileInfoContainer.style.display = 'none';
            fileUploadError.style.display = 'none';
        }
        
        // å¼€å§‹åˆ†æ
        function startAnalysis(file) {
            console.log('å¼€å§‹åˆ†ææ–‡ä»¶:', file.name);
            
            // ç”Ÿæˆä»»åŠ¡IDå’Œåç§°
            const taskId = 'task-' + Date.now();
            const taskName = file.name.replace(/\.pdf$/i, '') + ' - è®ºæ–‡ç¿»è¯‘';
            
            // åˆ›å»ºæ–°ä»»åŠ¡æ•°æ®
            const newTask = {
                id: taskId,
                name: taskName,
                status: 'running',
                active: true,
                fileName: file.name,
                fileSize: file.size
            };
            
            // å°†æ–°ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨å¼€å¤´
            mockTasks.unshift(newTask);
            
            // å¦‚æœä¾§è¾¹æ å®ä¾‹å­˜åœ¨ï¼Œæ›´æ–°ä»»åŠ¡åˆ—è¡¨
            if (window.agentSidebarInstance) {
                if (typeof window.agentSidebarInstance.updateTasks === 'function') {
                    window.agentSidebarInstance.updateTasks(mockTasks);
                } else if (typeof window.agentSidebarInstance.addTask === 'function') {
                    window.agentSidebarInstance.addTask(newTask);
                }
                // è®¾ç½®æ–°ä»»åŠ¡ä¸ºæ´»åŠ¨ä»»åŠ¡
                if (typeof window.agentSidebarInstance.setActiveTask === 'function') {
                    window.agentSidebarInstance.setActiveTask(newTask.id);
                }
            }
            
            // æ˜¾ç¤ºåŒè¯­å¯¹ç…§é¡µé¢
            showBilingualView(newTask, file);
        }
        
        // æ˜¾ç¤ºåŒè¯­å¯¹ç…§é¡µé¢
        function showBilingualView(task, file) {
            const chatArea = document.querySelector('.agent-main-content');
            if (!chatArea) return;
            
            // æ¨¡æ‹Ÿè®ºæ–‡å†…å®¹
            const englishContent = getMockEnglishContent();
            const chineseContent = getMockChineseContent();
            
            // åˆ›å»ºåŒè¯­å¯¹ç…§é¡µé¢HTML
            const bilingualHTML = `
                <div class="bilingual-view-container">
                    <!-- é¡¶éƒ¨å·¥å…·æ  -->
                    <div class="bilingual-toolbar">
                        <div class="toolbar-left">
                            <button class="toolbar-btn" title="æ–‡æ¡£">ğŸ“„</button>
                            <button class="toolbar-btn" title="æœç´¢">ğŸ”</button>
                            <div class="page-info">
                                <span id="currentPage">1</span>
                                <span>/</span>
                                <span id="totalPages">6</span>
                            </div>
                            <button class="toolbar-btn" id="btnPrevPage" title="ä¸Šä¸€é¡µ">â–²</button>
                            <button class="toolbar-btn" id="btnNextPage" title="ä¸‹ä¸€é¡µ">â–¼</button>
                        </div>
                        <div class="toolbar-center">
                            <button class="auto-zoom-btn" id="btnAutoZoom">+ è‡ªåŠ¨ç¼©æ”¾</button>
                        </div>
                        <div class="toolbar-right">
                            <button class="download-btn download-btn-primary" id="btnDownloadBilingual">
                                <span>ä¸‹è½½åŒè¯­PDF</span>
                            </button>
                            <button class="download-btn download-btn-secondary" id="btnDownloadTranslated">
                                <span>ä»…ä¸‹è½½è¯‘æ–‡PDF</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- åŒè¯­å†…å®¹åŒºåŸŸ -->
                    <div class="bilingual-content" id="bilingualContent">
                        <!-- å·¦ä¾§ï¼šè‹±æ–‡åŸæ–‡ -->
                        <div class="bilingual-column" id="englishColumn">
                            <div class="column-header">
                                <div class="column-header-title">Session 2: System Analysis and Design</div>
                                <div class="column-header-subtitle">IoT-S&P '19, November 15, 2019, London, United Kingdom</div>
                            </div>
                            <div class="column-content" id="englishContent">
                                ${englishContent}
                            </div>
                            <div class="column-footer">38</div>
                        </div>
                        
                        <!-- å³ä¾§ï¼šä¸­æ–‡ç¿»è¯‘ -->
                        <div class="bilingual-column" id="chineseColumn">
                            <div class="column-header">
                                <div class="column-header-title">ç¬¬2èŠ‚ï¼šç³»ç»Ÿåˆ†æä¸è®¾è®¡</div>
                                <div class="column-header-subtitle">IoT-S&P '19, 2019å¹´11æœˆ15æ—¥, è‹±å›½ä¼¦æ•¦</div>
                            </div>
                            <div class="column-content" id="chineseContent">
                                ${chineseContent}
                            </div>
                            <div class="column-footer">38</div>
                        </div>
                    </div>
                </div>
            `;
            
            // æ›¿æ¢å†…å®¹
            chatArea.innerHTML = bilingualHTML;
            
            // åˆå§‹åŒ–åŒè¯­é¡µé¢åŠŸèƒ½
            initBilingualView();
        }
        
        // åˆå§‹åŒ–åŒè¯­é¡µé¢åŠŸèƒ½
        function initBilingualView() {
            // åŒæ­¥æ»šåŠ¨
            const englishContent = document.getElementById('englishContent');
            const chineseContent = document.getElementById('chineseContent');
            
            if (englishContent && chineseContent) {
                let isScrolling = false;
                
                englishContent.addEventListener('scroll', function() {
                    if (!isScrolling) {
                        isScrolling = true;
                        const scrollRatio = englishContent.scrollTop / (englishContent.scrollHeight - englishContent.clientHeight);
                        chineseContent.scrollTop = scrollRatio * (chineseContent.scrollHeight - chineseContent.clientHeight);
                        setTimeout(() => { isScrolling = false; }, 10);
                    }
                });
                
                chineseContent.addEventListener('scroll', function() {
                    if (!isScrolling) {
                        isScrolling = true;
                        const scrollRatio = chineseContent.scrollTop / (chineseContent.scrollHeight - chineseContent.clientHeight);
                        englishContent.scrollTop = scrollRatio * (englishContent.scrollHeight - englishContent.clientHeight);
                        setTimeout(() => { isScrolling = false; }, 10);
                    }
                });
            }
            
            // é¡µç åˆ‡æ¢
            const btnPrevPage = document.getElementById('btnPrevPage');
            const btnNextPage = document.getElementById('btnNextPage');
            const currentPageEl = document.getElementById('currentPage');
            let currentPage = 1;
            const totalPages = 6;
            
            if (btnPrevPage) {
                btnPrevPage.addEventListener('click', function() {
                    if (currentPage > 1) {
                        currentPage--;
                        if (currentPageEl) currentPageEl.textContent = currentPage;
                        // TODO: åŠ è½½å¯¹åº”é¡µé¢å†…å®¹
                    }
                });
            }
            
            if (btnNextPage) {
                btnNextPage.addEventListener('click', function() {
                    if (currentPage < totalPages) {
                        currentPage++;
                        if (currentPageEl) currentPageEl.textContent = currentPage;
                        // TODO: åŠ è½½å¯¹åº”é¡µé¢å†…å®¹
                    }
                });
            }
            
            // ä¸‹è½½æŒ‰é’®
            const btnDownloadBilingual = document.getElementById('btnDownloadBilingual');
            const btnDownloadTranslated = document.getElementById('btnDownloadTranslated');
            
            if (btnDownloadBilingual) {
                btnDownloadBilingual.addEventListener('click', function() {
                    alert('ä¸‹è½½åŒè¯­PDFåŠŸèƒ½å¼€å‘ä¸­...');
                    // TODO: å®ç°ä¸‹è½½åŒè¯­PDF
                });
            }
            
            if (btnDownloadTranslated) {
                btnDownloadTranslated.addEventListener('click', function() {
                    alert('ä¸‹è½½è¯‘æ–‡PDFåŠŸèƒ½å¼€å‘ä¸­...');
                    // TODO: å®ç°ä¸‹è½½è¯‘æ–‡PDF
                });
            }
            
            // è‡ªåŠ¨ç¼©æ”¾
            const btnAutoZoom = document.getElementById('btnAutoZoom');
            if (btnAutoZoom) {
                btnAutoZoom.addEventListener('click', function() {
                    // TODO: å®ç°è‡ªåŠ¨ç¼©æ”¾åŠŸèƒ½
                    alert('è‡ªåŠ¨ç¼©æ”¾åŠŸèƒ½å¼€å‘ä¸­...');
                });
            }
        }
        
        // æ¨¡æ‹Ÿè‹±æ–‡å†…å®¹
        function getMockEnglishContent() {
            return `
                <h1>An Efficient Image Encryption Scheme for Industrial Internet-of-Things Devices</h1>
                
                <p><strong>Mingwu Zhang, Bo Peng, and Yu Chen</strong></p>
                <p>School of Computers, Hubei University of Technology</p>
                
                <h2>ABSTRACT</h2>
                <p>With the rapid development of the Internet of Things (IoT), a large number of images are transmitted in IoT networks. To protect image privacy, image encryption is essential. This paper proposes an efficient image encryption scheme for industrial IoT devices. The proposed scheme uses SHA-512 to generate the initial values of a hyperchaotic Chen system. Then, the hyperchaotic sequences are used to perform pixel scrambling based on Arnold cat map and XOR operation. The proposed scheme is applied to image encryption in Internet of Vehicles (IoVs) and Wireless Body Area Networks (WBAN). Experimental results show that the proposed scheme has good encryption performance and can resist various attacks.</p>
                
                <h2>CCS CONCEPTS</h2>
                <ul>
                    <li>Computer systems organization â†’ Embedded systems; Redundancy; Robotics;</li>
                    <li>Networks â†’ Network reliability.</li>
                </ul>
                
                <h2>KEYWORDS</h2>
                <p>Internet-of-Things; hyperchaotic system; SHA-512; Arnold cat map</p>
                
                <h2>ACM Reference Format:</h2>
                <p>Mingwu Zhang, Bo Peng, and Yu Chen. 2019. An Efficient Image Encryption Scheme for Industrial Internet-of-Things Devices. In <em>Proceedings of IoT-S&P '19, November 15, 2019, London, United Kingdom</em>, 6 pages.</p>
                
                <h2>1 INTRODUCTION</h2>
                <p>The Internet of Things (IoT) has been widely applied in various fields, such as smart cities, industrial automation, healthcare, and transportation. With the rapid development of IoT, a large number of images are transmitted in IoT networks. These images may contain sensitive information, such as personal privacy, medical records, and industrial secrets. Therefore, image encryption is essential to protect image privacy in IoT networks.</p>
                
                <p>Traditional encryption algorithms, such as Advanced Encryption Standard (AES) and Data Encryption Standard (DES), are not suitable for image encryption due to their high computational complexity and low efficiency. Chaos-based encryption algorithms have attracted much attention because of their high sensitivity to initial conditions, ergodicity, and pseudo-randomness. However, most existing chaos-based image encryption schemes are not efficient enough for resource-constrained IoT devices.</p>
                
                <p>In this paper, we propose an efficient image encryption scheme for industrial IoT devices. The main contributions of this paper are as follows:</p>
                <ul>
                    <li>We propose a novel image encryption scheme that combines SHA-512 hash function, hyperchaotic Chen system, Arnold cat map, and XOR operation.</li>
                    <li>We apply the proposed scheme to image encryption in Internet of Vehicles (IoVs) and Wireless Body Area Networks (WBAN).</li>
                    <li>We evaluate the encryption performance of the proposed scheme through extensive experiments.</li>
                </ul>
            `;
        }
        
        // æ¨¡æ‹Ÿä¸­æ–‡å†…å®¹
        function getMockChineseContent() {
            return `
                <h1>ä¸€ç§é«˜æ•ˆçš„å·¥ä¸šç‰©è”ç½‘è®¾å¤‡å›¾åƒåŠ å¯†æ–¹æ¡ˆ</h1>
                
                <p><strong>å¼ æ˜æ­¦, å½­æ³¢, é™ˆå®‡</strong></p>
                <p>æ¹–åŒ—å·¥ä¸šå¤§å­¦è®¡ç®—æœºå­¦é™¢</p>
                
                <h2>æ‘˜è¦</h2>
                <p>éšç€ç‰©è”ç½‘ï¼ˆIoTï¼‰çš„å¿«é€Ÿå‘å±•ï¼Œå¤§é‡å›¾åƒåœ¨IoTç½‘ç»œä¸­ä¼ è¾“ã€‚ä¸ºäº†ä¿æŠ¤å›¾åƒéšç§ï¼Œå›¾åƒåŠ å¯†è‡³å…³é‡è¦ã€‚æœ¬æ–‡æå‡ºäº†ä¸€ç§é€‚ç”¨äºå·¥ä¸šç‰©è”ç½‘è®¾å¤‡çš„é«˜æ•ˆå›¾åƒåŠ å¯†æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆä½¿ç”¨SHA-512ç”Ÿæˆè¶…æ··æ²ŒChenç³»ç»Ÿçš„åˆå§‹å€¼ï¼Œç„¶åä½¿ç”¨è¶…æ··æ²Œåºåˆ—æ‰§è¡ŒåŸºäºArnoldçŒ«æ˜ å°„çš„åƒç´ ç½®ä¹±å’ŒXORè¿ç®—ã€‚è¯¥æ–¹æ¡ˆåº”ç”¨äºè½¦è”ç½‘ï¼ˆIoVsï¼‰å’Œæ— çº¿ä½“åŸŸç½‘ï¼ˆWBANï¼‰ä¸­çš„å›¾åƒåŠ å¯†ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œè¯¥æ–¹æ¡ˆå…·æœ‰è‰¯å¥½çš„åŠ å¯†æ€§èƒ½ï¼Œèƒ½å¤ŸæŠµæŠ—å„ç§æ”»å‡»ã€‚</p>
                
                <h2>CCSæ¦‚å¿µ</h2>
                <ul>
                    <li>è®¡ç®—æœºç³»ç»Ÿç»„ç»‡ â†’ åµŒå…¥å¼ç³»ç»Ÿï¼›å†—ä½™ï¼›æœºå™¨äººå­¦ï¼›</li>
                    <li>ç½‘ç»œ â†’ ç½‘ç»œå¯é æ€§ã€‚</li>
                </ul>
                
                <h2>å…³é”®è¯</h2>
                <p>ç‰©è”ç½‘ï¼›è¶…æ··æ²Œç³»ç»Ÿï¼›SHA-512ï¼›ArnoldçŒ«æ˜ å°„</p>
                
                <h2>ACMå‚è€ƒæ ¼å¼ï¼š</h2>
                <p>å¼ æ˜æ­¦, å½­æ³¢, é™ˆå®‡. 2019. ä¸€ç§é«˜æ•ˆçš„å·¥ä¸šç‰©è”ç½‘è®¾å¤‡å›¾åƒåŠ å¯†æ–¹æ¡ˆ. è½½äº<em>IoT-S&P '19ä¼šè®®è®ºæ–‡é›†ï¼Œ2019å¹´11æœˆ15æ—¥ï¼Œè‹±å›½ä¼¦æ•¦</em>ï¼Œå…±6é¡µã€‚</p>
                
                <h2>1 å¼•è¨€</h2>
                <p>ç‰©è”ç½‘ï¼ˆIoTï¼‰å·²å¹¿æ³›åº”ç”¨äºå„ä¸ªé¢†åŸŸï¼Œå¦‚æ™ºæ…§åŸå¸‚ã€å·¥ä¸šè‡ªåŠ¨åŒ–ã€åŒ»ç–—ä¿å¥å’Œäº¤é€šè¿è¾“ã€‚éšç€IoTçš„å¿«é€Ÿå‘å±•ï¼Œå¤§é‡å›¾åƒåœ¨IoTç½‘ç»œä¸­ä¼ è¾“ã€‚è¿™äº›å›¾åƒå¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ä¸ªäººéšç§ã€åŒ»ç–—è®°å½•å’Œå·¥ä¸šç§˜å¯†ã€‚å› æ­¤ï¼Œå›¾åƒåŠ å¯†å¯¹äºä¿æŠ¤IoTç½‘ç»œä¸­çš„å›¾åƒéšç§è‡³å…³é‡è¦ã€‚</p>
                
                <p>ä¼ ç»Ÿçš„åŠ å¯†ç®—æ³•ï¼Œå¦‚é«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆAESï¼‰å’Œæ•°æ®åŠ å¯†æ ‡å‡†ï¼ˆDESï¼‰ï¼Œç”±äºå…¶è®¡ç®—å¤æ‚åº¦é«˜ã€æ•ˆç‡ä½ï¼Œä¸é€‚åˆå›¾åƒåŠ å¯†ã€‚åŸºäºæ··æ²Œçš„åŠ å¯†ç®—æ³•å› å…¶å¯¹åˆå§‹æ¡ä»¶çš„é«˜åº¦æ•æ„Ÿæ€§ã€éå†æ€§å’Œä¼ªéšæœºæ€§è€Œå¤‡å—å…³æ³¨ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°ç°æœ‰çš„åŸºäºæ··æ²Œçš„å›¾åƒåŠ å¯†æ–¹æ¡ˆå¯¹äºèµ„æºå—é™çš„IoTè®¾å¤‡æ¥è¯´æ•ˆç‡ä¸å¤Ÿé«˜ã€‚</p>
                
                <p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§é€‚ç”¨äºå·¥ä¸šIoTè®¾å¤‡çš„é«˜æ•ˆå›¾åƒåŠ å¯†æ–¹æ¡ˆã€‚æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®å¦‚ä¸‹ï¼š</p>
                <ul>
                    <li>æˆ‘ä»¬æå‡ºäº†ä¸€ç§ç»“åˆSHA-512å“ˆå¸Œå‡½æ•°ã€è¶…æ··æ²ŒChenç³»ç»Ÿã€ArnoldçŒ«æ˜ å°„å’ŒXORè¿ç®—çš„æ–°å‹å›¾åƒåŠ å¯†æ–¹æ¡ˆã€‚</li>
                    <li>æˆ‘ä»¬å°†æ‰€æå‡ºçš„æ–¹æ¡ˆåº”ç”¨äºè½¦è”ç½‘ï¼ˆIoVsï¼‰å’Œæ— çº¿ä½“åŸŸç½‘ï¼ˆWBANï¼‰ä¸­çš„å›¾åƒåŠ å¯†ã€‚</li>
                    <li>æˆ‘ä»¬é€šè¿‡å¤§é‡å®éªŒè¯„ä¼°äº†æ‰€æå‡ºæ–¹æ¡ˆçš„åŠ å¯†æ€§èƒ½ã€‚</li>
                </ul>
            `;
        }
        
        // ==========================================
        // åŸæœ‰ä»£ç 
        // ==========================================
        // æ¨¡æ‹Ÿä»»åŠ¡æ•°æ®
        const mockTasks = [
            { id: '1', name: 'ç½‘ç»œå®‰å…¨è®ºæ–‡ç¿»è¯‘', status: 'running', active: false },
            { id: '2', name: 'æœºå™¨å­¦ä¹ ç ”ç©¶è®ºæ–‡ç¿»è¯‘', status: 'running', active: false },
            { id: '3', name: 'å¯†ç å­¦è®ºæ–‡ä¸­è¯‘è‹±', status: 'completed', active: false },
            { id: '4', name: 'åŒºå—é“¾æŠ€æœ¯è®ºæ–‡ç¿»è¯‘', status: 'completed', active: false },
            { id: '5', name: 'AIå®‰å…¨ç ”ç©¶è®ºæ–‡ç¿»è¯‘', status: 'completed', active: false },
            { id: '6', name: 'æ•°æ®éšç§ä¿æŠ¤è®ºæ–‡ç¿»è¯‘', status: 'completed', active: false },
            { id: '7', name: 'æ¼æ´æŒ–æ˜æŠ€æœ¯è®ºæ–‡ç¿»è¯‘', status: 'completed', active: false },
            { id: '8', name: 'å®‰å…¨åè®®åˆ†æè®ºæ–‡ç¿»è¯‘', status: 'completed', active: false },
            { id: '9', name: 'æ¶æ„ä»£ç æ£€æµ‹è®ºæ–‡ç¿»è¯‘', status: 'completed', active: false },
            { id: '10', name: 'ç½‘ç»œå®‰å…¨æ€åŠ¿æ„ŸçŸ¥è®ºæ–‡ç¿»è¯‘', status: 'completed', active: false }
        ];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
            initFileUpload();
            
            // åˆå§‹åŒ–ä¾§å¯¼èˆªç»„ä»¶
            window.agentSidebarInstance = initAgentSidebar({
                tasks: mockTasks,
                maxTasks: 10,
                onNewTask: function() {
                    console.log('åˆ›å»ºæ–°ç¿»è¯‘ä»»åŠ¡');
                    // ç‚¹å‡»æ–°ä»»åŠ¡æŒ‰é’®æ—¶ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€é¡µé¢
                    var chatArea = document.querySelector('.agent-main-content');
                    if (!chatArea) return;

                    // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç©ºçŠ¶æ€å®¹å™¨
                    var emptyStateContainer = document.querySelector('.empty-state-container');
                    var taskContent = document.querySelector('.task-detail-content');
                    var tasksList = document.querySelector('.tasks-list-container');

                    // å¦‚æœå·²æœ‰ç©ºçŠ¶æ€å®¹å™¨ï¼Œç›´æ¥æ˜¾ç¤º
                    if (emptyStateContainer) {
                        emptyStateContainer.style.display = 'flex';
                        if (taskContent) taskContent.style.display = 'none';
                        if (tasksList) tasksList.style.display = 'none';
                        // é‡æ–°åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
                        setTimeout(function() {
                            initFileUpload();
                            resetFileUpload();
                        }, 100);
                        return;
                    }

                    // å¦åˆ™é‡æ–°åˆ›å»ºç©ºçŠ¶æ€é¡µé¢
                    chatArea.innerHTML = '<div class="empty-state-container">' +
                        '<div class="empty-agent-name">' +
                            '<span class="agent-name-text">è®ºæ–‡ç¿»è¯‘</span>' +
                        '</div>' +
                        '<div class="empty-state-guide">' +
                            '<p class="empty-state-guide-text">ä¸Šä¼ è®ºæ–‡æ–‡ä»¶ï¼Œå¼€å§‹æ™ºèƒ½ç¿»è¯‘</p>' +
                        '</div>' +
                        '<div class="file-upload-container" id="fileUploadContainer">' +
                            '<div class="file-upload-area" id="fileUploadArea">' +
                                '<input type="file" id="fileInput" accept=".pdf" style="display: none;">' +
                                '<div class="file-upload-icon">ğŸ“„</div>' +
                                '<div class="file-upload-text">' +
                                    '<p class="file-upload-title">ä¸Šä¼ è®ºæ–‡æ–‡ä»¶</p>' +
                                    '<p class="file-upload-hint">æ”¯æŒ PDF æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 15MB</p>' +
                                    '<p class="file-upload-action">ç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>' +
                                '</div>' +
                            '</div>' +
                            '<div class="file-info-container" id="fileInfoContainer" style="display: none;">' +
                                '<div class="file-info-header">' +
                                    '<div class="file-info-icon">ğŸ“„</div>' +
                                    '<div class="file-info-details">' +
                                        '<div class="file-info-name" id="fileName"></div>' +
                                        '<div class="file-info-size" id="fileSize"></div>' +
                                    '</div>' +
                                    '<button class="file-remove-btn" id="fileRemoveBtn" title="ç§»é™¤æ–‡ä»¶">âœ•</button>' +
                                '</div>' +
                                '<div class="file-info-actions">' +
                                    '<button class="btn btn-primary btn-analyze" id="btnAnalyze">' +
                                        '<span>å¼€å§‹åˆ†æ</span>' +
                                    '</button>' +
                                '</div>' +
                            '</div>' +
                            '<div class="file-upload-error" id="fileUploadError" style="display: none;"></div>' +
                        '</div>' +
                    '</div>';
                    
                    // é‡æ–°åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
                    setTimeout(function() {
                        initFileUpload();
                    }, 100);
                },
                onTaskClick: function(taskId, taskData) {
                    console.log('[DEBUG] ç‚¹å‡»ä»»åŠ¡:', taskId, taskData);

                    try {
                        var chatArea = document.querySelector('.agent-main-content');
                        if (!chatArea) {
                            console.error('[DEBUG] æœªæ‰¾åˆ°chatArea');
                            return;
                        }

                        console.log('[DEBUG] æ‰¾åˆ°chatArea');

                        // æ¸…ç©ºchatAreaå†…å®¹ï¼Œé‡æ–°åˆ›å»ºä»»åŠ¡è¯¦æƒ…
                        var taskName = (taskData && taskData.name) ? taskData.name : 'æœªçŸ¥ä»»åŠ¡';

                        // æ¸…ç©ºchatAreaå¹¶é‡æ–°åˆ›å»ºä»»åŠ¡è¯¦æƒ…
                        chatArea.innerHTML = '';

                        var taskContent = document.createElement('div');
                        taskContent.className = 'task-detail-content';

                        taskContent.innerHTML = '<div class="chat-header">' +
                            '<div class="chat-title">' + taskName + '</div>' +
                            '<div class="chat-time">åˆšåˆš</div>' +
                        '</div>' +
                        '<div class="chat-messages">' +
                            '<div class="message message-user">' +
                                '<div class="message-avatar">ğŸ‘¤</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">è¯·å¸®æˆ‘ç¿»è¯‘è¿™ç¯‡è®ºæ–‡çš„æ‘˜è¦éƒ¨åˆ†ã€‚</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="message message-ai">' +
                                '<div class="message-avatar">ğŸ¤–</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">å¥½çš„ï¼Œæˆ‘å°†ä¸ºæ‚¨ç¿»è¯‘è®ºæ–‡æ‘˜è¦ã€‚è¯·æä¾›éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬å†…å®¹ï¼Œæˆ‘ä¼šç¡®ä¿å‡†ç¡®ç†è§£å­¦æœ¯æœ¯è¯­å¹¶æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="message message-user">' +
                                '<div class="message-avatar">ğŸ‘¤</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">æ”¯æŒå“ªäº›è¯­è¨€å¯¹ï¼Ÿ</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="message message-ai">' +
                                '<div class="message-avatar">ğŸ¤–</div>' +
                                '<div class="message-content">' +
                                    '<div class="message-time">åˆšåˆš</div>' +
                                    '<div class="message-text">æˆ‘æ”¯æŒå¤šç§è¯­è¨€äº’è¯‘ï¼ŒåŒ…æ‹¬ï¼š<br>1. ä¸­è‹±æ–‡äº’è¯‘ï¼ˆæœ€å¸¸ç”¨ï¼‰<br>2. è‹±æ–‡ä¸å…¶ä»–ä¸»è¦è¯­è¨€ï¼ˆæ³•è¯­ã€å¾·è¯­ã€æ—¥è¯­ç­‰ï¼‰<br>3. å­¦æœ¯æœ¯è¯­çš„å‡†ç¡®ç¿»è¯‘å’Œæ¶¦è‰²</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="chat-input-container" data-container-mode="fixed">' +
                            '<div class="chat-input-wrapper">' +
                                '<textarea class="chat-input" placeholder="è¾“å…¥éœ€è¦ç¿»è¯‘çš„è®ºæ–‡å†…å®¹æˆ–ç²˜è´´æ–‡æœ¬..." rows="3"></textarea>' +
                                '<div class="chat-input-toolbar">' +
                                    '<div class="chat-input-actions">' +
                                        '<button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶">ğŸ“</button>' +
                                        '<button class="btn-icon" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸</button>' +
                                        '<button class="btn-icon" title="æ’å…¥ä»£ç ">ğŸ’»</button>' +
                                        '<button class="btn-icon" title="æ’å…¥è¡¨æ ¼">ğŸ“Š</button>' +
                                    '</div>' +
                                    '<button class="btn btn-primary chat-send">' +
                                        '<span>å‘é€</span>' +
                                        '<span class="send-shortcut">Shift+Enter</span>' +
                                    '</button>' +
                                '</div>' +
                            '</div>' +
                        '</div>';

                        chatArea.appendChild(taskContent);
                        taskContent.style.display = 'flex';

                        console.log('[DEBUG] ä»»åŠ¡è¯¦æƒ…å·²åˆ›å»ºå¹¶æ˜¾ç¤º');

                        // æ»šåŠ¨åˆ°åº•éƒ¨
                        setTimeout(function() {
                            var chatMessages = taskContent.querySelector('.chat-messages');
                            if (chatMessages) {
                                chatMessages.scrollTop = chatMessages.scrollHeight;
                            }
                        }, 100);
                    } catch (error) {
                        console.error('[DEBUG] é”™è¯¯:', error);
                    }
                },
                onViewAll: function() {
                    console.log('æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡');
                    showAllTasks();
                }
            });

        });

        // æ˜¾ç¤ºå…¨éƒ¨ä»»åŠ¡åˆ—è¡¨
        function showAllTasks() {
            var chatArea = document.querySelector('.agent-main-content');
            if (!chatArea) return;

            // ç”Ÿæˆä»»åŠ¡åˆ—è¡¨HTML
            var tasksHtml = '';
            for (var i = 0; i < mockTasks.length; i++) {
                var task = mockTasks[i];
                var statusIcon = task.status === 'running' ? 'â³' :
                                task.status === 'completed' ? 'âœ…' : 'âŒ';
                var statusClass = task.status;

                tasksHtml += '<div class="task-record-card" data-task-id="' + task.id + '">' +
                    '<div class="task-record-left">' +
                        '<div class="task-record-header">' +
                            '<div class="task-record-status">' +
                                '<span class="task-status-badge ' + statusClass + '">' + statusIcon + '</span>' +
                            '</div>' +
                            '<div class="task-record-name">' + task.name + '</div>' +
                        '</div>' +
                        '<div class="task-record-statistics">' +
                            '<span class="statistics-label">æ¶ˆæ¯æ•°</span>' +
                            '<span class="statistics-value">' + (4 + Math.floor(Math.random() * 6)) + ' æ¡</span>' +
                        '</div>' +
                    '</div>' +
                    '<div class="task-record-right">' +
                        '<div class="task-record-time">2025-12-19 14:30</div>' +
                        '<div class="task-record-actions">' +
                            '<button class="task-action-btn">æŸ¥çœ‹</button>' +
                            '<button class="task-action-btn">åˆ é™¤</button>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }

            if (mockTasks.length === 0) {
                tasksHtml = '<div class="tasks-empty">æš‚æ— ä»»åŠ¡è®°å½•</div>';
            }

            // æ›¿æ¢å†…å®¹
            chatArea.innerHTML = '<div class="tasks-list-container">' +
                '<div class="tasks-list-header">' +
                    '<h2 class="tasks-list-title">å…¨éƒ¨ä»»åŠ¡è®°å½•</h2>' +
                '</div>' +
                '<div class="tasks-list-content">' +
                    tasksHtml +
                '</div>' +
            '</div>';

            // ç»‘å®šä»»åŠ¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
            var taskCards = chatArea.querySelectorAll('.task-record-card');
            for (var i = 0; i < taskCards.length; i++) {
                taskCards[i].addEventListener('click', function(e) {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘å¡ç‰‡ç‚¹å‡»
                    if (e.target.classList.contains('task-action-btn')) {
                        e.stopPropagation();
                        var btnText = e.target.textContent;
                        var taskId = this.getAttribute('data-task-id');

                        if (btnText === 'æŸ¥çœ‹') {
                            // æŸ¥æ‰¾å¯¹åº”çš„ä»»åŠ¡å¹¶æ˜¾ç¤ºè¯¦æƒ…
                            var selectedTask = null;
                            for (var j = 0; j < mockTasks.length; j++) {
                                if (mockTasks[j].id === taskId) {
                                    selectedTask = mockTasks[j];
                                    break;
                                }
                            }

                            if (selectedTask) {
                                // è°ƒç”¨ç°æœ‰çš„ä»»åŠ¡ç‚¹å‡»å›è°ƒ
                                var sidebarInstance = window.agentSidebarInstance;
                                if (sidebarInstance && sidebarInstance.setActiveTask) {
                                    sidebarInstance.setActiveTask(taskId);
                                }

                                // æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…ï¼ˆå¤ç”¨ä¹‹å‰çš„ä»£ç ï¼‰
                                showTaskDetailById(taskId, selectedTask);
                            }
                        } else if (btnText === 'åˆ é™¤') {
                            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å—ï¼Ÿ')) {
                                console.log('åˆ é™¤ä»»åŠ¡:', taskId);
                            }
                        }
                        return;
                    }

                    // ç‚¹å‡»å¡ç‰‡å…¶ä»–åŒºåŸŸï¼Œæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
                    var taskId = this.getAttribute('data-task-id');
                    var selectedTask = null;
                    for (var j = 0; j < mockTasks.length; j++) {
                        if (mockTasks[j].id === taskId) {
                            selectedTask = mockTasks[j];
                            break;
                        }
                    }

                    if (selectedTask) {
                        showTaskDetailById(taskId, selectedTask);
                    }
                });
            }
        }

        // æ ¹æ®ä»»åŠ¡IDæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
        function showTaskDetailById(taskId, taskData) {
            var chatArea = document.querySelector('.agent-main-content');
            if (!chatArea) return;

            var taskName = taskData ? taskData.name : 'æœªçŸ¥ä»»åŠ¡';

            var taskContent = document.createElement('div');
            taskContent.className = 'task-detail-content';

            taskContent.innerHTML = '<div class="chat-header">' +
                '<div class="chat-title">' + taskName + '</div>' +
                '<div class="chat-time">åˆšåˆš</div>' +
            '</div>' +
            '<div class="chat-messages">' +
                '<div class="message message-user">' +
                    '<div class="message-avatar">ğŸ‘¤</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">è¯·å¸®æˆ‘ç¿»è¯‘è¿™ç¯‡è®ºæ–‡çš„æ‘˜è¦éƒ¨åˆ†ã€‚</div>' +
                    '</div>' +
                '</div>' +
                '<div class="message message-ai">' +
                    '<div class="message-avatar">ğŸ¤–</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">å¥½çš„ï¼Œæˆ‘å°†ä¸ºæ‚¨ç¿»è¯‘è®ºæ–‡æ‘˜è¦ã€‚è¯·æä¾›éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬å†…å®¹ï¼Œæˆ‘ä¼šç¡®ä¿å‡†ç¡®ç†è§£å­¦æœ¯æœ¯è¯­å¹¶æä¾›é«˜è´¨é‡çš„ç¿»è¯‘ã€‚</div>' +
                    '</div>' +
                '</div>' +
                '<div class="message message-user">' +
                    '<div class="message-avatar">ğŸ‘¤</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">æ”¯æŒå“ªäº›è¯­è¨€å¯¹ï¼Ÿ</div>' +
                    '</div>' +
                '</div>' +
                '<div class="message message-ai">' +
                    '<div class="message-avatar">ğŸ¤–</div>' +
                    '<div class="message-content">' +
                        '<div class="message-time">åˆšåˆš</div>' +
                        '<div class="message-text">æˆ‘æ”¯æŒå¤šç§è¯­è¨€äº’è¯‘ï¼ŒåŒ…æ‹¬ï¼š<br>1. ä¸­è‹±æ–‡äº’è¯‘ï¼ˆæœ€å¸¸ç”¨ï¼‰<br>2. è‹±æ–‡ä¸å…¶ä»–ä¸»è¦è¯­è¨€ï¼ˆæ³•è¯­ã€å¾·è¯­ã€æ—¥è¯­ç­‰ï¼‰<br>3. å­¦æœ¯æœ¯è¯­çš„å‡†ç¡®ç¿»è¯‘å’Œæ¶¦è‰²</div>' +
                    '</div>' +
                '</div>' +
            '</div>' +
            '<div class="chat-input-container" data-container-mode="fixed">' +
                '<div class="chat-input-wrapper">' +
                    '<textarea class="chat-input" placeholder="è¾“å…¥éœ€è¦ç¿»è¯‘çš„è®ºæ–‡å†…å®¹æˆ–ç²˜è´´æ–‡æœ¬..." rows="3"></textarea>' +
                    '<div class="chat-input-toolbar">' +
                        '<div class="chat-input-actions">' +
                            '<button class="btn-icon" title="ä¸Šä¼ æ–‡ä»¶">ğŸ“</button>' +
                            '<button class="btn-icon" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸</button>' +
                            '<button class="btn-icon" title="æ’å…¥ä»£ç ">ğŸ’»</button>' +
                            '<button class="btn-icon" title="æ’å…¥è¡¨æ ¼">ğŸ“Š</button>' +
                        '</div>' +
                        '<button class="btn btn-primary chat-send">' +
                            '<span>å‘é€</span>' +
                            '<span class="send-shortcut">Shift+Enter</span>' +
                        '</button>' +
                    '</div>' +
                '</div>' +
            '</div>';

            chatArea.innerHTML = '';
            chatArea.appendChild(taskContent);
            taskContent.style.display = 'flex';

            // æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(function() {
                var chatMessages = taskContent.querySelector('.chat-messages');
                if (chatMessages) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }, 100);
        }

        // å¿«é€Ÿæç¤ºå¡«å……åŠŸèƒ½
        function fillPrompt(text) {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = text;
                input.focus();
            }
        }
    </script>
</body>
</html>

