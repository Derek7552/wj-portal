<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¤¾å·¥é’“é±¼ - æ™ºèƒ½è¯†åˆ«å’Œåˆ†æç¤¾å·¥é’“é±¼æ”»å‡»">
    <title>ç¤¾å·¥é’“é±¼ | äº‘è„‘</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/dashboard.css">
    <link rel="stylesheet" href="../../templates/css/template-detail.css">
    <link rel="stylesheet" href="../../components/agent-sidebar.css">
    <link rel="stylesheet" href="../../components/chat-input.css">
    <link rel="stylesheet" href="../css/phishing-detail.css">
</head>
<body class="agent-detail-page">
    <!-- å·¦ä¾§ä¸»å¯¼èˆªæ  - æ™ºèƒ½ä½“è¯¦æƒ…é¡µæ¨¡å¼ï¼ˆæ”¶èµ·ï¼‰ -->
    <aside class="sidebar collapsed" id="sidebar">
        <!-- Logo åŒº -->
        <div class="sidebar-logo">
            <a href="../../dashboard.html" class="logo-link" title="äº‘è„‘">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="6" fill="#2563EB"/>
                        <path d="M16 8L20 14H12L16 8Z" fill="white"/>
                        <path d="M10 18L14 24H6L10 18Z" fill="white" opacity="0.8"/>
                        <path d="M22 18L26 24H18L22 18Z" fill="white" opacity="0.8"/>
                    </svg>
                </div>
                <h1 class="logo-text">äº‘è„‘</h1>
            </a>
        </div>

        <!-- ä¸»å¯¼èˆªèœå• -->
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <!-- é¦–é¡µ - å¸¦æ”¶è—å¿«æ·å…¥å£ -->
                <div class="nav-item-home-wrapper">
                    <a href="../../dashboard.html" class="nav-item nav-item-home" title="é¦–é¡µ">
                        <span class="nav-icon">ğŸ </span>
                        <span class="nav-text">é¦–é¡µ</span>
                    </a>
                    <div class="home-menu" id="homeMenu">
                        <a href="../../dashboard.html" class="home-menu-favorite-item">
                            <span class="home-menu-favorite-icon">ğŸ </span>
                            <span class="home-menu-favorite-name">é¦–é¡µ</span>
                        </a>
                        <div class="home-menu-favorites" id="homeMenuFavorites">
                            <div class="home-menu-favorites-empty" id="homeMenuFavoritesEmpty" style="display: none;">
                                <p class="home-menu-empty-text">æš‚æ— æ”¶è—</p>
                            </div>
                            <div class="home-menu-favorites-list" id="homeMenuFavoritesList"></div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <nav class="sidebar-nav-bottom">
                <a href="../../templates.html" class="nav-item" title="UIæ¨¡æ¿">
                    <span class="nav-icon">ğŸ“</span>
                    <span class="nav-text">UIæ¨¡æ¿</span>
                </a>

                <a href="#" class="nav-item" title="å¸®åŠ©ä¸­å¿ƒ">
                    <span class="nav-icon">â“</span>
                    <span class="nav-text">å¸®åŠ©ä¸­å¿ƒ</span>
                </a>

                <a href="#" class="nav-item" title="ç”¨æˆ·åé¦ˆ">
                    <span class="nav-icon">ğŸ’¬</span>
                    <span class="nav-text">ç”¨æˆ·åé¦ˆ</span>
                </a>

                <div class="nav-item-user-wrapper">
                    <a href="#" class="nav-item nav-item-user" id="userNavItem" title="ä¸ªäººä¸­å¿ƒ">
                        <div class="user-avatar" id="userAvatar">T</div>
                        <span class="user-name" id="userName">æµ‹è¯•ç”¨æˆ·</span>
                    </a>
                    <div class="user-menu" id="userMenu">
                        <a href="../../pages/user-management.html" class="user-menu-item">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span class="nav-text">ä¸ªäººä¸­å¿ƒ</span>
                        </a>
                        <button class="user-menu-item nav-item-logout" id="logoutBtn">
                            <span class="nav-icon">ğŸšª</span>
                            <span class="nav-text">é€€å‡ºç™»å½•</span>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content-area">
        <!-- æ™ºèƒ½ä½“å¤´éƒ¨ä¿¡æ¯ -->
        <div class="agent-header">
            <div class="agent-header-main">
                <div class="agent-icon">ğŸ£</div>
                <div class="agent-info">
                    <div class="agent-title-wrapper">
                        <h2 class="agent-title">ç¤¾å·¥é’“é±¼</h2>
                        <span class="agent-type">åŸºç¡€ç±»</span>
                        <span class="agent-version">v1.1.0</span>
                    </div>
                    <p class="agent-description">æ™ºèƒ½è¯†åˆ«å’Œåˆ†æç¤¾å·¥é’“é±¼æ”»å‡»ï¼Œæ£€æµ‹å¯ç–‘é‚®ä»¶ã€é“¾æ¥å’Œç¤¾äº¤å·¥ç¨‹æ‰‹æ®µï¼Œæä¾›ä¸“ä¸šçš„é’“é±¼é˜²æŠ¤å»ºè®®å’Œå®‰å…¨åŸ¹è®­</p>
                </div>
            </div>
            <!-- ç®¡ç†åŠŸèƒ½æŒ‰é’®ç»„ -->
            <div class="agent-header-actions">
                <button class="btn-agent-action" title="çŸ¥è¯†åº“">
                    <span class="action-icon">ğŸ“š</span>
                    <span class="action-text">çŸ¥è¯†åº“</span>
                    <span class="action-count">(25)</span>
                </button>
                <button class="btn-agent-action" title="å·¥å…·æ’ä»¶">
                    <span class="action-icon">ğŸ”§</span>
                    <span class="action-text">å·¥å…·æ’ä»¶</span>
                    <span class="action-count">(8)</span>
                </button>
                <button class="btn-agent-action" title="æ™ºèƒ½ä½“è®¾ç½®">
                    <span class="action-icon">âš™ï¸</span>
                    <span class="action-text">è®¾ç½®</span>
                </button>
                <button class="btn btn-primary btn-sm">
                    <span>ğŸ”—</span>
                    <span>åˆ†äº«</span>
                </button>
            </div>
        </div>

        <!-- å†…å®¹å®¹å™¨ -->
        <div class="content-container">
            <!-- æ™ºèƒ½ä½“è¯¦æƒ…ä¾§å¯¼èˆª -->
            <aside class="agent-sidebar">
                <nav class="agent-nav">
                    <!-- æ–°ä»»åŠ¡æŒ‰é’® -->
                    <button class="btn-new-chat">
                        <span class="btn-icon">âœ¨</span>
                        <span class="btn-text">æ–°ä»»åŠ¡</span>
                    </button>

                    <!-- è¿‘æœŸä»»åŠ¡ -->
                    <div class="nav-group">
                        <div class="nav-group-title">è¿‘æœŸä»»åŠ¡</div>

                        <!-- è¿‘æœŸä»»åŠ¡åˆ—è¡¨ -->
                        <div class="recent-tasks-list">
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon running">â³</span>
                                <div class="task-name">å¯ç–‘é‚®ä»¶åˆ†æ</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon running">â³</span>
                                <div class="task-name">é’“é±¼é“¾æ¥æ£€æµ‹</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">ç¤¾äº¤å·¥ç¨‹æ”»å‡»è¯†åˆ«</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">é’“é±¼ç½‘ç«™åˆ†æ</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">é‚®ä»¶å®‰å…¨åŸ¹è®­</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">é’“é±¼é˜²æŠ¤å»ºè®®</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">å¯ç–‘åŸŸåæ£€æµ‹</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">ç¤¾äº¤å·¥ç¨‹æ‰‹æ®µåˆ†æ</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">é’“é±¼é‚®ä»¶ç‰¹å¾è¯†åˆ«</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">âœ…</span>
                                <div class="task-name">å®‰å…¨é˜²æŠ¤ç­–ç•¥å’¨è¯¢</div>
                            </a>
                        </div>

                        <!-- æŸ¥çœ‹å…¨éƒ¨å…¥å£ -->
                        <a href="#" class="view-all-tasks">
                            æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡è®°å½• â†’
                        </a>
                    </div>
                </nav>
            </aside>

            <!-- å·¦ä¾§ï¼šç¤¾å·¥é…ç½® -->
            <aside class="phishing-config-panel">
                    <div class="config-header">
                        <h3 class="config-title">ç¤¾å·¥é…ç½®</h3>
                        <button class="config-refresh-btn" id="configRefreshBtn" title="åˆ·æ–°">
                            ğŸ”„
                        </button>
                    </div>

                    <form class="config-form" id="phishingConfigForm">
                        <div class="config-form-group">
                            <label class="config-form-label" for="emailSubject">é‚®ä»¶ä¸»é¢˜</label>
                            <input
                                type="text"
                                id="emailSubject"
                                class="config-form-input"
                                placeholder="è¾“å…¥é‚®ä»¶ä¸»é¢˜"
                            />
                        </div>

                        <div class="config-form-group">
                            <label class="config-form-label" for="phishingPurpose">ç¤¾å·¥ç›®çš„</label>
                            <textarea
                                id="phishingPurpose"
                                class="config-form-input config-form-textarea"
                                placeholder="è¾“å…¥è·å–ç›®æ ‡ä¿¡æ¯çš„ç±»å‹"
                                rows="4"
                            ></textarea>
                        </div>

                        <div class="config-form-group">
                            <label class="config-form-label" for="senderAttr">å‘ä»¶äººå±æ€§</label>
                            <input
                                type="text"
                                id="senderAttr"
                                class="config-form-input"
                                placeholder="è¾“å…¥å‘ä»¶äººå§“åä¸èŒä½,ä¾‹å¦‚:å¼ ä¸‰,äººåŠ›æ€»ç›‘"
                            />
                        </div>

                        <div class="config-form-group">
                            <label class="config-form-label" for="recipientAttr">æ”¶ä»¶äººå±æ€§</label>
                            <input
                                type="text"
                                id="recipientAttr"
                                class="config-form-input"
                                placeholder="è¾“å…¥æ”¶ä»¶äººå§“åä¸èŒä½,ä¾‹å¦‚:æå››,å®‰å…¨ä¸­å¿ƒ"
                            />
                        </div>

                        <div class="advanced-config">
                            <div class="advanced-config-header">
                                <h4 class="advanced-config-title">é«˜çº§é…ç½®</h4>
                                <div class="toggle-switch" id="advancedToggle">
                                </div>
                            </div>
                        </div>
                    </form>
            </aside>

            <!-- å³ä¾§ï¼šå¯¹è¯åŒºåŸŸ -->
            <div class="phishing-chat-panel">
                    <!-- è­¦å‘Šæ¨ªå¹… -->
                    <div class="chat-warning-banner" id="warningBanner">
                        <span class="chat-warning-text">æ³¨æ„: æœ¬æ™ºèƒ½ä½“ä¸ä¼šä¿ç•™å†å²è®°å½•, å¯¹è¯æ•°æ®è¯·å¤‡ä»½</span>
                        <button class="chat-warning-close" id="warningCloseBtn" title="å…³é—­">âœ•</button>
                    </div>

                    <!-- å¯¹è¯æ¶ˆæ¯åŒºåŸŸ -->
                    <div class="chat-messages" id="chatMessagesArea">
                        <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                    </div>

                    <!-- è¾“å…¥åŒºåŸŸ - ä½¿ç”¨ç»Ÿä¸€ç»„ä»¶æ ·å¼ -->
                    <div class="chat-input-container" data-container-mode="fixed">
                        <div class="chat-input-wrapper">
                            <textarea
                                class="chat-input"
                                id="phishingChatInput"
                                placeholder="æ ¹æ®è¦æ±‚å†™ä¸€å°é’“é±¼é‚®ä»¶"
                                rows="3"
                            ></textarea>
                            <div class="chat-input-toolbar">
                                <div class="chat-input-actions">
                                    <button class="btn-icon" id="attachBtn" title="ä¸Šä¼ æ–‡ä»¶" data-action="upload">
                                        ğŸ“
                                    </button>
                                </div>
                                <button class="btn btn-primary chat-send" id="phishingSendBtn">
                                    <span>å‘é€</span>
                                    <span class="send-shortcut">Enter</span>
                                </button>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
    </main>

    <script src="../../js/dashboard.js"></script>
    <script src="../../components/agent-sidebar.js"></script>
    <script src="../../components/chat-input.js"></script>
    <script src="../../templates/js/template-detail.js"></script>
    <script>
        // æ¨¡æ‹Ÿä»»åŠ¡æ•°æ®
        const mockTasks = [
            { id: '1', name: 'å¯ç–‘é‚®ä»¶åˆ†æ', status: 'running', active: false },
            { id: '2', name: 'é’“é±¼é“¾æ¥æ£€æµ‹', status: 'running', active: false },
            { id: '3', name: 'ç¤¾äº¤å·¥ç¨‹æ”»å‡»è¯†åˆ«', status: 'completed', active: false },
            { id: '4', name: 'é’“é±¼ç½‘ç«™åˆ†æ', status: 'completed', active: false },
            { id: '5', name: 'é‚®ä»¶å®‰å…¨åŸ¹è®­', status: 'completed', active: false },
            { id: '6', name: 'é’“é±¼é˜²æŠ¤å»ºè®®', status: 'completed', active: false },
            { id: '7', name: 'å¯ç–‘åŸŸåæ£€æµ‹', status: 'completed', active: false },
            { id: '8', name: 'ç¤¾äº¤å·¥ç¨‹æ‰‹æ®µåˆ†æ', status: 'completed', active: false },
            { id: '9', name: 'é’“é±¼é‚®ä»¶ç‰¹å¾è¯†åˆ«', status: 'completed', active: false },
            { id: '10', name: 'å®‰å…¨é˜²æŠ¤ç­–ç•¥å’¨è¯¢', status: 'completed', active: false }
        ];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è­¦å‘Šæ¨ªå¹…å…³é—­
            const warningBanner = document.getElementById('warningBanner');
            const warningCloseBtn = document.getElementById('warningCloseBtn');
            
            if (warningCloseBtn && warningBanner) {
                warningCloseBtn.addEventListener('click', function() {
                    warningBanner.style.display = 'none';
                });
            }

            // é«˜çº§é…ç½®å¼€å…³
            const advancedToggle = document.getElementById('advancedToggle');
            if (advancedToggle) {
                advancedToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            }

            // åˆ·æ–°é…ç½®æŒ‰é’®
            const configRefreshBtn = document.getElementById('configRefreshBtn');
            if (configRefreshBtn) {
                configRefreshBtn.addEventListener('click', function() {
                    // æ·»åŠ æ—‹è½¬åŠ¨ç”»
                    this.style.transform = 'rotate(360deg)';
                    this.style.transition = 'transform 0.5s';
                    
                    setTimeout(() => {
                        this.style.transform = 'rotate(0deg)';
                        // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ·æ–°é…ç½®çš„é€»è¾‘
                        console.log('åˆ·æ–°é…ç½®');
                    }, 500);
                });
            }

            // è¾“å…¥æ¡†è‡ªåŠ¨è°ƒæ•´é«˜åº¦ - ä½¿ç”¨ç»Ÿä¸€ç»„ä»¶çš„é«˜åº¦é™åˆ¶
            const chatInput = document.getElementById('phishingChatInput');
            if (chatInput) {
                chatInput.addEventListener('input', function() {
                    // ç»Ÿä¸€ç»„ä»¶å·²å¤„ç†é«˜åº¦é™åˆ¶ï¼Œè¿™é‡Œåªéœ€è¦é‡ç½®é«˜åº¦è®©æµè§ˆå™¨è‡ªåŠ¨è®¡ç®—
                    this.style.height = 'auto';
                    // chat-input çš„ min-height æ˜¯ 120pxï¼Œmax-height ç”±ç»„ä»¶æ§åˆ¶
                });
            }

            // å‘é€æ¶ˆæ¯
            const sendBtn = document.getElementById('phishingSendBtn');
            const chatMessagesArea = document.getElementById('chatMessagesArea');
            
            function sendMessage() {
                if (!chatInput || !chatMessagesArea) return;
                
                const message = chatInput.value.trim();
                if (!message) return;

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                addUserMessage(message);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                chatInput.value = '';
                chatInput.style.height = 'auto';

                // æ¨¡æ‹ŸAIå›å¤
                setTimeout(() => {
                    addAIMessage('æ ¹æ®æ‚¨çš„é…ç½®è¦æ±‚ï¼Œæ­£åœ¨ç”Ÿæˆé’“é±¼é‚®ä»¶...');
                }, 1000);
            }

            function addUserMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message message-user';
                messageDiv.innerHTML = `
                    <div class="message-avatar">ğŸ‘¤</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${escapeHtml(text)}</p>
                        </div>
                    </div>
                `;
                chatMessagesArea.appendChild(messageDiv);
                scrollToBottom();
            }

            function addAIMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.innerHTML = `
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${escapeHtml(text)}</p>
                        </div>
                    </div>
                `;
                chatMessagesArea.appendChild(messageDiv);
                scrollToBottom();
            }

            function scrollToBottom() {
                if (chatMessagesArea) {
                    chatMessagesArea.scrollTop = chatMessagesArea.scrollHeight;
                }
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }

            if (chatInput) {
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }


            // é™„ä»¶æŒ‰é’®
            const attachBtn = document.getElementById('attachBtn');
            if (attachBtn) {
                attachBtn.addEventListener('click', function() {
                    console.log('ä¸Šä¼ æ–‡ä»¶');
                    // å®ç°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
                });
            }

            // åˆå§‹åŒ–ä¾§å¯¼èˆªç»„ä»¶
            initAgentSidebar({
                tasks: mockTasks,
                maxTasks: 10,
                onNewTask: function() {
                    console.log('åˆ›å»ºæ–°ä»»åŠ¡');
                    // æ¸…ç©ºæ¶ˆæ¯åŒºåŸŸ
                    if (chatMessagesArea) {
                        chatMessagesArea.innerHTML = '';
                    }
                    // é‡ç½®è¡¨å•
                    const form = document.getElementById('phishingConfigForm');
                    if (form) {
                        form.reset();
                    }
                },
                onTaskClick: function(taskId, taskData) {
                    console.log('[DEBUG] ç‚¹å‡»ä»»åŠ¡:', taskId, taskData);

                    try {
                        // æ¸…ç©ºæ¶ˆæ¯åŒºåŸŸ
                        if (chatMessagesArea) {
                            chatMessagesArea.innerHTML = '';
                        }
                        
                        // é‡ç½®è¡¨å•
                        const form = document.getElementById('phishingConfigForm');
                        if (form) {
                            form.reset();
                        }

                        // å¯ä»¥åœ¨è¿™é‡ŒåŠ è½½ä»»åŠ¡ç›¸å…³çš„é…ç½®æ•°æ®
                        // ä¾‹å¦‚ï¼šæ ¹æ®taskDataå¡«å……è¡¨å•å­—æ®µ
                    } catch (error) {
                        console.error('[DEBUG] é”™è¯¯:', error);
                    }
                },
                onViewAll: function() {
                    console.log('æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡');
                    showAllTasks();
                }
            });

            // åˆå§‹åŒ–èŠå¤©è¾“å…¥æ¡†ç»„ä»¶
            initChatInput({
                onSend: function(message) {
                    console.log('å‘é€æ¶ˆæ¯:', message);
                    // æ¨¡æ‹Ÿå‘é€ï¼Œå®é™…åº”è¯¥è°ƒç”¨API
                }
            });
        });

        // æ˜¾ç¤ºå…¨éƒ¨ä»»åŠ¡åˆ—è¡¨
        function showAllTasks() {
            var chatArea = document.querySelector('.phishing-chat-panel');
            if (!chatArea) return;

            // ç”Ÿæˆä»»åŠ¡åˆ—è¡¨HTML
            var tasksHtml = '';
            for (var i = 0; i < mockTasks.length; i++) {
                var task = mockTasks[i];
                var statusIcon = task.status === 'running' ? 'â³' :
                                task.status === 'completed' ? 'âœ…' : 'âŒ';
                var statusClass = task.status;

                tasksHtml += '<div class="task-record-card" data-task-id="' + task.id + '">' +
                    '<div class="task-record-left">' +
                        '<div class="task-record-header">' +
                            '<div class="task-record-status">' +
                                '<span class="task-status-badge ' + statusClass + '">' + statusIcon + '</span>' +
                            '</div>' +
                            '<div class="task-record-name">' + task.name + '</div>' +
                        '</div>' +
                        '<div class="task-record-statistics">' +
                            '<span class="statistics-label">æ¶ˆæ¯æ•°</span>' +
                            '<span class="statistics-value">' + (4 + Math.floor(Math.random() * 6)) + ' æ¡</span>' +
                        '</div>' +
                    '</div>' +
                    '<div class="task-record-right">' +
                        '<div class="task-record-time">2025-12-19 14:30</div>' +
                        '<div class="task-record-actions">' +
                            '<button class="task-action-btn">æŸ¥çœ‹</button>' +
                            '<button class="task-action-btn">åˆ é™¤</button>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }

            if (mockTasks.length === 0) {
                tasksHtml = '<div class="tasks-empty">æš‚æ— ä»»åŠ¡è®°å½•</div>';
            }

            // æ›¿æ¢å†…å®¹
            chatArea.innerHTML = '<div class="tasks-list-container">' +
                '<div class="tasks-list-header">' +
                    '<h2 class="tasks-list-title">å…¨éƒ¨ä»»åŠ¡è®°å½•</h2>' +
                '</div>' +
                '<div class="tasks-list-content">' +
                    tasksHtml +
                '</div>' +
            '</div>';

            // ç»‘å®šä»»åŠ¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
            var taskCards = chatArea.querySelectorAll('.task-record-card');
            for (var i = 0; i < taskCards.length; i++) {
                taskCards[i].addEventListener('click', function(e) {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘å¡ç‰‡ç‚¹å‡»
                    if (e.target.classList.contains('task-action-btn')) {
                        e.stopPropagation();
                        var btnText = e.target.textContent;
                        var taskId = this.getAttribute('data-task-id');

                        if (btnText === 'æŸ¥çœ‹') {
                            // æŸ¥æ‰¾å¯¹åº”çš„ä»»åŠ¡å¹¶æ˜¾ç¤ºè¯¦æƒ…
                            var selectedTask = null;
                            for (var j = 0; j < mockTasks.length; j++) {
                                if (mockTasks[j].id === taskId) {
                                    selectedTask = mockTasks[j];
                                    break;
                                }
                            }

                            if (selectedTask) {
                                // è°ƒç”¨ç°æœ‰çš„ä»»åŠ¡ç‚¹å‡»å›è°ƒ
                                var sidebarInstance = window.agentSidebarInstance;
                                if (sidebarInstance && sidebarInstance.setActiveTask) {
                                    sidebarInstance.setActiveTask(taskId);
                                }

                                // æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…ï¼ˆå¤ç”¨ä¹‹å‰çš„ä»£ç ï¼‰
                                showTaskDetailById(taskId, selectedTask);
                            }
                        } else if (btnText === 'åˆ é™¤') {
                            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å—ï¼Ÿ')) {
                                console.log('åˆ é™¤ä»»åŠ¡:', taskId);
                            }
                        }
                        return;
                    }

                    // ç‚¹å‡»å¡ç‰‡å…¶ä»–åŒºåŸŸï¼Œæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
                    var taskId = this.getAttribute('data-task-id');
                    var selectedTask = null;
                    for (var j = 0; j < mockTasks.length; j++) {
                        if (mockTasks[j].id === taskId) {
                            selectedTask = mockTasks[j];
                            break;
                        }
                    }

                    if (selectedTask) {
                        showTaskDetailById(taskId, selectedTask);
                    }
                });
            }
        }

        // æ ¹æ®ä»»åŠ¡IDæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
        function showTaskDetailById(taskId, taskData) {
            // æ¸…ç©ºæ¶ˆæ¯åŒºåŸŸ
            if (chatMessagesArea) {
                chatMessagesArea.innerHTML = '';
            }
            
            // é‡ç½®è¡¨å•
            const form = document.getElementById('phishingConfigForm');
            if (form) {
                form.reset();
            }

            // å¯ä»¥åœ¨è¿™é‡ŒåŠ è½½ä»»åŠ¡ç›¸å…³çš„é…ç½®æ•°æ®
            // ä¾‹å¦‚ï¼šæ ¹æ®taskDataå¡«å……è¡¨å•å­—æ®µ
            console.log('åŠ è½½ä»»åŠ¡:', taskId, taskData);
        }

        // å¿«é€Ÿæç¤ºå¡«å……åŠŸèƒ½
        function fillPrompt(text) {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = text;
                input.focus();
            }
        }
    </script>
</body>
</html>

