<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="自规划任务执行助手 - 智能体模板">
    <title>自规划任务执行助手 | 云脑</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/dashboard.css">
    <link rel="stylesheet" href="../css/template-detail.css">
    <link rel="stylesheet" href="../css/template-planning.css">
</head>
<body class="agent-detail-page agent-planning-page">
    <!-- 左侧主导航栏（collapsed模式） -->
    <aside class="sidebar collapsed" id="sidebar">
        <!-- Logo 区 -->
        <div class="sidebar-logo">
            <a href="../../dashboard.html" class="logo-link">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="6" fill="#2563EB"/>
                        <path d="M16 8L20 14H12L16 8Z" fill="white"/>
                        <path d="M10 18L14 24H6L10 18Z" fill="white" opacity="0.8"/>
                        <path d="M22 18L26 24H18L22 18Z" fill="white" opacity="0.8"/>
                    </svg>
                </div>
                <h1 class="logo-text">云脑</h1>
            </a>
        </div>

        <!-- 主导航菜单 -->
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <!-- 首页 - 带收藏快捷入口 -->
                <div class="nav-item-home-wrapper">
                    <a href="../../dashboard.html" class="nav-item nav-item-home" title="首页">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-text">首页</span>
                    </a>
                    <div class="home-menu" id="homeMenu">
                        <a href="../../dashboard.html" class="home-menu-item">
                            <span class="nav-icon">🏠</span>
                            <span class="nav-text">首页</span>
                        </a>
                        <div class="home-menu-favorites" id="homeMenuFavorites">
                            <div class="home-menu-favorites-empty" id="homeMenuFavoritesEmpty" style="display: none;">
                                <p class="home-menu-empty-text">暂无收藏</p>
                            </div>
                            <div class="home-menu-favorites-list" id="homeMenuFavoritesList"></div>
                        </div>
                    </div>
                </div>

                <!-- 我的收藏 -->
                <div class="nav-item favorites-nav" title="我的收藏">
                    <div class="nav-item-header favorites-header">
                        <span class="nav-text">我的收藏</span>
                    </div>
                    <div class="favorites-list" id="favoritesList">
                        <div class="favorites-empty" id="favoritesEmpty">
                            <p>暂无收藏的智能体</p>
                            <p class="favorites-hint">在智能体卡片上点击星标即可收藏</p>
                        </div>
                        <div class="favorites-items" id="favoritesItems"></div>
                    </div>
                </div>
            </nav>

            <!-- 底部导航 -->
            <nav class="sidebar-nav-bottom">
            <a href="../../templates.html" class="nav-item" title="UI模板">
                <span class="nav-icon">📐</span>
                <span class="nav-text">UI模板</span>
            </a>
            <a href="#" class="nav-item" title="帮助中心">
                <span class="nav-icon">❓</span>
                <span class="nav-text">帮助中心</span>
            </a>
            <a href="#" class="nav-item" title="用户反馈">
                <span class="nav-icon">💬</span>
                <span class="nav-text">用户反馈</span>
            </a>
            <div class="nav-item-user-wrapper">
                <a href="#" class="nav-item nav-item-user" id="userNavItem" title="个人中心">
                    <div class="user-avatar" id="userAvatar">T</div>
                    <span class="user-name" id="userName">测试用户</span>
                </a>
                <div class="user-menu" id="userMenu">
                    <a href="#" class="user-menu-item">
                        <span class="nav-icon">👤</span>
                        <span class="nav-text">个人中心</span>
                    </a>
                    <button class="user-menu-item nav-item-logout" id="logoutBtn">
                        <span class="nav-icon">🚪</span>
                        <span class="nav-text">退出登录</span>
                    </button>
                </div>
            </div>
        </nav>
        </div>
    </aside>

    <!-- 主内容区 -->
    <main class="main-content-area">
        <!-- 智能体头部 -->
        <div class="agent-header">
            <div class="agent-header-main">
                <div class="agent-icon">🎯</div>
                <div class="agent-info">
                    <div class="agent-title-wrapper">
                        <h2 class="agent-title">自规划任务执行助手</h2>
                        <span class="agent-type">进阶类</span>
                        <span class="agent-version">v1.0.0</span>
                    </div>
                    <p class="agent-description">智能分解复杂任务，自主规划执行步骤，实时跟踪进度</p>
                </div>
            </div>
            <!-- 管理功能按钮组 -->
            <div class="agent-header-actions">
                <button class="btn-agent-action" title="知识库">
                    <span class="action-icon">📚</span>
                    <span class="action-text">知识库</span>
                    <span class="action-count">(0)</span>
                </button>
                <button class="btn-agent-action" title="工具插件">
                    <span class="action-icon">🔧</span>
                    <span class="action-text">工具插件</span>
                    <span class="action-count">(3)</span>
                </button>
                <button class="btn-agent-action" title="智能体设置">
                    <span class="action-icon">⚙️</span>
                    <span class="action-text">设置</span>
                </button>
                <button class="btn btn-primary btn-sm">
                    <span>🔗</span>
                    <span>分享</span>
                </button>
            </div>
        </div>

        <!-- 主内容区 - 三栏布局 -->
        <div class="content-container">
            <!-- 左栏：智能体侧导航 (220px) -->
            <aside class="agent-sidebar">
                <nav class="agent-nav">
                    <!-- 新任务按钮 -->
                    <button class="btn-new-chat" id="btnNewTask">
                        <span class="btn-icon">✨</span>
                        <span class="btn-text">新任务</span>
                    </button>

                    <!-- 近期任务 -->
                    <div class="nav-group">
                        <div class="nav-group-title">近期任务</div>

                        <!-- 近期任务列表 -->
                        <div class="recent-tasks-list">
                            <a href="#" class="recent-task-item active">
                                <span class="task-status-icon running">⏳</span>
                                <div class="task-name">开发用户认证系统</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon completed">✅</span>
                                <div class="task-name">数据库优化方案</div>
                            </a>
                            <a href="#" class="recent-task-item">
                                <span class="task-status-icon failed">❌</span>
                                <div class="task-name">API接口文档生成</div>
                            </a>
                        </div>
                    </div>

                    <!-- 查看全部 -->
                    <a href="#" class="view-all-tasks" id="viewAllTasks">
                        查看全部任务记录 →
                    </a>
                </nav>
            </aside>

            <!-- 中栏：对话区 (flex: 1) -->
            <div class="chat-area">
                <div class="chat-header">
                    <span class="chat-title">代码安全漏洞挖掘任务</span>
                    <span class="chat-time">2024-12-11 14:30</span>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- 系统消息 -->
                    <div class="message message-system">
                        <div class="message-avatar">🎯</div>
                        <div class="message-content">
                            <div class="message-time">14:30</div>
                            <div class="message-text">任务已创建：对项目进行安全代码审计，识别潜在漏洞</div>
                        </div>
                    </div>

                    <!-- 任务意图识别 -->
                    <div class="message message-ai">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="message-time">14:30</div>
                            <div class="intent-card">
                                <div class="intent-header">
                                    <span class="intent-icon">🎯</span>
                                    <span class="intent-title">任务意图识别</span>
                                </div>
                                <div class="intent-content">
                                    <p><strong>任务类型：</strong>代码安全漏洞挖掘</p>
                                    <p><strong>分析对象：</strong>Web应用项目（Java Spring Boot）</p>
                                    <p><strong>预期目标：</strong>识别安全漏洞、生成漏洞报告、提供修复建议</p>
                                </div>
                            </div>

                            <!-- 任务规划 -->
                            <div class="planning-card">
                                <div class="planning-header">
                                    <span class="planning-icon">📋</span>
                                    <span class="planning-title">任务执行规划</span>
                                </div>
                                <div class="planning-stages">
                                    <div class="stage-item">
                                        <span class="stage-number">1</span>
                                        <span class="stage-name">工程功能模块分析</span>
                                    </div>
                                    <div class="stage-item">
                                        <span class="stage-number">2</span>
                                        <span class="stage-name">威胁建模与漏洞分析</span>
                                    </div>
                                    <div class="stage-item">
                                        <span class="stage-number">3</span>
                                        <span class="stage-name">分析总结报告生成</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 阶段1：工程功能模块分析 -->
                    <div class="message message-ai">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="message-time">14:31</div>
                            <div class="phase-card">
                                <div class="phase-header">
                                    <span class="phase-badge">阶段 1</span>
                                    <span class="phase-title">工程功能模块分析</span>
                                    <span class="phase-status completed">✓ 已完成</span>
                                </div>
                                <div class="phase-content">
                                    <!-- 思考 -->
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">分析项目结构，识别核心功能模块和关键代码路径...</div>
                                    </div>

                                    <!-- 工具调用 -->
                                    <div class="event-item event-tool" data-tool-id="tool-1">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取项目目录结构</div>
                                            <div class="event-meta">list_directory • src/</div>
                                        </div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-2">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取配置文件</div>
                                            <div class="event-meta">read_file • application.yml</div>
                                        </div>
                                    </div>

                                    <!-- 思考 -->
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">识别到用户认证、权限管理、数据访问三个核心模块，需要重点关注输入验证和访问控制...</div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-3">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取认证控制器代码</div>
                                            <div class="event-meta">read_file • AuthController.java</div>
                                        </div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-4">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取数据访问层代码</div>
                                            <div class="event-meta">read_file • UserRepository.java</div>
                                        </div>
                                    </div>

                                    <!-- 文档输出 -->
                                    <div class="event-item event-document" data-doc-id="doc-1">
                                        <span class="event-icon">📄</span>
                                        <div class="event-content">
                                            <div class="event-text">工程功能模块分析总结</div>
                                            <div class="event-meta">生成文档 • 模块分析总结.md</div>
                                        </div>
                                    </div>

                                    <div class="event-item event-document" data-doc-id="doc-2">
                                        <span class="event-icon">📄</span>
                                        <div class="event-content">
                                            <div class="event-text">工程功能记忆文件</div>
                                            <div class="event-meta">生成文档 • 工程记忆.md</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 阶段2：威胁建模与漏洞分析 -->
                    <div class="message message-ai">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="message-time">14:35</div>
                            <div class="phase-card">
                                <div class="phase-header">
                                    <span class="phase-badge">阶段 2</span>
                                    <span class="phase-title">威胁建模与漏洞分析</span>
                                    <span class="phase-status completed">✓ 已完成</span>
                                </div>
                                <div class="phase-content">
                                    <!-- 思考 -->
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">基于功能模块分析，构建威胁模型，识别潜在攻击面...</div>
                                    </div>

                                    <!-- 并行分析任务队列 -->
                                    <div class="parallel-tasks">
                                        <div class="parallel-header">
                                            <span class="parallel-icon">⚡</span>
                                            <span class="parallel-title">并行漏洞分析任务</span>
                                            <span class="parallel-count">6个任务</span>
                                        </div>
                                        <div class="task-queue">
                                            <div class="queue-item completed">
                                                <span class="queue-status">✓</span>
                                                <span class="queue-name">SQL注入漏洞检测</span>
                                            </div>
                                            <div class="queue-item completed">
                                                <span class="queue-status">✓</span>
                                                <span class="queue-name">XSS跨站脚本检测</span>
                                            </div>
                                            <div class="queue-item completed">
                                                <span class="queue-status">✓</span>
                                                <span class="queue-name">CSRF漏洞检测</span>
                                            </div>
                                            <div class="queue-item completed">
                                                <span class="queue-status">✓</span>
                                                <span class="queue-name">认证授权缺陷检测</span>
                                            </div>
                                            <div class="queue-item completed">
                                                <span class="queue-status">✓</span>
                                                <span class="queue-name">敏感数据暴露检测</span>
                                            </div>
                                            <div class="queue-item completed">
                                                <span class="queue-status">✓</span>
                                                <span class="queue-name">不安全的反序列化检测</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SQL注入分析 -->
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">检查SQL注入风险：UserRepository中存在字符串拼接构建SQL的情况...</div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-5">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">查看工程记忆文件</div>
                                            <div class="event-meta">read_file • 工程记忆.md</div>
                                        </div>
                                    </div>

                                    <div class="event-item event-tool active" data-tool-id="tool-6">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">深入分析数据库查询代码</div>
                                            <div class="event-meta">read_file • UserRepository.java:45-78</div>
                                        </div>
                                    </div>

                                    <!-- 漏洞产物 -->
                                    <div class="vulnerability-finding">
                                        <div class="vuln-header">
                                            <span class="vuln-severity high">高危</span>
                                            <span class="vuln-title">SQL注入漏洞</span>
                                        </div>
                                        <div class="vuln-location">UserRepository.java:67</div>
                                        <div class="vuln-description">用户输入未经过滤直接拼接到SQL语句中，可导致SQL注入攻击</div>
                                    </div>

                                    <!-- XSS分析 -->
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">检查XSS风险：前端模板未对用户输入进行HTML转义...</div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-7">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取前端模板文件</div>
                                            <div class="event-meta">read_file • user-profile.html</div>
                                        </div>
                                    </div>

                                    <div class="vulnerability-finding">
                                        <div class="vuln-header">
                                            <span class="vuln-severity medium">中危</span>
                                            <span class="vuln-title">存储型XSS漏洞</span>
                                        </div>
                                        <div class="vuln-location">user-profile.html:23</div>
                                        <div class="vuln-description">用户昵称未进行HTML转义直接渲染，可导致XSS攻击</div>
                                    </div>

                                    <!-- 认证授权分析 -->
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">检查认证授权机制：发现权限校验存在绕过风险...</div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-8">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">分析权限校验逻辑</div>
                                            <div class="event-meta">read_file • SecurityConfig.java</div>
                                        </div>
                                    </div>

                                    <div class="vulnerability-finding">
                                        <div class="vuln-header">
                                            <span class="vuln-severity high">高危</span>
                                            <span class="vuln-title">越权访问漏洞</span>
                                        </div>
                                        <div class="vuln-location">SecurityConfig.java:34</div>
                                        <div class="vuln-description">部分管理接口未配置权限校验，普通用户可越权访问</div>
                                    </div>

                                    <!-- 任务进度 -->
                                    <div class="task-progress">
                                        <div class="progress-header">
                                            <span class="progress-text">漏洞分析进度</span>
                                            <span class="progress-percent">100%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 100%"></div>
                                        </div>
                                        <div class="progress-stats">
                                            <span>已分析 18 个文件</span>
                                            <span>发现 8 个漏洞</span>
                                        </div>
                                    </div>

                                    <!-- 更新记忆文件 -->
                                    <div class="event-item event-tool" data-tool-id="tool-9">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">更新工程记忆文件</div>
                                            <div class="event-meta">edit_file • 工程记忆.md</div>
                                        </div>
                                    </div>

                                    <!-- 生成漏洞报告 -->
                                    <div class="event-item event-document" data-doc-id="doc-3">
                                        <span class="event-icon">📄</span>
                                        <div class="event-content">
                                            <div class="event-text">漏洞详细报告</div>
                                            <div class="event-meta">生成文档 • 漏洞报告.md</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 阶段3：分析总结报告生成 -->
                    <div class="message message-ai">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="message-time">14:42</div>
                            <div class="phase-card">
                                <div class="phase-header">
                                    <span class="phase-badge">阶段 3</span>
                                    <span class="phase-title">分析总结报告生成</span>
                                    <span class="phase-status completed">✓ 已完成</span>
                                </div>
                                <div class="phase-content">
                                    <div class="event-item event-thinking">
                                        <span class="event-icon">💭</span>
                                        <div class="event-text">整合分析结果，生成综合性安全评估报告...</div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-10">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取工程记忆文件</div>
                                            <div class="event-meta">read_file • 工程记忆.md</div>
                                        </div>
                                    </div>

                                    <div class="event-item event-tool" data-tool-id="tool-11">
                                        <span class="event-icon">🔧</span>
                                        <div class="event-content">
                                            <div class="event-text">读取漏洞报告</div>
                                            <div class="event-meta">read_file • 漏洞报告.md</div>
                                        </div>
                                    </div>

                                    <div class="event-item event-document" data-doc-id="doc-4">
                                        <span class="event-icon">📄</span>
                                        <div class="event-content">
                                            <div class="event-text">工程安全评估总结报告</div>
                                            <div class="event-meta">生成文档 • 安全评估报告.md</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 最终回复 -->
                    <div class="message message-ai">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="message-time">14:45</div>
                            <div class="final-response">
                                <div class="response-header">
                                    <h3>分析概览与核心发现</h3>
                                </div>

                                <!-- 总结文案 -->
                                <div class="response-summary">
                                    <p>已完成对该项目的全面安全代码审计。通过工程功能模块分析、威胁建模与漏洞深度挖掘，共发现 <strong>8个安全漏洞</strong>，其中高危漏洞3个、中危漏洞4个、低危漏洞1个。主要风险集中在SQL注入、越权访问和XSS攻击方面。</p>
                                </div>

                                <!-- 可视化表格 -->
                                <div class="vulnerability-table">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>漏洞类型</th>
                                                <th>危险等级</th>
                                                <th>位置</th>
                                                <th>状态</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>SQL注入</td>
                                                <td><span class="severity-badge high">高危</span></td>
                                                <td>UserRepository.java:67</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>越权访问</td>
                                                <td><span class="severity-badge high">高危</span></td>
                                                <td>SecurityConfig.java:34</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>硬编码密钥</td>
                                                <td><span class="severity-badge high">高危</span></td>
                                                <td>JwtUtil.java:12</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>存储型XSS</td>
                                                <td><span class="severity-badge medium">中危</span></td>
                                                <td>user-profile.html:23</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>CSRF防护缺失</td>
                                                <td><span class="severity-badge medium">中危</span></td>
                                                <td>SecurityConfig.java:45</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>敏感信息泄露</td>
                                                <td><span class="severity-badge medium">中危</span></td>
                                                <td>ErrorHandler.java:28</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>不安全的随机数</td>
                                                <td><span class="severity-badge medium">中危</span></td>
                                                <td>TokenGenerator.java:15</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                            <tr>
                                                <td>弱密码策略</td>
                                                <td><span class="severity-badge low">低危</span></td>
                                                <td>PasswordValidator.java:8</td>
                                                <td><span class="status-badge">待修复</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- 关键文档卡片 -->
                                <div class="key-documents">
                                    <h4>关键文档</h4>
                                    <div class="doc-cards">
                                        <div class="doc-card" data-doc-id="doc-3">
                                            <div class="doc-card-icon">📋</div>
                                            <div class="doc-card-content">
                                                <div class="doc-card-title">漏洞详细报告</div>
                                                <div class="doc-card-meta">8个漏洞 • 12 KB</div>
                                            </div>
                                            <button class="doc-card-action">查看</button>
                                        </div>
                                        <div class="doc-card" data-doc-id="doc-4">
                                            <div class="doc-card-icon">📊</div>
                                            <div class="doc-card-content">
                                                <div class="doc-card-title">安全评估报告</div>
                                                <div class="doc-card-meta">综合分析 • 18 KB</div>
                                            </div>
                                            <button class="doc-card-action">查看</button>
                                        </div>
                                        <div class="doc-card" data-doc-id="doc-2">
                                            <div class="doc-card-icon">🧠</div>
                                            <div class="doc-card-content">
                                                <div class="doc-card-title">工程记忆文件</div>
                                                <div class="doc-card-meta">项目分析 • 9 KB</div>
                                            </div>
                                            <button class="doc-card-action">查看</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 输入框（固定在对话区底部） -->
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea
                            class="chat-input"
                            placeholder="您可以随时干预，提出建议或调整方向..."
                            rows="3"
                        ></textarea>
                        <div class="chat-input-toolbar">
                            <div class="chat-input-actions">
                                <button class="btn-icon" title="上传文件">📎</button>
                                <button class="btn-icon" title="插入图片">🖼️</button>
                            </div>
                            <button class="btn btn-primary">
                                <span>发送</span>
                                <span class="shortcut">⇧↵</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右栏：工具面板 (320px) -->
            <aside class="tools-panel">
                <div class="tools-tabs">
                    <button class="tools-tab active" data-tab="logs">
                        <span>📋</span>
                        <span>日志</span>
                    </button>
                    <button class="tools-tab" data-tab="files">
                        <span>📁</span>
                        <span>文件</span>
                        <span class="badge">4</span>
                    </button>
                </div>

                <div class="tools-content">
                    <!-- 日志Tab -->
                    <div class="tools-tab-content active" id="tabLogs">
                        <div class="log-content-wrapper">
                            <div class="log-placeholder" id="logPlaceholder" style="display: none;">
                                <div class="empty-icon">📋</div>
                                <div class="empty-text">点击对话中的工具调用或文档查看详细信息</div>
                            </div>
                            <div class="log-detail" id="logDetail">
                                <!-- 默认显示一条示例日志 -->
                                <div class="log-detail-content">
                                    <div class="log-description">
                                        <div class="log-desc-content">
                                            <div class="log-desc-tool">使用 <code>read_file</code> 工具</div>
                                            <div class="log-desc-purpose">读取 <code>UserRepository.java</code> 的第 <code>45-78</code> 行</div>
                                        </div>
                                    </div>
                                    <div class="log-output">
                                        <div class="log-content-title">UserRepository.java</div>
                                        <div class="log-code">45: public User findByUsername(String username) {
46:     String sql = "SELECT * FROM users WHERE username = '" + username + "'";
47:     // 直接字符串拼接，存在SQL注入风险！
48:     return jdbcTemplate.queryForObject(sql, new UserRowMapper());
49: }</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 阶段进度看板 -->
                        <div class="phase-progress-panel">
                            <div class="phase-progress-header">
                                <span class="phase-progress-icon">📊</span>
                                <span class="phase-progress-title">阶段进度</span>
                            </div>
                            <div class="phase-progress-timeline">
                                <div class="phase-progress-item completed" data-phase="1">
                                    <div class="phase-progress-marker">
                                        <span class="phase-progress-status">✓</span>
                                    </div>
                                    <div class="phase-progress-content">
                                        <div class="phase-progress-name">工程功能模块分析</div>
                                    </div>
                                </div>
                                <div class="phase-progress-item completed" data-phase="2">
                                    <div class="phase-progress-marker">
                                        <span class="phase-progress-status">✓</span>
                                    </div>
                                    <div class="phase-progress-content">
                                        <div class="phase-progress-name">威胁建模与漏洞分析</div>
                                    </div>
                                </div>
                                <div class="phase-progress-item completed current" data-phase="3">
                                    <div class="phase-progress-marker">
                                        <span class="phase-progress-status">✓</span>
                                    </div>
                                    <div class="phase-progress-content">
                                        <div class="phase-progress-name">分析总结报告生成</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 文件Tab -->
                    <div class="tools-tab-content" id="tabFiles">
                        <!-- 文件目录树 -->
                        <div class="file-tree">
                            <!-- vulnex 目录 -->
                            <div class="file-tree-item file-tree-folder expanded">
                                <div class="file-tree-header" data-folder="vulnex">
                                    <span class="file-tree-icon">📁</span>
                                    <span class="file-tree-name">vulnex</span>
                                </div>
                                <div class="file-tree-children">
                                    <!-- 项目记忆目录 -->
                                    <div class="file-tree-item file-tree-folder expanded">
                                        <div class="file-tree-header" data-folder="memory">
                                            <span class="file-tree-icon">📁</span>
                                            <span class="file-tree-name">项目记忆</span>
                                        </div>
                                        <div class="file-tree-children">
                                            <div class="file-tree-item file-tree-file">
                                                <span class="file-tree-name">工程功能记忆文件.md</span>
                                                <span class="file-tree-meta">3.1 KB</span>
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                            </div>
                                            <div class="file-tree-item file-tree-file">
                                                <span class="file-tree-name">工程记忆文件.md</span>
                                                <span class="file-tree-meta">4.5 KB</span>
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 漏洞报告目录 -->
                                    <div class="file-tree-item file-tree-folder expanded">
                                        <div class="file-tree-header" data-folder="vulnerabilities">
                                            <span class="file-tree-icon">📁</span>
                                            <span class="file-tree-name">漏洞报告</span>
                                        </div>
                                        <div class="file-tree-children">
                                            <div class="file-tree-item file-tree-file">
                                                <span class="file-tree-name">漏洞报告-001.md</span>
                                                <span class="file-tree-meta">1.2 KB</span>
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                            </div>
                                            <div class="file-tree-item file-tree-file">
                                                <span class="file-tree-name">漏洞报告-002.md</span>
                                                <span class="file-tree-meta">0.8 KB</span>
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 总结报告目录 -->
                                    <div class="file-tree-item file-tree-folder expanded">
                                        <div class="file-tree-header" data-folder="summary">
                                            <span class="file-tree-icon">📁</span>
                                            <span class="file-tree-name">总结报告</span>
                                        </div>
                                        <div class="file-tree-children">
                                            <div class="file-tree-item file-tree-file">
                                                <span class="file-tree-name">工程总结报告.md</span>
                                                <span class="file-tree-meta">5.2 KB</span>
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- user 目录 -->
                            <div class="file-tree-item file-tree-folder expanded">
                                <div class="file-tree-header" data-folder="user">
                                    <span class="file-tree-icon">📁</span>
                                    <span class="file-tree-name">user</span>
                                </div>
                                <div class="file-tree-children">
                                    <div class="file-tree-item file-tree-file">
                                        <span class="file-tree-name">project.zip</span>
                                        <span class="file-tree-meta">2.5 MB</span>
                                        <button class="btn-file-action" title="下载">⬇️</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 上传文件区域 -->
                        <div class="sidebar-section" style="margin-top: 16px;">
                            <div class="sidebar-section-title">
                                <span>上传文件</span>
                            </div>
                            <div class="upload-area">
                                <input type="file" id="fileInput" multiple style="display: none;">
                                <button class="btn-upload" id="btnUpload">
                                    <span class="upload-icon">📤</span>
                                    <span class="upload-text">点击上传</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <script src="../../js/dashboard.js"></script>
    <script src="../js/template-planning.js"></script>
</body>
</html>
