<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="自规划任务执行助手 - 智能体模板">
    <title>自规划任务执行助手 | 云脑</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/dashboard.css">
    <link rel="stylesheet" href="../css/template-detail.css">
    <link rel="stylesheet" href="../css/template-planning.css">
    <link rel="stylesheet" href="../../components/agent-sidebar.css">
    <link rel="stylesheet" href="../../components/chat-input.css">
</head>
<body class="agent-detail-page agent-planning-page">
    <!-- 左侧主导航栏（collapsed模式） -->
    <aside class="sidebar collapsed" id="sidebar">
        <!-- Logo 区 -->
        <div class="sidebar-logo">
            <a href="../../dashboard.html" class="logo-link">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="6" fill="#2563EB"/>
                        <path d="M16 8L20 14H12L16 8Z" fill="white"/>
                        <path d="M10 18L14 24H6L10 18Z" fill="white" opacity="0.8"/>
                        <path d="M22 18L26 24H18L22 18Z" fill="white" opacity="0.8"/>
                    </svg>
                </div>
                <h1 class="logo-text">云脑</h1>
            </a>
        </div>

        <!-- 主导航菜单 -->
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <!-- 首页 - 带收藏快捷入口 -->
                <div class="nav-item-home-wrapper">
                    <a href="../../dashboard.html" class="nav-item nav-item-home" title="首页">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-text">首页</span>
                    </a>
                    <div class="home-menu" id="homeMenu">
                        <a href="../../dashboard.html" class="home-menu-item">
                            <span class="nav-icon">🏠</span>
                            <span class="nav-text">首页</span>
                        </a>
                        <div class="home-menu-favorites" id="homeMenuFavorites">
                            <div class="home-menu-favorites-empty" id="homeMenuFavoritesEmpty" style="display: none;">
                                <p class="home-menu-empty-text">暂无收藏</p>
                            </div>
                            <div class="home-menu-favorites-list" id="homeMenuFavoritesList"></div>
                        </div>
                    </div>
                </div>

                <!-- 我的收藏 -->
                <div class="nav-item favorites-nav" title="我的收藏">
                    <div class="nav-item-header favorites-header">
                        <span class="nav-text">我的收藏</span>
                    </div>
                    <div class="favorites-list" id="favoritesList">
                        <div class="favorites-empty" id="favoritesEmpty">
                            <p>暂无收藏的智能体</p>
                            <p class="favorites-hint">在智能体卡片上点击星标即可收藏</p>
                        </div>
                        <div class="favorites-items" id="favoritesItems"></div>
                    </div>
                </div>
            </nav>

            <!-- 底部导航 -->
            <nav class="sidebar-nav-bottom">
            <a href="../../templates.html" class="nav-item" title="UI模板">
                <span class="nav-icon">📐</span>
                <span class="nav-text">UI模板</span>
            </a>
            <a href="#" class="nav-item" title="帮助中心">
                <span class="nav-icon">❓</span>
                <span class="nav-text">帮助中心</span>
            </a>
            <a href="#" class="nav-item" title="用户反馈">
                <span class="nav-icon">💬</span>
                <span class="nav-text">用户反馈</span>
            </a>
            <div class="nav-item-user-wrapper">
                <a href="#" class="nav-item nav-item-user" id="userNavItem" title="个人中心">
                    <div class="user-avatar" id="userAvatar">T</div>
                    <span class="user-name" id="userName">测试用户</span>
                </a>
                <div class="user-menu" id="userMenu">
                    <a href="../../pages/user-management.html" class="user-menu-item">
                        <span class="nav-icon">👤</span>
                        <span class="nav-text">个人中心</span>
                    </a>
                    <button class="user-menu-item nav-item-logout" id="logoutBtn">
                        <span class="nav-icon">🚪</span>
                        <span class="nav-text">退出登录</span>
                    </button>
                </div>
            </div>
        </nav>
        </div>
    </aside>

    <!-- 主内容区 -->
    <main class="main-content-area">
        <!-- 智能体头部 -->
        <div class="agent-header">
            <div class="agent-header-main">
                <div class="agent-icon">🎯</div>
                <div class="agent-info">
                    <div class="agent-title-wrapper">
                        <h2 class="agent-title">自规划任务执行助手</h2>
                        <span class="agent-type">进阶类</span>
                        <span class="agent-version">v1.0.0</span>
                    </div>
                    <p class="agent-description">智能分解复杂任务，自主规划执行步骤，实时跟踪进度</p>
                </div>
            </div>
            <!-- 管理功能按钮组 -->
            <div class="agent-header-actions">
                <button class="btn-agent-action" title="知识库">
                    <span class="action-icon">📚</span>
                    <span class="action-text">知识库</span>
                    <span class="action-count">(0)</span>
                </button>
                <button class="btn-agent-action" title="工具插件">
                    <span class="action-icon">🔧</span>
                    <span class="action-text">工具插件</span>
                    <span class="action-count">(3)</span>
                </button>
                <button class="btn-agent-action" title="智能体设置">
                    <span class="action-icon">⚙️</span>
                    <span class="action-text">设置</span>
                </button>
                <button class="btn btn-primary btn-sm">
                    <span>🔗</span>
                    <span>分享</span>
                </button>
            </div>
        </div>

        <!-- 主内容区 - 三栏布局 -->
        <div class="content-container">
            <!-- 左栏：智能体侧导航 (220px) -->
            <aside class="agent-sidebar">
                <nav class="agent-nav">
                    <!-- 新任务按钮 -->
                    <button class="btn-new-chat" id="btnNewTask">
                        <span class="btn-icon">✨</span>
                        <span class="btn-text">新任务</span>
                    </button>

                    <!-- 近期任务 -->
                    <div class="nav-group">
                        <div class="nav-group-title">近期任务</div>

                        <!-- 近期任务列表 -->
                        <div class="recent-tasks-list">
                            <a href="#" class="recent-task-item active" data-task-id="task-001">
                                <span class="task-status-icon completed">✅</span>
                                <div class="task-name">代码安全漏洞挖掘任务</div>
                            </a>
                            <a href="#" class="recent-task-item" data-task-id="task-002">
                                <span class="task-status-icon running">⏳</span>
                                <div class="task-name">开发用户认证系统</div>
                            </a>
                            <a href="#" class="recent-task-item" data-task-id="task-003">
                                <span class="task-status-icon completed">✅</span>
                                <div class="task-name">数据库优化方案</div>
                            </a>
                            <a href="#" class="recent-task-item" data-task-id="task-004">
                                <span class="task-status-icon failed">❌</span>
                                <div class="task-name">API接口文档生成</div>
                            </a>
                        </div>
                    </div>

                    <!-- 查看全部 -->
                    <a href="#" class="view-all-tasks" id="viewAllTasks">
                        查看全部任务记录 →
                    </a>
                </nav>
            </aside>

            <!-- 中栏：对话区 (flex: 1) -->
            <div class="chat-area">
                <div class="empty-state-container">
                    <!-- 智能体名称 -->
                    <div class="empty-agent-name">
                        <span class="agent-name-text">自规划任务执行助手</span>
                    </div>
                    
                    <!-- 引导文案 -->
                    <div class="empty-state-guide">
                        <p class="empty-state-guide-text">开始给智能体分配任务</p>
                    </div>
                    
                    <!-- 输入区域 -->
                    <div class="chat-input-container" data-container-mode="empty">
                        <div class="chat-input-wrapper">
                            <textarea
                                class="chat-input"
                                id="chatInput"
                                placeholder="输入您的问题或粘贴代码..."
                                rows="3"
                            ></textarea>
                            <div class="chat-input-toolbar">
                                <div class="chat-input-actions">
                                    <button class="btn-icon" title="上传文件" data-action="upload">📎</button>
                                    <button class="btn-icon" title="插入图片" data-action="image">🖼️</button>
                                    <button class="btn-icon" title="插入代码" data-action="code">💻</button>
                                    <button class="btn-icon" title="插入表格" data-action="table">📊</button>
                                </div>
                                <button class="btn btn-primary chat-send" id="chatSend">
                                    <span>发送</span>
                                    <span class="send-shortcut">Shift+Enter</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右栏：工具面板 (320px) -->
            <aside class="tools-panel" style="display: none;">
                <div class="tools-tabs">
                    <button class="tools-tab active" data-tab="logs">
                        <span>📋</span>
                        <span>日志</span>
                    </button>
                    <button class="tools-tab" data-tab="files">
                        <span>📁</span>
                        <span>文件</span>
                        <span class="badge">4</span>
                    </button>
                </div>

                <div class="tools-content">
                    <!-- 日志Tab -->
                    <div class="tools-tab-content active" id="tabLogs">
                        <div class="log-content-wrapper">
                            <div class="log-placeholder" id="logPlaceholder" style="display: none;">
                                <div class="empty-icon">📋</div>
                                <div class="empty-text">点击对话中的工具调用或文档查看详细信息</div>
                            </div>
                            <div class="log-detail" id="logDetail">
                                <!-- 默认显示任务清单 -->
                                <div class="log-detail-content">
                                    <div class="log-description">
                                        <div class="log-desc-content">
                                            <div class="log-desc-tool">任务清单</div>
                                            <div class="log-desc-purpose">全局任务执行情况</div>
                                        </div>
                                    </div>
                                    <div class="log-output">
                                        <div class="log-content-title">任务执行情况</div>
                                        <div class="task-list-container">
                                            <div class="task-list-item completed">
                                                <span class="task-status-indicator">✓</span>
                                                <span class="task-name">SQL注入漏洞检测</span>
                                            </div>
                                            <div class="task-list-item completed">
                                                <span class="task-status-indicator">✓</span>
                                                <span class="task-name">XSS跨站脚本检测</span>
                                            </div>
                                            <div class="task-list-item completed">
                                                <span class="task-status-indicator">✓</span>
                                                <span class="task-name">CSRF漏洞检测</span>
                                            </div>
                                            <div class="task-list-item completed">
                                                <span class="task-status-indicator">✓</span>
                                                <span class="task-name">认证授权缺陷检测</span>
                                            </div>
                                            <div class="task-list-item completed">
                                                <span class="task-status-indicator">✓</span>
                                                <span class="task-name">敏感数据暴露检测</span>
                                            </div>
                                            <div class="task-list-item completed">
                                                <span class="task-status-indicator">✓</span>
                                                <span class="task-name">不安全的反序列化检测</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 日志导航栏（移到下方） -->
                        <div class="log-navigation">
                            <button class="log-nav-btn" id="btnPrevLog" title="上一条">
                                <span>◀</span>
                            </button>
                            <button class="log-nav-btn" id="btnNextLog" title="下一条">
                                <span>▶</span>
                            </button>
                            <div class="log-progress-wrapper">
                                <div class="log-nav-info">
                                    <span class="log-nav-current" id="logNavCurrent">1</span>
                                    <span class="log-nav-separator">/</span>
                                    <span class="log-nav-total" id="logNavTotal">2</span>
                                </div>
                                <div class="log-progress-bar">
                                    <div class="log-progress-fill" id="logProgressFill"></div>
                                </div>
                            </div>
                            <button class="log-nav-realtime" id="btnRealtimeLog" title="实时追踪最新日志">
                                <span class="realtime-icon">📡</span>
                                <span class="realtime-text">实时</span>
                            </button>
                        </div>

                        <!-- 阶段进度看板 -->
                        <div class="phase-progress-panel">
                            <div class="phase-progress-header">
                                <span class="phase-progress-icon">📊</span>
                                <span class="phase-progress-title">阶段进度</span>
                            </div>
                            <div class="phase-progress-timeline">
                                <div class="phase-progress-item completed" data-phase="1">
                                    <div class="phase-progress-marker">
                                        <span class="phase-progress-status">✓</span>
                                    </div>
                                    <div class="phase-progress-content">
                                        <div class="phase-progress-name">工程功能模块分析</div>
                                    </div>
                                </div>
                                <div class="phase-progress-item completed" data-phase="2">
                                    <div class="phase-progress-marker">
                                        <span class="phase-progress-status">✓</span>
                                    </div>
                                    <div class="phase-progress-content">
                                        <div class="phase-progress-name">威胁建模与漏洞分析</div>
                                    </div>
                                </div>
                                <div class="phase-progress-item completed current" data-phase="3">
                                    <div class="phase-progress-marker">
                                        <span class="phase-progress-status">✓</span>
                                    </div>
                                    <div class="phase-progress-content">
                                        <div class="phase-progress-name">分析总结报告生成</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 文件Tab -->
                    <div class="tools-tab-content" id="tabFiles">
                        <!-- 文件目录树 -->
                        <div class="file-tree">
                            <!-- vulnex 目录 -->
                            <div class="file-tree-item file-tree-folder expanded">
                                <div class="file-tree-header" data-folder="vulnex">
                                    <span class="file-tree-icon">📁</span>
                                    <span class="file-tree-name">vulnex</span>
                                </div>
                                <div class="file-tree-children">
                                    <!-- 项目记忆目录 -->
                                    <div class="file-tree-item file-tree-folder expanded">
                                        <div class="file-tree-header" data-folder="memory">
                                            <span class="file-tree-icon">📁</span>
                                            <span class="file-tree-name">项目记忆</span>
                                        </div>
                                        <div class="file-tree-children">
                                            <div class="file-tree-item file-tree-file">
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                                <span class="file-tree-name">工程功能记忆文件.md</span>
                                                <span class="file-tree-meta">3.1 KB</span>
                                            </div>
                                            <div class="file-tree-item file-tree-file">
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                                <span class="file-tree-name">工程记忆文件.md</span>
                                                <span class="file-tree-meta">4.5 KB</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 漏洞报告目录 -->
                                    <div class="file-tree-item file-tree-folder expanded">
                                        <div class="file-tree-header" data-folder="vulnerabilities">
                                            <span class="file-tree-icon">📁</span>
                                            <span class="file-tree-name">漏洞报告</span>
                                        </div>
                                        <div class="file-tree-children">
                                            <div class="file-tree-item file-tree-file">
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                                <span class="file-tree-name">漏洞报告-001.md</span>
                                                <span class="file-tree-meta">1.2 KB</span>
                                            </div>
                                            <div class="file-tree-item file-tree-file">
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                                <span class="file-tree-name">漏洞报告-002.md</span>
                                                <span class="file-tree-meta">0.8 KB</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 总结报告目录 -->
                                    <div class="file-tree-item file-tree-folder expanded">
                                        <div class="file-tree-header" data-folder="summary">
                                            <span class="file-tree-icon">📁</span>
                                            <span class="file-tree-name">总结报告</span>
                                        </div>
                                        <div class="file-tree-children">
                                            <div class="file-tree-item file-tree-file">
                                                <button class="btn-file-action" title="下载">⬇️</button>
                                                <span class="file-tree-name">工程总结报告.md</span>
                                                <span class="file-tree-meta">5.2 KB</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- user 目录 -->
                            <div class="file-tree-item file-tree-folder expanded">
                                <div class="file-tree-header" data-folder="user">
                                    <span class="file-tree-icon">📁</span>
                                    <span class="file-tree-name">user</span>
                                </div>
                                <div class="file-tree-children">
                                    <div class="file-tree-item file-tree-file">
                                        <button class="btn-file-action" title="下载">⬇️</button>
                                        <span class="file-tree-name">project.zip</span>
                                        <span class="file-tree-meta">2.5 MB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <script src="../../js/dashboard.js"></script>
    <script src="../../components/agent-sidebar.js"></script>
    <script src="../../components/chat-input.js"></script>
    <script src="../js/template-planning.js"></script>
</body>
</html>
