# AI漏洞猎人自然语言对话功能需求设计

> **文档版本**: v2.0
> **创建日期**: 2025-12-17
> **最后更新**: 2025-12-17
> **实施策略**: 分层实施 - MVP (2周) → V2.0 (6周) → V3.0 (12周)
> **文档定位**: 功能需求与交互设计说明，技术实现方案由开发团队确定

---

## 🎯 核心目标

将AI漏洞猎人从"黑盒扫描器"升级为"可解释的安全助手"，通过自然语言对话：
- ✅ 解释漏洞原理和检测逻辑
- ✅ 提供修复建议和代码示例
- ✅ 回答用户安全问题
- ✅ 降低安全知识门槛

---

## 📊 总体策略

### 推荐方案：数据驱动的分层实施

```
┌─────────────────────────────────────────────────────────────┐
│ 需求一：智能问答助手 (MVP, 2周)                               │
│ ✅ 后置对话模式（默认模式，所有用户）                         │
│ ✅ 验证核心价值：对话能否解决可解释性问题                     │
│ ✅ 目标：对话使用率 > 60%                                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
                   收集数据 & 评估价值
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 需求二：流程控制对话 (V2.0, 6周) - 根据MVP反馈决定            │
│ ✅ 阶段确认模式（专业模式，可选）                            │
│ ✅ 在4个关键Phase提供确认和调整能力                          │
│ ✅ 触发条件：用户反馈"需要更多控制权"                         │
└─────────────────────────────────────────────────────────────┘
                            ↓
                   继续收集反馈
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 需求三：实时交互控制 (V3.0, 12周) - 谨慎考虑                 │
│ ⚠️  中断式对话模式（专家模式，可选）                         │
│ ⚠️  触发条件：专家用户愿意付费 + 技术团队评估通过            │
│ ⚠️  建议：优先投资其他高ROI功能                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚀 需求一：智能问答助手（MVP，2周）

### 需求概述

**需求名称**：智能问答助手
**需求类型**：新增功能
**实施周期**：2周
**核心价值**：通过自然语言对话，让用户快速理解漏洞原理、风险等级和修复方案，降低安全知识门槛

### 交互模式设计

**核心模式：混合交互模式（全局对话框 + @ 引用机制 + 快捷入口）**

```
┌─────────────────────────────────────────────────────────────┐
│ 漏洞报告页面                                                  │
│                                                              │
│ ┌────────────────────┐  ┌────────────────────┐              │
│ │ 漏洞1: SQL注入      │  │ 漏洞2: XSS         │              │
│ │ 严重程度: High     │  │ 严重程度: Medium   │              │
│ │                    │  │                    │              │
│ │ [询问AI] 按钮 ←────┼──┼→ 点击后自动打开   │              │
│ └────────────────────┘  │    全局对话框并@该漏洞            │
│                         └────────────────────┘              │
│                                                              │
│                                        ┌──────────────────┐ │
│                                        │ 💬 AI助手         │ │
│                                        │                  │ │
│                                        │ @漏洞1 为什么... │ │
│                                        │                  │ │
│                                        │ 手动输入：       │ │
│                                        │ @漏洞1 @漏洞2    │ │
│                                        │ 这两个有关联吗？  │ │
│                                        └──────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**设计理由**：
- ✅ **快捷入口降低门槛**：新手点击"询问AI"即可，自动@漏洞
- ✅ **@ 引用提供灵活性**：高级用户可手动@多个漏洞、文件进行复杂提问
- ✅ **全局对话支持跨主题**：一个会话可讨论多个漏洞，避免上下文切换
- ✅ **未来可扩展**：MVP支持@漏洞，V2.0可扩展至@文件、@函数等

### 功能范围

**核心功能：后置对话模式（思路1）+ @ 引用机制**

| 功能模块 | 功能点 | 优先级 |
|---------|-------|--------|
| **全局对话框** | 右下角浮动窗口，支持文本输入和Markdown渲染 | P0 |
| **@ 引用机制** | 支持 `@漏洞X` 引用特定漏洞，自动加载上下文 | P0 |
| **@ 智能提示** | 输入 `@` 时显示漏洞列表（ID、类型、文件位置） | P0 |
| **快捷入口** | 每个漏洞卡片"询问AI"按钮，点击自动填充 `@漏洞X` | P0 |
| **快捷问题** | 针对当前@的漏洞显示5个预设问题，一键提问 | P0 |
| **漏洞解释** | 基于漏洞上下文，解释"为什么是漏洞" | P0 |
| **严重程度说明** | 解释风险等级评估依据 | P0 |
| **多漏洞对话** | 支持 `@漏洞1 @漏洞2` 同时引用，进行跨漏洞分析 | P1 |
| **全局问题** | 不@任何对象时的全局提问（"最严重的漏洞是？"） | P1 |
| **修复建议** | 提供基于模板的修复建议 | P1 |
| **代码定位** | 显示漏洞代码片段（含前后10行） | P1 |
| **对话历史** | 保存会话历史，支持上下文对话 | P1 |

**@ 引用支持对象**（MVP范围）：
- `@漏洞1` / `@漏洞2` ... - 引用特定漏洞（按ID）
- `@SQL注入` - 引用特定类型的漏洞（如有多个则提示选择）

**@ 引用扩展对象**（V2.0+）：
- `@文件:/path/to/file.py` - 引用特定代码文件
- `@函数:login()` - 引用特定函数
- `@工程总结` - 引用工程总结文档
- `@数据流报告` - 引用数据流分析报告

**预设快捷问题**（当@特定漏洞时显示）：
1. "为什么说这是{漏洞类型}？"
2. "这个漏洞有多严重？"
3. "攻击者可以如何利用？"
4. "怎么修复这个问题？"
5. "能给我看看代码吗？"

### 交付物

- ✅ 全局对话功能（支持@引用机制）
- ✅ @ 智能提示功能（输入@时显示漏洞列表）
- ✅ 快捷入口（漏洞卡片"询问AI"按钮）
- ✅ 多漏洞对话能力（支持 `@漏洞1 @漏洞2`）
- ✅ 全局问题能力（不@对象时的全局提问）
- ✅ 前端对话组件（含@引用UI）
- ✅ 用户使用文档（含@引用功能说明）

### 成功指标（2周后评估）

| 指标 | 目标值 | 数据来源 |
|-----|--------|---------|
| **对话使用率** | > 60% | 查看漏洞的用户中，点击"询问AI"或手动@的比例 |
| **@ 引用使用率** | > 40% | 使用对话功能的用户中，使用@引用的比例 |
| **多漏洞对话率** | > 15% | 使用@引用的用户中，引用多个漏洞的比例 |
| **全局问题率** | > 10% | 不@任何对象，直接问全局问题的比例 |
| **问题解答率** | > 85% | AI能够正确回答的问题比例（人工评估） |
| **用户满意度** | > 4.0/5.0 | 对话后弹出的满意度评分 |
| **平均对话轮次** | 2-3轮 | 用户平均提问次数 |
| **响应时间** | < 3秒 | AI回答的平均响应时间 |

**决策标准**：
- ✅ 如果对话使用率 > 60% → 继续投入V2.0
- ⚠️ 如果对话使用率 40-60% → 优化Prompt和UI后再评估
- ❌ 如果对话使用率 < 40% → 调整方向或暂停

---

## 🎯 需求二：流程控制对话（V2.0，6周）

### 需求概述

**需求名称**：流程控制对话
**需求类型**：功能增强
**实施周期**：6周
**核心价值**：在扫描的关键阶段提供确认和调整能力，让专业用户能够介入扫描流程，提升扫描质量和可控性

### 触发条件

**必须满足以下任一条件**：
1. MVP对话使用率 > 60%
2. 用户反馈强烈需要"过程控制"能力
3. 产品竞争需要

**如果不满足条件**：
- ❌ 暂不实施V2.0
- ✅ 优先优化MVP功能
- ✅ 投资其他高ROI功能

### 功能范围

**核心功能：阶段确认模式（思路3）**

| 功能模块 | 功能点 | 优先级 |
|---------|-------|--------|
| **专业模式开关** | 扫描启动页面增加"专业模式"选项 | P0 |
| **Phase门控机制** | 在4个Phase切换时暂停，等待用户确认 | P0 |
| **阶段摘要页** | 展示当前Phase的执行结果摘要 | P0 |
| **阶段对话** | 在门控页面提供对话能力 | P0 |
| **参数调整** | 允许用户调整下一阶段的扫描参数 | P1 |
| **误报标记** | Phase 2完成后，允许标记误报 | P1 |
| **跳过检查** | 允许跳过特定文件/目录的扫描 | P2 |

**4个Phase门控点**：
1. **Phase 1完成**：显示代码结构摘要 → 用户确认 → 继续Phase 2
2. **Phase 2完成**：显示漏洞列表 → 用户确认/标记误报 → 继续Phase 3
3. **Phase 3完成**：显示数据流分析结果 → 用户确认 → 继续Phase 4
4. **Phase 4完成**：生成最终报告

### 交付物

- ✅ 专业模式功能（Phase门控）
- ✅ 4个阶段摘要页面
- ✅ 参数调整功能
- ✅ 误报标记功能

### 成功指标（6周后评估）

| 指标 | 目标值 |
|-----|--------|
| **专业模式使用率** | > 25% |
| **门控确认率** | > 80%（用户不直接跳过） |
| **参数调整使用率** | > 15% |
| **误报标记准确率** | > 90% |

---

## ⚠️ 需求三：实时交互控制（V3.0，12周，谨慎考虑）

### 需求概述

**需求名称**：实时交互控制
**需求类型**：高级功能
**实施周期**：12周
**核心价值**：为专家用户提供随时暂停/恢复扫描的能力，实现扫描过程中的实时对话和策略调整，满足深度安全审计需求

### 触发条件（必须全部满足）

1. ✅ V2.0专业模式使用率 > 25%
2. ✅ 专家用户强烈需要"随时打断"能力（调研问卷）
3. ✅ 专家用户愿意为此功能付费（定价调研）
4. ✅ 技术团队评估通过（ROI分析）
5. ✅ 没有其他更高ROI的功能待开发

**如果不满足条件**：
- ❌ **不实施V3.0**
- ✅ 优先投资其他功能（如更多漏洞检测规则、更快扫描速度）

### 功能范围

**核心功能：中断式对话模式（思路2）**

| 功能模块 | 功能点 | 优先级 |
|---------|-------|--------|
| **专家模式开关** | 扫描启动页面增加"专家模式"选项 | P0 |
| **随时暂停** | 扫描过程中，用户可随时点击"暂停" | P0 |
| **状态保存** | 保存当前执行状态（Checkpoint） | P0 |
| **对话交互** | 暂停后立即提供对话能力 | P0 |
| **恢复执行** | 对话完成后，点击"继续"恢复扫描 | P0 |
| **策略调整** | 暂停期间可调整扫描策略 | P1 |

### 关键决策点

**在Week 8进行Go/No-Go决策**：
- 如果决定Go → 投入12周开发需求三：实时交互控制
- 如果决定No-Go → 将资源投入其他功能

---

## 🎯 关键里程碑

### Milestone 1: 需求一上线（Week 2）

**交付内容**：
- ✅ 智能问答助手功能上线
- ✅ 支持@ 引用机制和快捷问题
- ✅ 灰度发布（10%用户）

**验收标准**：
- 对话功能可用
- 响应时间 < 3秒
- 无严重Bug

### Milestone 2: 需求一验证完成（Week 3）

**交付内容**：
- 📊 数据分析报告（对话使用率、满意度）
- 📋 用户反馈汇总
- 🎯 Go/No-Go决策文档（需求二）

**决策标准**：
- 对话使用率 > 60% → Go 需求二
- 对话使用率 < 40% → No-Go

### Milestone 3: 需求二上线（Week 9，如果启动）

**交付内容**：
- ✅ 流程控制对话功能上线
- ✅ Phase门控机制
- ✅ 灰度发布（20%用户）

**验收标准**：
- 门控功能可用
- 参数调整功能正常
- 无严重Bug

### Milestone 4: 需求二验证完成（Week 10，如果启动）

**交付内容**：
- 📊 数据分析报告（专业模式使用率）
- 📋 专家用户调研报告
- 🎯 Go/No-Go决策文档（需求三）

**决策标准**：
- 专业模式使用率 > 25% 且专家用户愿意付费 → 考虑需求三
- 否则 → 投资其他功能

---

## 📊 风险管理

### 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|-----|------|------|---------|
| **LLM幻觉** | 中 | 高 | 1. 基于已知信息限制回答范围<br>2. 增加"我不确定"选项<br>3. 提供参考链接 |
| **响应速度慢** | 中 | 中 | 1. 优化模型选择<br>2. 缓存常见问题<br>3. 优化响应机制 |
| **V2.0改造失败** | 低 | 高 | 1. 充分测试<br>2. 保留回退方案<br>3. 灰度发布 |
| **V3.0技术债务** | 高 | 高 | 1. 谨慎决策，确认需求<br>2. 充分架构设计<br>3. 代码Review |

### 业务风险

| 风险 | 概率 | 影响 | 应对措施 |
|-----|------|------|---------|
| **用户不使用** | 中 | 高 | 1. 突出显示"询问AI"按钮<br>2. 新手引导<br>3. 预设快捷问题 |
| **成本超预算** | 低 | 中 | 1. 优化模型选择<br>2. 限制免费用户对话次数<br>3. 优化成本控制 |
| **竞争对手抢先** | 中 | 中 | 1. 快速迭代（MVP 2周）<br>2. 持续优化<br>3. 建立差异化 |

---

## ✅ 成功标准

### 需求一：智能问答助手（Week 3评估）

| 指标 | 目标 | 达成标准 |
|-----|------|---------|
| 对话使用率 | > 60% | ✅ 继续需求二 |
| 用户满意度 | > 4.0/5.0 | ✅ 功能有价值 |
| 响应时间 | < 3秒 | ✅ 性能可接受 |
| 问题解答率 | > 85% | ✅ AI质量合格 |

### 需求二：流程控制对话（Week 10评估，如果启动）

| 指标 | 目标 | 达成标准 |
|-----|------|---------|
| 专业模式使用率 | > 25% | ✅ 功能被需要 |
| 门控确认率 | > 80% | ✅ 用户认真使用 |
| 误报标记准确率 | > 90% | ✅ 提升扫描质量 |

---

## 🚦 决策建议

### 立即执行

✅ **需求一：智能问答助手（2周）**
- 最高ROI，最低风险
- 快速验证核心假设
- 2周即可上线

### 数据驱动决策

⭐ **需求二：流程控制对话（6周）**
- 等待需求一数据后再决定
- 如果对话使用率 > 60% → Go
- 如果对话使用率 < 40% → No-Go

### 谨慎考虑

⚠️ **需求三：实时交互控制（12周）**
- 仅在需求二验证成功后考虑
- 必须确认专家用户需求和付费意愿
- 优先级低于其他高ROI功能
- **建议**：暂不规划，根据市场反馈再决定

---

## 📝 附录

### 附录A：数据收集埋点

**MVP埋点**：
- **dialogue_open** - 用户打开对话窗口
  - 触发方式：点击"询问AI"按钮 / 直接点击对话框
  - 属性：`source`（button / manual）
- **dialogue_reference_input** - 用户输入@引用
  - 属性：`reference_type`（vulnerability / file）, `reference_count`（引用数量）
- **dialogue_suggestion_view** - 用户查看@智能提示
  - 属性：`suggestion_count`（显示的建议数）
- **dialogue_suggestion_select** - 用户选择@提示
  - 属性：`reference_id`, `reference_type`
- **dialogue_ask** - 用户提问
  - 属性：`has_reference`（是否使用@）, `reference_count`, `is_global_question`（是否全局问题）
- **dialogue_answer** - AI回答完成
  - 属性：`response_time`（响应时间）, `has_reference`
- **dialogue_shortcut_click** - 用户点击快捷问题
  - 属性：`question_index`（问题序号）
- **dialogue_feedback** - 用户满意度评分
  - 属性：`rating`（1-5分）, `has_reference`

**V2.0埋点**：
- 用户选择专业模式（event: professional_mode_enabled）
- Phase门控暂停（event: phase_gate_triggered）
- 用户确认/调整/跳过（event: phase_gate_decision）
- 标记误报（event: false_positive_marked）

### 附录B：交互模式设计决策

**决策问题**：对话入口应该是每个漏洞独立按钮，还是全局对话框？

**方案对比**：

| 维度 | 方案A：独立对话窗口 | 方案B：全局对话框 + @ 引用 | **推荐：混合模式** |
|-----|------------------|------------------------|------------------|
| **学习成本** | 低，点击即问 | 中，需要学习@ | 低，快捷入口自动@ |
| **灵活性** | 低，无法跨漏洞提问 | 高，可引用多个对象 | **高** |
| **扩展性** | 差，每种对象都要开发 | 强，统一@机制 | **强** |
| **上下文切换** | 高，每个漏洞独立会话 | 低，一个会话讨论多个主题 | **低** |
| **开发成本** | 低，MVP约8天 | 中，MVP约10天 | **中，MVP约9天** |
| **长期ROI** | 低，重复开发 | 高，一次开发长期受益 | **高** |

**混合模式设计要点**：

1. **快捷入口**（降低门槛）
   - 每个漏洞卡片有"询问AI"按钮
   - 点击后自动打开全局对话框，并自动填充 `@漏洞X`
   - 新手无需学习@语法

2. **@ 引用机制**（提供灵活性）
   - 高级用户可手动输入 `@漏洞1 @漏洞2`
   - 支持跨漏洞、跨文件复杂提问
   - 符合现代开发工具习惯（GitHub Copilot、VS Code）

3. **智能提示**（降低学习成本）
   - 输入 `@` 时自动显示下拉列表
   - 显示漏洞ID、类型、位置，便于选择
   - 支持键盘导航（↑↓ Enter）

4. **全局对话**（支持通用问题）
   - 不@任何对象时，可问全局问题
   - 例如："最严重的漏洞是什么？"
   - 例如："这个项目的安全风险有哪些？"

**扩展路径**：

```
MVP (2周)
  - 支持 @漏洞X
  - 支持全局问题
       ↓
V2.0 (如启动)
  - 扩展 @文件:/path/to/file.py
  - 扩展 @函数:login()
  - 扩展 @工程总结
       ↓
V3.0+ (未来可能)
  - 扩展 @代码片段:L45-L60
  - 扩展 @数据流:source→sink
  - 智能推荐@对象（AI主动建议引用）
```

---

**文档维护者**: 产品团队
**最后更新**: 2025-12-17
