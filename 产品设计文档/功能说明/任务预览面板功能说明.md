# 任务预览面板功能说明

## 📋 功能概述

在智能体详情页面的侧导航中，当鼠标悬停在"近期任务"菜单项时，会弹出一个预览面板，显示近十条任务记录。用户可以快速浏览任务列表，点击任意任务直接跳转到全部任务记录页，无需先进入任务列表页面。

## 🎯 功能特性

### 1. 悬停触发
- **触发方式**：鼠标悬停在"近期任务"菜单项
- **显示动画**：平滑的淡入和滑动效果
- **隐藏动画**：鼠标移开后自动隐藏

### 2. 预览面板内容

**面板头部**：
- 显示"近十条任务"标题
- 浅灰色背景，与主内容区分

**任务列表**（近十条）：
- 任务图标：💬（对话式）或 🖥️（GUI交互式）
- 任务标题：显示任务名称，超长自动省略
- 任务状态：
  - 🟠 进行中（橙色背景）
  - 🟢 已完成（绿色背景）
  - 🔴 失败（红色背景）
- 时间信息：相对时间显示（2小时前、1天前、1周前等）

**面板底部**：
- "查看全部任务记录 →" 链接，点击跳转到全部任务记录页面（agent-detail-tasks.html）

### 3. 交互逻辑

**点击行为**：
- ✅ 点击任务项 → 跳转到全部任务记录页（agent-detail-tasks.html）
- ✅ 点击"查看全部任务记录 →" → 跳转到全部任务记录页
- ❌ 点击导航项本身（非预览面板） → 不跳转，保持预览显示

**防误触设计**：
- 预览面板内部点击不会导致面板消失
- 只有在预览面板内点击任务项才会跳转
- 移动端自动禁用预览功能，直接点击跳转

## 🎨 视觉设计

### 颜色方案

| 元素 | 颜色 | 说明 |
|------|------|------|
| 面板背景 | `#FFFFFF` | 白色卡片 |
| 面板阴影 | `rgba(0,0,0,0.15)` | 柔和阴影 |
| 头部/底部背景 | `#FAFAFA` | 浅灰色 |
| 状态-进行中 | `#FFF7E6` / `#FA8C16` | 橙色系 |
| 状态-已完成 | `#F6FFED` / `#52C41A` | 绿色系 |
| 状态-失败 | `#FFF1F0` / `#FF4D4F` | 红色系 |
| 悬停背景 | `#FAFAFA` | 浅灰色高亮 |

### 尺寸规格

```css
面板宽度: 320px
面板圆角: 8px
最大高度: 400px (列表区域可滚动)
任务图标: 36x36px
任务项内边距: 12px 16px
间距: 12px (图标和文字)
```

### 动画效果

```css
过渡时长: 300ms
缓动函数: cubic-bezier(0.4, 0, 0.2, 1)
淡入淡出: opacity 0 → 1
滑动距离: translateX(-10px → 0)
```

## 📱 响应式设计

### 桌面端（≥ 993px）
- ✅ 完整显示预览面板
- ✅ 悬停触发机制
- ✅ 面板位于导航项右侧

### 平板/移动端（≤ 992px）
- ❌ 隐藏预览面板
- ✅ 点击导航项直接跳转到任务列表页
- ✅ 保持原生点击行为

## 💻 技术实现

### HTML 结构

```html
<a href="agent-detail-tasks.html" class="agent-nav-item has-preview">
    <span class="nav-icon">📋</span>
    <span class="nav-text">历史任务</span>
    <span class="nav-badge">3</span>

    <!-- 任务预览面板 -->
    <div class="task-preview-panel">
        <div class="preview-header">
            <span class="preview-title">最近任务</span>
        </div>
        <div class="preview-list">
            <a href="agent-detail-tasks.html" class="preview-task-item">
                <div class="preview-task-icon running">💬</div>
                <div class="preview-task-info">
                    <div class="preview-task-title">任务标题</div>
                    <div class="preview-task-meta">
                        <span class="preview-status running">进行中</span>
                        <span class="preview-time">2小时前</span>
                    </div>
                </div>
            </a>
            <!-- 更多任务... -->
        </div>
        <div class="preview-footer">
            <a href="agent-detail-tasks.html" class="preview-view-all">
                查看全部任务 →
            </a>
        </div>
    </div>
</a>
```

### CSS 关键样式

```css
/* 定位和显示控制 */
.task-preview-panel {
    position: absolute;
    left: 100%;
    top: 0;
    margin-left: 12px;
    opacity: 0;
    visibility: hidden;
    transform: translateX(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 悬停时显示 */
.agent-nav-item.has-preview:hover .task-preview-panel {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
}

/* 滚动条美化 */
.preview-list::-webkit-scrollbar {
    width: 6px;
}
```

### JavaScript 交互

```javascript
// 防止点击导航项本身时跳转
navItemWithPreview.addEventListener('click', function(e) {
    if (e.target.closest('.preview-task-item') ||
        e.target.closest('.preview-view-all')) {
        return; // 允许预览面板内的链接跳转
    }
    e.preventDefault(); // 阻止导航项本身的跳转
});

// 点击统计
previewTaskItems.forEach((item, index) => {
    item.addEventListener('click', function() {
        console.log(`点击了预览任务 #${index + 1}`);
    });
});
```

## 📄 相关文件

### HTML 文件
- `frontend/agent-detail-empty.html` - 空状态页（包含预览面板）
- `frontend/agent-detail-chat.html` - 对话页（包含预览面板）

### CSS 文件
- `frontend/css/agent-detail.css` - 预览面板样式（第217-391行）

### JavaScript 文件
- `frontend/js/agent-detail.js` - 预览面板交互（第224-257行）

## 🔍 使用场景

### 场景1：快速查看近期任务状态
用户想知道最近的任务执行情况，不需要进入全部任务记录页面，只需悬停在"近期任务"菜单上即可快速浏览近十条任务。

### 场景2：快速跳转到全部任务记录
用户想查看或管理所有任务。通过预览面板可以直接点击任何任务项或底部的"查看全部任务记录"链接，快速进入全部任务记录页面。

### 场景3：任务概览
用户想大致了解有多少任务在进行中、多少已完成、是否有失败的任务，通过预览面板的状态标签可以一目了然。

## ✅ 优势特点

1. **提升效率**：减少页面跳转次数，快速预览近期任务
2. **视觉友好**：清晰的状态标识，直观的信息展示
3. **交互自然**：悬停触发，符合用户操作习惯
4. **性能优化**：纯CSS动画，无需额外请求
5. **响应式**：移动端自动降级，保证可用性
6. **明确入口**：提供"查看全部任务记录"入口，导航逻辑清晰

## 🚀 未来扩展

### 可能的改进方向

1. **动态加载**：从API获取真实的近期任务数据
2. **筛选功能**：在预览面板中添加状态筛选（进行中/已完成/失败）
3. **时间范围**：允许切换显示不同时间范围的任务（近7天/近30天）
4. **快捷操作**：在预览面板中直接提供"继续"、"暂停"、"删除"等操作
5. **搜索功能**：在预览面板中添加任务搜索框
6. **分组显示**：按状态或日期分组显示任务

## 📞 相关文档

- [前端UI框架布局设计方案](./前端UI框架布局设计方案.md)
- [UI模板访问指南](./UI模板访问指南.md)

---

**创建时间**：2024-12-09
**最后更新**：2024-12-09
**功能状态**：✅ 已实现并测试
**版本说明**：v1.1 - 更新为"近期任务"及"近十条任务"概念，明确"查看全部任务记录"入口
