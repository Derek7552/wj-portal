# 代码安全漏洞挖掘任务 - 界面功能说明

> **参考模板**: 自规划任务执行助手 (template-planning)  
> **创建时间**: 2025-12-23  
> **任务场景**: 对 Web 应用项目进行安全代码审计，识别潜在漏洞

---

## 1. 界面布局概览

```
┌───────────────────────────────────────────────────────────────────────────┐
│                           智能体头部信息                                    │
├────────────┬──────────────────────────────────┬───────────────────────────┤
│            │                                  │                           │
│  左侧边栏   │       中间对话日志区域            │   右侧智能体工作区域       │
│  (220px)   │       (flex: 1)                  │   (320px)                 │
│            │                                  │                           │
│  - 新任务   │  - 任务意图识别                   │   [日志] [文件]           │
│  - 近期任务 │  - 任务执行规划                   │                           │
│            │  - 阶段执行详情                   │   - 工具调用日志           │
│            │  - 最终回复                       │   - 阶段进度看板           │
│            │                                  │   - 文件目录树             │
│            │                                  │                           │
└────────────┴──────────────────────────────────┴───────────────────────────┘
```

---

## 2. 中间对话日志区域

### 2.1 功能概述

中间对话日志区域是任务执行的核心展示区域，以时间线方式呈现智能体的思考过程、工具调用、文档生成和任务进度。

### 2.2 展示信息模块

#### 2.2.1 任务头部信息

| 指标 | 说明 | 数据格式 |
|------|------|----------|
| 任务标题 | 任务名称 | 字符串，如「代码安全漏洞挖掘任务」 |
| 创建时间 | 任务创建时间 | YYYY-MM-DD HH:mm |

#### 2.2.2 系统消息

| 指标 | 说明 | 示例 |
|------|------|------|
| 消息图标 | 🎯 目标图标 | - |
| 消息时间 | 消息发送时间 | 14:30 |
| 消息内容 | 任务创建提示 | "任务已创建：对项目进行安全代码审计，识别潜在漏洞" |

#### 2.2.3 任务意图识别卡片

| 指标 | 说明 | 示例数据 |
|------|------|----------|
| 任务类型 | 智能体识别的任务类型 | 代码安全漏洞挖掘 |
| 分析对象 | 待分析的项目信息 | Web应用项目（Java Spring Boot） |
| 预期目标 | 任务期望达成的目标 | 识别安全漏洞、生成漏洞报告、提供修复建议 |

#### 2.2.4 任务执行规划卡片

| 指标 | 说明 | 示例数据 |
|------|------|----------|
| 阶段序号 | 执行阶段编号 | 1, 2, 3 |
| 阶段名称 | 阶段任务描述 | 工程功能模块分析 / 威胁建模与漏洞分析 / 分析总结报告生成 |

#### 2.2.5 阶段执行详情卡片

每个阶段卡片包含以下内容：

| 组件 | 指标 | 说明 |
|------|------|------|
| **阶段头部** | 阶段徽章 | 「阶段 1」「阶段 2」「阶段 3」 |
| | 阶段标题 | 阶段名称 |
| | 阶段状态 | ✓ 已完成 / 🔄 进行中 / ⏸️ 等待中 |
| **思考事件** | 图标 | 💭 |
| | 内容 | 智能体的思考过程描述 |
| **工具调用事件** | 图标 | 🔧 |
| | 工具名称 | read_file / list_directory / edit_file 等 |
| | 操作对象 | 文件路径或目录路径 |
| | 点击行为 | 点击后在右侧日志区显示详细执行结果 |
| **文档生成事件** | 图标 | 📄 |
| | 文档标题 | 如「工程功能模块分析总结」 |
| | 文件名 | 如「模块分析总结.md」 |
| | 点击行为 | 点击后在右侧日志区显示文档内容 |

#### 2.2.6 任务规划与更新事件

| 事件类型 | 图标 | 说明 | 展示内容 |
|----------|------|------|----------|
| 规划新任务 | 📝 | 智能体规划子任务清单 | 任务数量 + 任务列表 |
| 开始执行任务 | ▶️ | 开始执行某个子任务 | 任务名称 + 状态(🔄) |
| 任务执行结束 | ✅ | 子任务完成 | 任务名称 + 状态(✓) |

**子任务状态指示：**

| 状态 | 图标 | 颜色 |
|------|------|------|
| 等待中 | ⏸️ | 灰色 |
| 执行中 | 🔄 | 蓝色 |
| 已完成 | ✓ | 绿色 |

#### 2.2.7 漏洞发现卡片

| 指标 | 说明 | 示例 |
|------|------|------|
| 漏洞等级 | 危险程度标签 | 高危 / 中危 / 低危 |
| 漏洞名称 | 漏洞类型名称 | SQL注入漏洞 |
| 漏洞位置 | 代码文件和行号 | UserRepository.java:67 |
| 漏洞描述 | 漏洞详细说明 | "用户输入未经过滤直接拼接到SQL语句中" |

**漏洞等级颜色方案：**

| 等级 | 背景色 | 文字色 |
|------|--------|--------|
| 高危 | #fee2e2 | #dc2626 |
| 中危 | #fef3c7 | #d97706 |
| 低危 | #e0f2fe | #0284c7 |

#### 2.2.8 任务进度条

| 指标 | 说明 | 示例 |
|------|------|------|
| 进度标题 | 当前进度说明 | 漏洞分析进度 |
| 进度百分比 | 完成度 | 100% |
| 统计信息 | 分析结果统计 | "已分析 18 个文件" / "发现 8 个漏洞" |

#### 2.2.9 最终回复卡片

| 模块 | 指标 | 说明 |
|------|------|------|
| **分析概览** | 标题 | "分析概览与核心发现" |
| | 摘要文本 | 任务执行结果的文字总结 |
| **漏洞统计表** | 漏洞名称 | 漏洞类型 |
| | 危险等级 | 高危/中危/低危 徽章 |
| | 位置 | 文件名:行号 |
| **关键文档** | 文档卡片 | 点击可查看文档详情 |
| | 文档图标 | 📋 / 📊 / 🧠 |
| | 文档标题 | 如「漏洞详细报告」 |
| | 文档信息 | 文件数量 + 文件大小 |

---

## 3. 右侧智能体工作区域

### 3.1 功能概述

右侧工作区提供两个核心功能 Tab：
- **日志 Tab**: 显示工具调用详情、任务清单和阶段进度
- **文件 Tab**: 显示任务生成的文件目录树

### 3.2 日志 Tab

#### 3.2.1 日志详情区

**工具调用日志：**

| 指标 | 说明 | 示例 |
|------|------|------|
| 工具名称 | 调用的工具函数 | `read_file` / `list_directory` / `edit_file` |
| 操作目的 | 工具调用的目的描述 | "读取 `application.yml`" |
| 执行结果 | 工具返回的内容 | 代码块形式展示文件内容或目录结构 |

**文档日志：**

| 指标 | 说明 | 示例 |
|------|------|------|
| 操作类型 | 固定为"生成文档" | - |
| 文件名 | 生成的文档文件名 | `模块分析总结.md` |
| 文件大小 | 文档大小 | 8 KB |
| 文档内容 | Markdown 格式的文档全文 | - |

**任务清单日志：**

| 指标 | 说明 | 示例 |
|------|------|------|
| 清单标题 | 固定为"任务清单" | - |
| 清单描述 | "全局任务执行情况" | - |
| 任务列表 | 所有子任务及其状态 | - |

#### 3.2.2 日志导航栏

| 组件 | 功能 | 说明 |
|------|------|------|
| ◀ 上一条 | 查看上一条日志 | 禁用状态：已是第一条 |
| ▶ 下一条 | 查看下一条日志 | 禁用状态：已是最后一条 |
| 进度指示 | 显示当前日志位置 | 格式：`1 / 2` |
| 进度条 | 可视化进度 | 百分比填充 |
| 📡 实时 | 实时追踪最新日志 | 激活时自动跳转到最新日志 |

#### 3.2.3 阶段进度看板

| 指标 | 说明 | 示例 |
|------|------|------|
| 面板标题 | 固定为"阶段进度" | 📊 阶段进度 |
| 阶段项 | 各执行阶段 | - |
| 阶段状态标记 | 完成状态指示 | ✓ 已完成 / 🔄 进行中 |
| 阶段名称 | 阶段描述文字 | "工程功能模块分析" |
| 当前阶段高亮 | 标识当前执行阶段 | 添加 `current` 样式类 |
| 点击跳转 | 点击阶段项跳转到对话区对应位置 | 平滑滚动 + 高亮动画 |

### 3.3 文件 Tab

#### 3.3.1 文件目录树

**目录结构示例（代码安全漏洞挖掘任务）：**

```
📁 vulnex/                          # 项目根目录
├── 📁 项目记忆/                     # 项目分析记忆文件
│   ├── 📄 工程功能记忆文件.md (3.1 KB)
│   └── 📄 工程记忆文件.md (4.5 KB)
├── 📁 漏洞报告/                     # 漏洞分析报告
│   ├── 📄 漏洞报告-001.md (1.2 KB)
│   └── 📄 漏洞报告-002.md (0.8 KB)
└── 📁 总结报告/                     # 最终总结
    └── 📄 工程总结报告.md (5.2 KB)
📁 user/                            # 用户上传文件
└── 📄 project.zip (2.5 MB)
```

#### 3.3.2 文件项信息

| 指标 | 说明 | 展示位置 |
|------|------|----------|
| 文件类型图标 | 📁 目录 / 📄 文件 | 左侧 |
| 文件名 | 文件或目录名称 | 中间 |
| 文件大小 | 文件大小（仅文件） | 右侧（灰色文字） |
| 下载按钮 | ⬇️ 下载操作 | 悬停时显示 |

#### 3.3.3 目录交互

| 交互 | 说明 |
|------|------|
| 点击目录头 | 展开/折叠目录 |
| 展开状态 | 添加 `expanded` 类，显示子项 |
| 折叠状态 | 移除 `expanded` 类，隐藏子项 |

---

## 4. 交互联动机制

### 4.1 对话区 → 日志区联动

| 触发操作 | 联动效果 |
|----------|----------|
| 点击工具调用事件 (🔧) | 右侧切换到日志 Tab，显示对应工具的执行详情 |
| 点击文档生成事件 (📄) | 右侧切换到日志 Tab，显示对应文档内容 |
| 点击最终回复中的文档卡片 | 右侧切换到日志 Tab，显示对应文档内容 |

### 4.2 日志导航联动

| 操作 | 效果 |
|------|------|
| 点击上一条/下一条 | 日志区切换显示内容 |
| 开启实时追踪 | 自动跳转到最新日志，新日志产生时自动更新 |

### 4.3 阶段进度看板联动

| 操作 | 效果 |
|------|------|
| 点击阶段项 | 对话区平滑滚动到对应阶段卡片位置 |
| 滚动高亮 | 目标阶段卡片短暂高亮（背景色 #e6f7ff，2秒后恢复） |

---

## 5. 工具调用类型汇总

本任务涉及的工具调用类型：

| 工具函数 | 功能说明 | 参数示例 |
|----------|----------|----------|
| `list_directory` | 列出目录结构 | `{ path: 'src/' }` |
| `read_file` | 读取文件内容 | `{ path: 'application.yml' }` |
| `read_file` (带行号) | 读取文件指定行 | `{ path: 'UserRepository.java', lines: '45-78' }` |
| `edit_file` | 编辑/追加文件 | `{ path: '工程记忆.md', action: 'append' }` |

---

## 6. 生成文档类型汇总

| 文档类型 | 文件名 | 大小 | 内容说明 |
|----------|--------|------|----------|
| 模块分析总结 | 模块分析总结.md | 8 KB | 项目结构、核心模块、关键代码路径 |
| 工程记忆文件 | 工程记忆.md | 9 KB | 核心模块、已发现问题、分析进度 |
| 漏洞详细报告 | 漏洞报告.md | 12 KB | 按危险等级分类的漏洞详情和修复建议 |
| 安全评估报告 | 安全评估报告.md | 18 KB | 综合评估、风险等级分布、修复优先级 |

---

## 7. 漏洞发现统计（示例数据）

| 漏洞名称 | 危险等级 | 位置 | 描述 |
|----------|----------|------|------|
| SQL注入 | 高危 | UserRepository.java:67 | 用户输入未经过滤直接拼接到SQL语句 |
| 越权访问 | 高危 | SecurityConfig.java:34 | 部分管理接口未配置权限校验 |
| 硬编码密钥 | 高危 | JwtUtil.java:12 | JWT密钥硬编码在代码中 |
| 存储型XSS | 中危 | user-profile.html:23 | 用户昵称未进行HTML转义 |
| CSRF防护缺失 | 中危 | SecurityConfig.java:45 | 未配置CSRF防护 |
| 敏感信息泄露 | 中危 | ErrorHandler.java:28 | 错误信息包含敏感数据 |
| 不安全的随机数 | 中危 | TokenGenerator.java:15 | 使用弱随机数生成器 |
| 弱密码策略 | 低危 | PasswordValidator.java:8 | 密码强度要求过低 |

---

## 8. 相关文件

| 文件类型 | 路径 |
|----------|------|
| HTML 模板 | `frontend/templates/pages/template-planning.html` |
| JavaScript | `frontend/templates/js/template-planning.js` |
| CSS 样式 | `frontend/templates/css/template-planning.css` |
| 详情样式 | `frontend/templates/css/template-detail.css` |

---

*文档版本: v1.0*  
*最后更新: 2025-12-23*

